/*!
 * Tabledit v1.2.2 (https://github.com/markcell/jQuery-Tabledit)
 * Copyright (c) 2015 Celso Marques
 * Licensed under MIT (https://github.com/markcell/jQuery-Tabledit/blob/master/LICENSE)
 */
if(typeof jQuery=="undefined")throw new Error("Tabledit requires jQuery library.");(function(n){"use strict";n.fn.Tabledit=function(t){function c(t){var f=r.find(".tabledit-input").serialize()+"&action="+t,s=t===i.buttons.edit.action?i.url+"/update":t===i.buttons.delete.action?i.url+"/delete":i.url+"/restore",h=i.onAjax(t,f),u;return h===!1?!1:(u=n.post(s,f,function(n,u,f){if(t===i.buttons.edit.action){o.removeClass(i.dangerClass).addClass(i.warningClass);i.onSuccess(n,o,u,f);setTimeout(function(){r.find("tr."+i.warningClass).removeClass(i.warningClass)},1400)}else if(t===i.buttons.delete.action)i.onSuccess(n,e,u,f)},"json"),u.fail(function(n,r,u){if(t===i.buttons.delete.action){e.removeClass(i.mutedClass).addClass(i.dangerClass);e.find(".tabledit-toolbar button").attr("disabled",!1);e.find(".tabledit-toolbar .tabledit-restore-button").hide();i.onFail(e,n,r,u)}else if(t===i.buttons.edit.action){o.addClass(i.dangerClass);i.onFail(o,n,r,u)}}),u.always(function(){i.onAlways()}),u)}if(!this.is("table"))throw new Error("Tabledit only works when applied to a table.");var r=this,l={url:window.location.href,inputClass:"form-control input-sm",toolbarClass:"btn-toolbar",groupClass:"btn-group btn-group-sm",dangerClass:"danger",warningClass:"warning",mutedClass:"text-muted",eventType:"click",rowIdentifier:"id",hideIdentifier:!1,autoFocus:!0,editButton:!0,deleteButton:!0,saveButton:!0,restoreButton:!0,buttons:{edit:{"class":"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-pencil"><\/span>',action:"edit"},"delete":{"class":"btn btn-sm btn-default",html:'<span class="glyphicon glyphicon-trash"><\/span>',action:"delete"},save:{"class":"btn btn-sm btn-success",html:"Save"},restore:{"class":"btn btn-sm btn-warning",html:"Restore",action:"restore"},confirm:{"class":"btn btn-sm btn-danger",html:"Confirm"}},onDraw:function(){return},onRowEdited:function(){return!0},onRowDeleted:function(){return!0},onReset:function(){return},onSuccess:function(){return},onFail:function(){return},onAlways:function(){return},onAjax:function(){return}},i=n.extend(!0,l,t),o="undefined",e="undefined",a="undefined",h={columns:{identifier:function(){i.hideIdentifier&&r.find("th:nth-child("+parseInt(i.columns.identifier[0])+1+"), td:nth-child("+parseInt(i.columns.identifier[0])+1+")").hide();var t=r.find("td:nth-child("+(parseInt(i.columns.identifier[0])+1)+")");t.each(function(){var t='<span class="tabledit-span tabledit-identifier">'+n(this).text()+"<\/span>",r='<input class="tabledit-input tabledit-identifier" type="hidden" name="'+i.columns.identifier[1]+'" value="'+n(this).text()+'" disabled>';n(this).html(t+r);n(this).parent("tr").attr(i.rowIdentifier,n(this).text())})},editable:function(){for(var f,t,u=0;u<i.columns.editable.length;u++)f=r.find("td:nth-child("+(parseInt(i.columns.editable[u][0])+1)+")"),t=typeof i.columns.editable[u][2]!="undefined"?i.columns.editable[u][2]:"text",f.each(function(){var o=n(this).text(),f={},e,s,h,a,c,l,r,v;i.editButton||n(this).css("cursor","pointer");e=i.columns.editable[u][1];t==="single"||t==="multiple"||t==="checkbox"?(s=JSON.parse(i.columns.editable[u][3]),t==="single"||t==="multiple"?(h=t==="multiple"?' multiple="multiple"':"",h&&(e+="[]"),r="<select"+h+' class="tabledit-input '+i.inputClass+'" name="'+e+'" style="display: none;" disabled>',a=n.map(o.split(","),function(t){return n.trim(t)}),n.each(s,function(t,i){r+=n.inArray(i,a)>=0?'<option value="'+t+'" selected="selected">'+i+"<\/option>":'<option value="'+t+'">'+i+"<\/option>"}),r+="<\/select>"):(c="",l=i.columns.editable[u][4],n.each(s,function(n,t){n==l?(o==t&&(c=' checked="checked"'),f["checked-value"]=n,f["checked-text"]=t):(f["unchecked-value"]=n,f["unchecked-text"]=t)}),r='<input class="tabledit-input '+i.inputClass+'" type="checkbox" name="'+e+'" value="'+l+'"'+c+' style="display: none;" disabled>')):t==="textarea"?r='<textarea class="tabledit-input '+i.inputClass+'" name="'+e+'" style="display: none;" disabled>'+n(this).text()+"<\/textarea>":(r='<input class="tabledit-input '+i.inputClass+'" type="'+t+'" name="'+e+'" value="'+n(this).text()+'" style="display: none;" disabled>',t==="password"&&(f["clear-text"]=o,o="******"));v='<span class="tabledit-span">'+o+"<\/span>";n(this).html(v+r);n(this).find("input:checkbox").data("checkbox",f);n(this).find("input:password").data("password",f);n(this).find("select").select2({minimumResultsForSearch:50});n(this).addClass("tabledit-view-mode")})},toolbar:function(){var o;if(i.editButton||i.deleteButton){var n="",t="",u="",f="",e="";r.find("th.tabledit-toolbar-column").length===0&&r.find("tr:first").append('<th class="tabledit-toolbar-column"><\/th>');i.editButton&&(n='<button type="button" class="tabledit-edit-button '+i.buttons.edit.class+'" style="float: none;">'+i.buttons.edit.html+"<\/button>");i.deleteButton&&(t='<button type="button" class="tabledit-delete-button '+i.buttons.delete.class+'" style="float: none;">'+i.buttons.delete.html+"<\/button>",e='<button type="button" class="tabledit-confirm-button '+i.buttons.confirm.class+'" style="display: none; float: none;">'+i.buttons.confirm.html+"<\/button>");i.editButton&&i.saveButton&&(u='<button type="button" class="tabledit-save-button '+i.buttons.save.class+'" style="display: none; float: none;">'+i.buttons.save.html+"<\/button>");i.deleteButton&&i.restoreButton&&(f='<button type="button" class="tabledit-restore-button '+i.buttons.restore.class+'" style="display: none; float: none;">'+i.buttons.restore.html+"<\/button>");o='<div class="tabledit-toolbar '+i.toolbarClass+'" style="text-align: left;">\n                                           <div class="'+i.groupClass+'" style="float: none;">'+n+t+"<\/div>\n                                           "+u+"\n                                           "+e+"\n                                           "+f+"\n                                       <\/div><\/div>";r.find("tbody tr").append('<td class="tabledit-toolbar-column" style="white-space: nowrap; width: 1%;">'+o+"<\/td>")}}}},s={view:function(t){var r=n(t).parent("tr");n(t).parent("tr").find(".tabledit-input.tabledit-identifier").prop("disabled",!0);n(t).find(".tabledit-input").blur().hide().prop("disabled",!0);n(t).find(".tabledit-span").show();n(t).addClass("tabledit-view-mode").removeClass("tabledit-edit-mode");i.editButton&&(r.find("button.tabledit-save-button").hide(),r.find("button.tabledit-edit-button").removeClass("active").blur())},edit:function(t){var r,u;f.reset(t);r=n(t).parent("tr");r.find(".tabledit-input.tabledit-identifier").prop("disabled",!1);n(t).find(".tabledit-span").hide();u=n(t).find(".tabledit-input");u.prop("disabled",!1).not("select").show();i.autoFocus&&u.focus();n(t).addClass("tabledit-edit-mode").removeClass("tabledit-view-mode");i.editButton&&(r.find("button.tabledit-edit-button").addClass("active"),r.find("button.tabledit-save-button").show())}},u={reset:function(t){i.onReset(n(t).parent("tr"));n(t).each(function(){var t=n(this).find(".tabledit-input"),i=n(this).find(".tabledit-span").text(),r;t.is("select")?(r=n.map(i.split(","),function(t){return n.trim(t)}),t.find("option").filter(function(){return n.inArray(n.trim(n(this).text()),r)>=0}).attr("selected",!0)):t.is(":checkbox")?t.attr("checked",t.val()==i):t.is(":password")?t.val(t.data("password")["clear-text"]):t.val(i);s.view(this)})},submit:function(t){if(i.onRowEdited(n(t).parent("tr"))){var r=c(i.buttons.edit.action);if(r===!1)return;n(t).each(function(){var t=n(this).find(".tabledit-input"),i,r;t.is("select")?(i=[],t.find("option:selected").each(function(){i.push(n(this).text())}),n(this).find(".tabledit-span").text(i.join(", "))):t.is(":checkbox")?t.is(":checked")?n(this).find(".tabledit-span").text(t.data("checkbox")["checked-text"]):n(this).find(".tabledit-span").text(t.data("checkbox")["unchecked-text"]):t.is(":password")?(r={},r["clear-text"]=t.val(),t.data("password",r),n(this).find(".tabledit-span").text("******")):n(this).find(".tabledit-span").text(t.val());s.view(this)});o=n(t).parent("tr")}}},f={reset:function(t){i.onReset(n(t).parent("tr"));r.find(".tabledit-confirm-button").hide();r.find(".tabledit-delete-button").removeClass("active").blur()},submit:function(t){if(i.onRowDeleted(n(t).parent("tr"))){f.reset(t);n(t).parent("tr").find("input.tabledit-identifier").attr("disabled",!1);var r=c(i.buttons.delete.action);if(n(t).parents("tr").find("input.tabledit-identifier").attr("disabled",!0),r===!1)return;n(t).parent("tr").addClass("tabledit-deleted-row");n(t).parent("tr").addClass(i.mutedClass).find(".tabledit-toolbar button:not(.tabledit-restore-button)").attr("disabled",!0);n(t).find(".tabledit-restore-button").show();e=n(t).parent("tr")}},confirm:function(t){r.find("td.tabledit-edit-mode").each(function(){u.reset(this)});n(t).find(".tabledit-delete-button").addClass("active");n(t).find(".tabledit-confirm-button").show()},restore:function(t){n(t).parent("tr").find("input, select").attr("disabled",!1);var r=c(i.buttons.restore.action);(n(t).parents("tr").find("input, select").attr("disabled",!0),r!==!1)&&(n(t).parent("tr").removeClass("tabledit-deleted-row"),n(t).parent("tr").removeClass(i.mutedClass).find(".tabledit-toolbar button").attr("disabled",!1),n(t).find(".tabledit-restore-button").hide(),a=n(t).parent("tr"))}};if(h.columns.identifier(),h.columns.editable(),h.columns.toolbar(),i.onDraw(),i.deleteButton){r.on("click","button.tabledit-delete-button",function(t){if(t.handled!==!0){t.preventDefault();var r=n(this).hasClass("active"),i=n(this).parents("td");f.reset(i);r||f.confirm(i);t.handled=!0}});r.on("click","button.tabledit-confirm-button",function(t){if(t.handled!==!0){t.preventDefault();var i=n(this).parents("td");f.submit(i);t.handled=!0}})}if(i.restoreButton)r.on("click","button.tabledit-restore-button",function(t){t.handled!==!0&&(t.preventDefault(),f.restore(n(this).parents("td")),t.handled=!0)});if(i.editButton){r.on("click","button.tabledit-edit-button",function(t){if(t.handled!==!0){t.preventDefault();var i=n(this),f=i.hasClass("active");u.reset(r.find("td.tabledit-edit-mode"));f||n(i.parents("tr").find("td.tabledit-view-mode").get().reverse()).each(function(){s.edit(this)});t.handled=!0}});r.on("click","button.tabledit-save-button",function(t){t.handled!==!0&&(t.preventDefault(),u.submit(n(this).parents("tr").find("td.tabledit-edit-mode")),t.handled=!0)})}else{r.on(i.eventType,"tr:not(.tabledit-deleted-row) td.tabledit-view-mode",function(n){n.handled!==!0&&(n.preventDefault(),u.reset(r.find("td.tabledit-edit-mode")),s.edit(this),n.handled=!0)});r.on("change","select.tabledit-input:visible",function(){event.handled!==!0&&(u.submit(n(this).parent("td")),event.handled=!0)});n(document).on("click",function(n){var t=r.find(".tabledit-edit-mode");t.is(n.target)||t.has(n.target).length!==0||u.reset(r.find(".tabledit-input:visible").parent("td"))})}n(document).on("keyup",function(n){var i=r.find(".tabledit-input:visible"),e=r.find(".tabledit-confirm-button"),t;if(i.length>0)t=i.parents("td");else if(e.length>0)t=e.parents("td");else return;switch(n.keyCode){case 13:u.submit(t);break;case 27:u.reset(t);f.reset(t)}});return this}})(jQuery)