(function (document, window) {
	'use strict';

	var icons = `
		@font-face {
			font-family: 'fonticon'; 
			src: url('data:application/font-woff;base64,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') format('woff');
			font-weight: normal;
			font-style: normal; 
		}
		.icon {
			font-family: 'fonticon';
			speak: none; 
			font-style: normal;
			font-weight: normal;
			font-variant: normal;
			text-transform: none;
			vertical-align: top;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}
		.icon-search:before{content:'\\e600';}
		.icon-twitter:before{content:'\\e601';}
		.icon-facebook:before{content:'\\e602';}
		.icon-help:before{content:'\\e603';}
		.icon-mail:before{content:'\\e604';}
		.icon-print:before{content:'\\e605';}
		.icon-close:before{content:'\\e606';}
		.icon-chevron:before{content:'\\e607';}
		.icon-chevron-down:before{content:'\\e608';}
		.icon-chevron-back:before{content:'\\e609';}
		.icon-chevron-up:before{content:'\\e60a';}
		.icon-comment:before{content:'\\e60b';}
		.icon-external-link:before{content:'\\e60c';}
		.icon-download:before{content:'\\e60d';}
		.icon-menu:before{content:'\\e60e';}
		.icon-write:before{content:'\\e60f';}
		.icon-hours:before{content:'\\e610';}
		.icon-phone:before{content:'\\e611';}
		.icon-pedestrian:before{content:'\\e612';}
		.icon-town-hall:before{content:'\\e613';}
		.icon-form:before{content:'\\e614';}
		.icon-danger:before{content:'\\e615';}
		.icon-attention:before{content:'\\e615';}
		.icon-warning:before{content:'\\e616';}
		.icon-info:before{content:'\\e617';}
		.icon-success:before{content:'\\e618';}
		.icon-folder:before{content:'\\e619';}
		.icon-user:before{content:'\\e61a';}
		.icon-arobase:before{content:'\\e61b';}
		.icon-info2:before{content:'\\e61c';}
		.icon-right-arrow:before{content:'\\e61d';}
		.icon-notepad:before{content:'\\e61e';}
		.icon-web:before{content:'\\e61f';}
		.icon-message:before{content:'\\e620';}
		.icon-recall:before{content:'\\e621';}
		.icon-format:before{content:'\\e622';}
		.icon-rss:before{content:'\\e623';}
		.icon-google-plus:before{content:'\\e624';}
		.icon-home:before{content:'\\e625';}
		.icon-more:before{content:'\\e626';}
		.icon-attention:before{content:'\\e627';}
		.icon-trash:before{content:'\\e628';}
		.icon-close2:before{content:'\\e629';}
		.icon-star:before{content:'\\e62a';}
		.icon-share:before{content:'\\e62b';}
		.icon-more2:before{content:'\\e62c';}
		.icon-triangle-right:before{content:'\\e62d';}
		.icon-next:before{content:'\\e62e';}
		.icon-edit:before{content:'\\e62f';}
		.icon-attention2:before{content:'\\e630';}
		.icon-triangle-down:before{content:'\\e631';}
		.icon-people:before{content:'\\e632';}
		.icon-param:before{content:'\\e633';}
		.icon-pending:before{content:'\\e634';}
		.icon-balloon:before{content:'\\e635';}
		.icon-calendar:before{content:'\\e800';}
		.icon-account:before{content:'\\e801';}
		.icon-doc:before{content:'\\e900';}
		.icon-manager:before{content:'\\e90f';}
		.icon-opening:before{content:'\\e910';}
		.icon-text:before{content:'\\e911';}
		.icon-location:before{content:'\\e912';}
		.icon-flag:before{content:'\\e913';}
		.icon-send:before{content:'\\e914';}
		.icon-user-circle:before{content:'\\e915';}
		.icon-tutorial:before{content:'\\e90e';}
		.icon-calendar-add:before{content:'\\e90d';}
		.icon-download-doc:before{content:'\\e90c';}
		.icon-play:before{content:'\\e90b';}
		.icon-bullet:before{content:'\\e90a';}
		.icon-map:before{content:'\\e909';}
		.icon-enlarge:before{content:'\\e908';}
		.icon-linkedin:before{content:'\\e904';}
		.icon-notice:before{content:'\\e907';}
		.icon-contact:before{content:'\\e906';}
		.icon-transmit:before{content:'\\e905';}
		.icon-seal:before{content:'\\e903';}
		.icon-deadlines:before{content:'\\e902';}
		.icon-cancel:before{content:'\\e901';}
	`;

	var preloader = `
		.simulator-preloader {
			background: #FFF;
			bottom: 0;
			left: 0;
			position: fixed;
			right: 0;
			top: 0;
			z-index: 9999;
		}

		.simulator-preloader .image {
			background-image: url('data:image/gif;base64,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'); 
			background-position: center;
			background-repeat: no-repeat;
			height: 200px;
			left: 50%;
			margin: -100px 0 0 -100px;
			position: absolute;
			top: 50%;
			width: 200px;
		}
	`;

	var general = `
		@charset 'UTF-8';
		.simulator-container.default-style .sr-only {
			position: absolute;
			width: 1px;
			height: 1px;
			padding: 0;
			margin: -1px;
			overflow: hidden;
			clip: rect(0, 0, 0, 0);
			white-space: nowrap;
			border: 0;
		}
		.simulator-container.default-style .hidden {
			display: none;
		}
		.simulator-container.default-style .asterisk {
			color: red;
		}
		.simulator-container.default-style .prenote,
		.simulator-container.default-style .postnote {
			font-size: smaller;
		}
		.simulator-container.default-style .actionbuttons.top.link {
			display: block;
			float: right;
		}
		.simulator-container.default-style .actionbuttons.top.link a {
			padding: .15em .3em;
			margin: 0;
			background: #f0f0f0;
		}
		.simulator-container.default-style .actionbuttons.top.link a:after {
			content: '';
		}
		.simulator-container.default-style .actionbuttons.top.link + div {
			clear: both;
		}
		.simulator-container.default-style .global-alert.has-error {
			font-weight: bold;
			font-size: larger;
			color: var(--color, red);
		}
		.simulator-container.default-style .global-alert.has-warning {
			font-weight: bold;
			font-size: larger;
			color: var(--color, #8a6d3b);
		}
		.simulator-container.default-style .field-alert.has-error {
			font-weight: bold;
			color: var(--color, red);
		}
		.simulator-container.default-style .field-alert.has-warning {
			font-weight: bold;
			color: var(--color, #8a6d3b);
		}
		.simulator-container.default-style .btn-help {
			width: 20px;
			height: 20px;
			font-size: 1.4em;
			border: none;
			background: transparent;
			clear: initial;
			cursor: pointer;
			display: inline-block;
			margin-top: -5px;
		}
		.simulator-container.default-style .field-container > * {
			vertical-align: middle;
		}
		.simulator-container.default-style .icon-help:before {
			color: var(--color, var(--primary-color, #2B4E6B));
		}
		.simulator-container.default-style .field-container input[type="text"],
		.simulator-container.default-style .field-container input[type="date"],
		.simulator-container.default-style .field-container input.date,
		.simulator-container.default-style .field-container input[type="number"],
		.simulator-container.default-style .field-container input[type="money"] {
			box-sizing: border-box;
			margin-top: 0;
			margin-right: 0.5em;
			padding-left: 0.2em;
			height: 2.1rem;
			border: 1px solid #ccc;
			border-radius: 4px;
			background-color: #fff;
		}
		.simulator-container.default-style .field-container.choice:not([data-expanded='true']) select,
		.simulator-container.default-style .field-container.department:not([data-expanded='true']) select,
		.simulator-container.default-style .field-container.day:not([data-expanded='true']) select,
		.simulator-container.default-style .field-container.month:not([data-expanded='true']) select,
		.simulator-container.default-style .field-container.year:not([data-expanded='true']) select {
			-webkit-appearance: none;
			-moz-appearance: none;
			appearance: none;
			box-sizing: border-box;
			width: 100%; 
			height: 2.1rem;
			border: 0; 
			margin: 0;
			padding: 0 0.75em 0 0.75em;
			border-radius: 0;
			overflow: hidden;
			text-overflow: ellipsis;
		}
		.simulator-container.default-style .field-container.choice:not([data-expanded='true']) option,
		.simulator-container.default-style .field-container.department:not([data-expanded='true']) option,
		.simulator-container.default-style .field-container.day:not([data-expanded='true']) option,
		.simulator-container.default-style .field-container.month:not([data-expanded='true']) option,
		.simulator-container.default-style .field-container.year:not([data-expanded='true']) option {
			padding-right: 35px;
		}
		.simulator-container.default-style .field-container.choice:not([data-expanded='true']) option:hover,
		.simulator-container.default-style .field-container.department:not([data-expanded='true']) option:hover,
		.simulator-container.default-style .field-container.day:not([data-expanded='true']) option:hover,
		.simulator-container.default-style .field-container.month:not([data-expanded='true']) option:hover,
		.simulator-container.default-style .field-container.year:not([data-expanded='true']) option:hover {
			backround-color: var(--color, var(--primary-color, #0b6ba8));
			color: white;
		}

		.simulator-container.default-style .field-container.choice:not([data-expanded='true']) > .field-group,
		.simulator-container.default-style .field-container.department:not([data-expanded='true']) > .field-group,
		.simulator-container.default-style .field-container.day:not([data-expanded='true']) > .field-group,
		.simulator-container.default-style .field-container.month:not([data-expanded='true']) > .field-group,
		.simulator-container.default-style .field-container.year:not([data-expanded='true']) > .field-group {
			position: relative; 
			background-color: #fff;
			border: 1px solid #ccc;
			border-radius: 4px;
			overflow: hidden; 
		}
		.simulator-container.default-style .field-container.choice:not([data-expanded='true']),
		.simulator-container.default-style .field-container.department:not([data-expanded='true']),
		.simulator-container.default-style .field-container.day:not([data-expanded='true']),
		.simulator-container.default-style .field-container.month:not([data-expanded='true']),
		.simulator-container.default-style .field-container.year:not([data-expanded='true']) {
			position: relative;
		}

		.simulator-container.default-style .field-container.choice:not([data-expanded='true']) > .field-group::after,
		.simulator-container.default-style .field-container.department:not([data-expanded='true']) > .field-group::after,
		.simulator-container.default-style .field-container.day:not([data-expanded='true']) > .field-group::after, 
		.simulator-container.default-style .field-container.month:not([data-expanded='true']) > .field-group::after,
		.simulator-container.default-style .field-container.year:not([data-expanded='true']) > .field-group::after { 
			content: '\\e608';
			position: absolute;
			top: 0.125rem;
			margin-top: 0;
			right: 0.125rem;
			display: block;
			width: 1.25rem;
			height: 1.25rem;
			border: 1px solid blue;
			pointer-events: none;
			font-family: 'fonticon';
			speak: none;
			text-transform: none;
			line-height: 1;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
			color: var(--color, var(--primary-color, #0b6ba8));
			padding-top: 0.4375rem;
			border-radius: 0.1875rem;
			padding-left: 0.25rem;
		}
		.simulator-container.default-style .field-container.choice:not([data-expanded='true']) > .field-group:hover::after,
		.simulator-container.default-style .field-container.department:not([data-expanded='true']) > .field-group:hover::after,
		.simulator-container.default-style .field-container.day:not([data-expanded='true']) > .field-group:hover::after, 
		.simulator-container.default-style .field-container.month:not([data-expanded='true']) > .field-group:hover::after,
		.simulator-container.default-style .field-container.year:not([data-expanded='true']) > .field-group:hover::after { 
			background-color: var(--color, var(--primary-color, #0b6ba8));
			color: #fff;
		}
		.simulator-container.default-style .help-panel {
			margin-top: 0.7em;
			margin-bottom: 1em;
			padding: 0.4em;
			position: relative;
			max-width: 100%;
			padding: .5em;
			border: 1px solid #ccc;
			border-radius: 3px;
			clear: both;
		}
		.simulator-container.default-style .simulator-description p {
			line-height: 1em;
		}
		}
		.simulator-container.default-style .help-panel p{
			line-height: 0.5em;
		}
		.simulator-container.default-style fieldset {
			border: none;
		}
		.simulator-container.default-style input:focus,
		.simulator-container.default-style select:focus,
		.simulator-container.default-style textarea:focus {
			border-color: #66afe9;
			outline: 0;
			-webkit-box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, .6);
				  box-shadow: inset 0 1px 1px rgba(0,0,0,.075), 0 0 8px rgba(102, 175, 233, .6);
		}
		.simulator-container.default-style fieldset > legend {
			font-size: 1.2em;
			font-weight: bold;
			display: block;
			width: 100%;
			padding: 0;
			line-height: inherit;
			border: none;
			color: var(--color, var(--primary-color, #0b6ba8));
			border-bottom: 3px solid;
			margin: 0 0 0.8em;
			width: 100%;
		}
		.simulator-container.default-style .disposition-classic fieldset.choices.numerous label,
		.simulator-container.default-style .disposition-classic fieldset.choices.long label {
			display: inline-block;
			width: 100%;
		}
		.simulator-container.default-style .step-panels-list > li.active > a,
		.simulator-container.default-style .step-panels-list > li.active > a:hover,
		.simulator-container.default-style .step-panels-list > li.active > a:focus {
			background-color: var(--color, var(--primary-color, #0b6ba8));
			border-image: none;
			border-style: solid;
			border-width: 1px;
			color: #fff;
			cursor: default;
		}
		.simulator-container.default-style ul.step-panels-list li {
			padding-left: 0;
			display: table-cell;
			position: relative;
			list-style-type: none;
			margin-right: .2em;
			margin-bottom: -1px;
		}
		.simulator-container.default-style ul.step-panels-list li:before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			font-size: 1.3em;
		}
		.simulator-container.default-style .step-panels-list> li > a {
			background-color: #ececec;
			border-color: #ccc #ccc transparent;
			border-image: none;
			border-radius: 5px 5px 0 0;
			border-style: solid;
			border-width: 1px 1px 0;
			font-size: 1.14286em;
			margin-right: 5px;
			color: #000;
			text-decoration: none;
			padding: 0 6px;
		}
		.simulator-container.default-style .step-panels-list > li:not(.active) > a:hover {
			border-color: #ccc #ccc var(--color, var(--primary-color, #0b6ba8));
			text-decoration: underline;
		}
		.simulator-container.default-style .step-panels-list {
			list-style-type: none;
			border-bottom: 2px solid var(--color, var(--primary-color, #0b6ba8));
			margin: 0;
			padding: 0;
			overflow: visible;
		}
		.simulator-container.default-style .step-panels-content {
			margin-bottom: 1em;
			padding: 2em 0 0;
		}
		.simulator-container.default-style .step-panels-list::after {
			clear: both;
		}
		.simulator-container.default-style .step-panels-list::before,
		.simulator-container.default-style .step-panels-list::after {
			content: ' ';
			display: table;
			line-height: 1;
			text-transform: none;
			font-family: 'fonticon';
			font-weight: normal;
			font-style: normal;
			font-variant: normal;
			font-size: 14px;
			speak: none;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}
		.simulator-container.default-style .field-container {
			margin-bottom: 1rem;
		}
		.simulator-container.default-style .field-container:not(.underlabel) > label {
			width: 40%;
			display: inline-block;
			text-align: right;
		}
		.simulator-container.default-style .field-container > span.label {
			width: 40%;
			display: inline-block;
		}
		.simulator-container.default-style .field-container.underlabel > label {
			width: 100%;
			display: inline-block;
		}
		.simulator-container.default-style .field-container > .field-group {
			display: inline-block;
		}
	`;

	var profiles = `
		.simulator-container.default-style .profiles {
		}
		.simulator-container.default-style .profiles > p {
			font-weight: bold;
			font-size: 1.2em;
		}
		.simulator-container.default-style .profiles ul {
			width: 100%;
			margin-bottom: 1em;
		}
		.simulator-container.default-style .profiles ul li{
			display: inline-block;
			padding-left: 5px;
			padding-right: 5px;
			width: 10%;
			min-height: 6em;
			vertical-align: middle;
			text-align: center;
			border: 1px solid var(--primary-color, #0b6ba8);
			float: none;
			align-items: center;
			position: relative;
			background-color: #fff;
			border-radius: 4px;
			cursor: pointer;
		}
		.simulator-container.default-style .profiles ul li.active {
			background-color: #0b6ba8;
			color: #fff;
		}
		.simulator-container.default-style .profiles ul li:hover:not(.active){
			background-color: #d9d9d9;
		}
		.simulator-container.default-style .profiles ul li.active::after {
			border-left: 7px solid transparent;
			border-right: 7px solid transparent;
			border-top: 10px solid var(--primary-color, #0b6ba8);
			content: '';
			height: 0;
			left: 44%;
			position: absolute;
			top: 98%;
			width: 0;
		}
		.simulator-container.default-style .profiles ul li a{
			text-decoration: none;
			height: 100%;
			width: 100%
		}
		.simulator-container.default-style .profiles ul li a:hover {
			background-color: transparent;
		}
	`;

	var breadcrumb = `
		.simulator-container .simulator-breadcrumb {
			display: inline-block;
			margin: 0;
			padding: 0;
			list-style: none;
			border: 0;
			height: 4rem;
			width: 100%;
			overflow: hidden;
		}
		.simulator-container .simulator-breadcrumb ol {
			display: table;
			padding: 0;
			width: 100%;
		}
		.simulator-container .simulator-breadcrumb li p {
			position: relative;
			display: block;
			margin: 0 10px 0 0;
			padding: 0px 0px 15px 35px;
			height: 50px;
			text-decoration: none;
			color: #000;
			background: var(--secondary-color, #ececec);
		}
		.simulator-container .simulator-breadcrumb li p:first-child {
			border-top-left-radius: 4px;
			border-bottom-left-radius: 4px;
		}
		.simulator-container .simulator-breadcrumb li p:last-child {
			border-top-right-radius: 4px;
			border-bottom-right-radius: 4px;
		}
		.simulator-container .simulator-breadcrumb li {
			display: table-cell;
		}
		.simulator-container .simulator-breadcrumb li:first-child p:before {
			display: none;
		}
		.simulator-container .simulator-breadcrumb li:last-child p {
			margin: 0;
		}
		.simulator-container .simulator-breadcrumb li:last-child p:after {
			height: 100%;
			border: 0;
			background: var(--color, var(--primary-color, #0b6ba8));
		}
		.simulator-container .simulator-breadcrumb li.current.current p {
			color: #fff;
			background: var(--color, var(--primary-color, #0b6ba8));
		}
		.simulator-container .simulator-breadcrumb li.current:last-child p:after {
			background: #fff;
		}
		.simulator-container .simulator-breadcrumb li p:after {
			position: absolute;
			content: '';
			top: 0;
			right: -1.5rem;
			border-top: 1.5625rem solid transparent;
			border-bottom: 1.5625rem solid transparent;
			border-left: 1.5625rem solid var(--secondary-color, #ececec);
			z-index: 1;
		}
		.simulator-container .simulator-breadcrumb li.current p:after {
			border-left-color: var(--color, var(--primary-color, #0b6ba8));
		}
		.simulator-container .simulator-breadcrumb li p:before {
			position: absolute;
			content: '';
			top: 0;
			left: 0;
			border-top: 1.5625rem solid transparent;
			border-bottom: 1.5625rem solid transparent;
			border-left: 1.5625rem solid #fff;
		}
		.simulator-container .simulator-breadcrumb li p span {
			display: inline-block;
			vertical-align: middle;
		}
		.simulator-container .simulator-breadcrumb li p span:first-child {
			font-size: 2.6em;
			font-weight: bold;
		}
		@media (max-width: 37em) {
			.simulator-container .simulator-breadcrumb li:not(.current) p span:nth-child(2) {
				display: none;
			}
			.simulator-container .simulator-breadcrumb li p span:first-child {
				margin-left: .5em;
			}
			.simulator-container .simulator-breadcrumb li p {
				padding-left: 15px;
			}
			.simulator-container .simulator-breadcrumb li:first-child p {
				text-align: left;
			}
		}
	`;

	var grid = `
		.simulator-container.default-style .grid {
			display: table;
			width: 100%;
			border-spacing: 0;
			border-collapse: collapse;
		}
		.simulator-container.default-style table {
			width: 100%;
			border-spacing: 0;
			border-collapse: collapse;
		}
		.simulator-container .grid th,
		.simulator-container .grid td {
			text-align: center;
			vertical-align: middle;
			border: 1px solid #cccccc;
			padding: 0;
		}
		.simulator-container .grid .grid-header {
			color: #fff;
			background-color: var(--color, var(--primary-color, #0b6ba8));
		}
		.simulator-container .grid .grid-header a:visited{
			color: #fff;
		}
		.simulator-container .grid .grid-header > div {
			border-right-color: #fff;
			border-left-color: #fff;
		}
		.simulator-container .grid > div {
			display: table-row;
		}
		.simulator-container .grid > div:nth-child(2n) {
			background: #fff;
		}
		.simulator-container .grid tbody tr:nth-child(4n  + 3),
		.simulator-container tbody tr:nth-child(4n  + 4) {
			background: #ececec;
		}
		.simulator-container .grid > div > div {
			display: table-cell;
			text-align: center;
			vertical-align: middle;
			border: 1px solid #cccccc;
		}
		.simulator-container .grid td label {
			display: none !important;
		}
		.simulator-container .grid-header th:first-child {
			border-right: 1px solid #fff;
			border-top-left-radius: 8px;
		}
		.simulator-container .grid-header th:not(:first-child):not(:last-child) {
			border-left: none;
			border-right: 1px solid #fff;
		}
		.simulator-container .grid-header th:last-child {
			border-left: none;
			border-top-right-radius: 8px;
		}
		.simulator-container .grid .row-group-error {
			display: table-row;
		}
		.simulator-container .grid .row-group-error div:nth-child(2) {
			width: 0;
		}
		.simulator-container .grid > div:first-child div:not(:first-child) {
			font-weight: bold;
			text-align: center;
		}
		.simulator-container .grid > div:first-child div:nth-child(2) {
			width: 110px;
		}
		.simulator-container .grid > div:first-child div:nth-child(3) {
			margin-right: 50px;
			width: 72px;
		}
		.simulator-container .grid > div:first-child div:nth-child(4) {
			width: 50px;
		}
		.simulator-container .grid > div:first-child div:nth-child(5),
		.simulator-container .grid > div:first-child div:nth-child(6) {
			width: 60px;
		}
		.simulator-container .grid > div:not(:first-child) div {
			font-weight: normal;
		}
		.simulator-container .grid > div:not(:first-child) div > span.output {
			padding-bottom: 9px;
		}
		.simulator-container .grid > div:not(:first-child) div:nth-child(5),
		.simulator-container .grid > div:not(:first-child) div:nth-child(6) {
			padding-bottom: 2px;
			padding-left: 8px;
		}
		.simulator-container .grid-header th {
			background: var(--color, var(--primary-color, #0b6ba8));
		}
		media (min-width: 37em) {
			.simulator-container.default-style label,
			.simulator-container.default-style .label {
				padding-right: 10px;
				width: 50%;
				text-align: right;
			}
		}
		.nav-top .container {
			padding-left: 0px;
			padding-right: 0px;
		}
		@media only screen and (max-width: 41.13em) {
			.simulator-container table.grid,
			.simulator-container table.grid thead,
			.simulator-container table.grid tbody,
			.simulator-container table.grid tr,
			.simulator-container table.grid th,
			.simulator-container table.grid td { 
				display: block; 
			}
			.simulator-container .grid ,
			.simulator-container .grid .grid-header,
			.simulator-container .grid > div > div,
			.simulator-container .grid > div { 
				display: block; 
			}
			.simulator-container .grid .grid-header { 
				position: absolute;
				top: -9999px;
				left: -9999px;
			}
			.simulator-container table.grid thead  tr { 
				position: absolute;
				top: -9999px;
				left: -9999px;
			}
			.simulator-container .grid tbody th {
				border-right: 1px solid #cccccc;
			}
			.simulator-container .grid tbody th,
			.simulator-container .grid: tbody td {
				border-top: none;
			}
			.simulator-container .grid > div { border: 1px solid #ccc; }
			.simulator-container table.grid tr { border: 1px solid #ccc; }
			.simulator-container .grid > div > div,
			.simulator-container table.grid td  { 
				border: none;
				border-bottom: 1px solid #eee; 
				position: relative;
				padding-left: 50%; 
				padding-right: 10px; 
				text-align: right;
			}
			.simulator-container table.grid tr:nth-child(2n ) td  { 
				padding-left: 0; 
			}
			.simulator-container table.grid tr:nth-child(2n ) td  .has-error { 
				text-align: left;
			}
			.simulator-container .grid > div > div  .output,
			.simulator-container table.grid td .output {
				padding-top: 5px;
			}
			.simulator-container .grid > div > div:before,
			.simulator-container table.grid tr:nth-child(2n + 1) td:before  { 
				position: absolute;
				top: 6px;
				left: 6px;
				width: 45%; 
				padding-right: 10px; 
				white-space: nowrap;
			}
			.simulator-container .grid > div > div:nth-of-type(1),
			.simulator-container table.grid th {
				font-weight: bold;
				text-align: center;
				padding: 0;
				background-color: var(--color, var(--primary-color, #0b6ba8));
				color: #FFF;
			}
			.simulator-container .grid > div > div:nth-of-type(2):before { content: attr(data-label); }
			.simulator-container .grid > div > div:nth-of-type(3):before { content: attr(data-label); }
			.simulator-container .grid > div > div:nth-of-type(4):before { content: attr(data-label); }
			.simulator-container .grid > div > div:nth-of-type(5):before { content: attr(data-label); }
			.simulator-container .grid > div > div:nth-of-type(6):before { content: attr(data-label); }
			.simulator-container .grid > div > div:nth-of-type(7):before { content: attr(data-label); }
			.simulator-container .grid > div > div:nth-of-type(8):before { content: attr(data-label); }
			.simulator-container table.grid tr:nth-child(2n + 1) td:nth-of-type(1):before { content: attr(data-label); }
			.simulator-container table.grid tr:nth-child(2n + 1) td:nth-of-type(2):before { content: attr(data-label); }
			.simulator-container table.grid tr:nth-child(2n + 1) td:nth-of-type(3):before { content: attr(data-label); }
			.simulator-container table.grid tr:nth-child(2n + 1) td:nth-of-type(4):before { content: attr(data-label); }
			.simulator-container table.grid tr:nth-child(2n + 1) td:nth-of-type(5):before { content: attr(data-label); }
			.simulator-container table.grid tr:nth-child(2n + 1) td:nth-of-type(6):before { content: attr(data-label); }
			.simulator-container table.grid tr:nth-child(2n + 1) td:nth-of-type(7):before { content: attr(data-label); }
		}
	`;

	var blockinfo = `
		.simulator-container.default-style .blockinfo-label {
			margin: 0 0 1em 0;
			padding: 1.5em 0 0;
			text-transform: none;
		}
		.simulator-container.default-style .blockinfo-label h2 {
			background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
			color: var(--color, var(--primary-color, #0b6ba8));
			padding: 0;
			border: 0;
			border-bottom: 3px solid;
			margin: 0 0 0.8em 0;
			font-size: 1.2em;
			font-weight: bold;
			line-height: inherit;
			width: 100%;
		}
		.simulator-container.default-style  .panels-content {
			margin-bottom: 1em;
			padding: 2em 0 0;
		}
		.simulator-container.default-style .blockinfo-chapters,
		.simulator-container.default-style .section-content,
		.simulator-container.default-style .section-annotations {
			border: 1px solid #ccc;
			border-radius: 3px;
		}
		.simulator-container.default-style .blockinfo-chapters,
		.simulator-container.default-style .section-annotations {
			margin-bottom: 3em;
		}
		.simulator-container.default-style .section-content {
			margin-bottom: 1em;
		}
		.simulator-container.default-style .section-body,
		.simulator-container.default-style .chapter {
			clear: both;
		}
		.simulator-container.default-style .section-content {
			background-color: #eee;
			padding: .5em;
			height: 100%;
			position: relative;
		}
		.simulator-container.default-style .section-content p {
			margin-bottom: 0;
		}
		.simulator-container.default-style .section-content.with-annotations::after {
			border-bottom: 13px solid transparent;
			border-left: 25px solid #eee;
			border-top: 13px solid transparent;
			content: '';
			height: 0;
			left: 100%;
			position: absolute;
			top: 9px;
			width: 0;
		}
		.simulator-container.default-style .section-annotations {
			width: 45%;
			margin-left: 1em;
			padding: .5em;
			float: right;
		}
		.simulator-container.default-style .section-annotations:before {
			content: '\\e61c';
			position: relative;
			top: 1px;
			display: inline-block;
			font-family: 'fonticon';
			font-style: normal;
			font-weight: normal;
			float:left;
			line-height: 1;
			margin-right: 1em;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		 }
		.simulator-container.default-style .chapter {
			margin-bottom: 0;
			border: 0;
			border-bottom: 1px solid #ccc;
		}
		.simulator-container.default-style .chapter-label {
			margin: 0;
			padding: 0;
			text-transform: uppercase;
		}
		.simulator-container.default-style .chapter-label h3 {
			font-size: 1em;
			margin: 0.3em 0;
			font-weight: 400;
			line-height: 1.1;
		}
		.simulator-container.default-style .chapter-label h3 button {
			overflow: visible;
			text-transform: none;
			font-weight: normal;
			font-size: 1em;
			line-height: 1.5;
			border-radius: 4px;
			white-space: normal;
			position: relative;
			display: inline-block;
			margin: 0 .5em;
			padding: 0;
			width: calc(100% - 1em);
			text-align: left;
			color: #414856;
			border: 0;
			background: transparent;
			text-decoration: none;
			vertical-align: middle;
			cursor: pointer;
		}
		.simulator-container.default-style .chapter-label h3 button::before,
		.simulator-container.default-style .chapter-label h3 button::after {
			line-height: 1;
			text-transform: none;
			font-family: 'fonticon';
			font-weight: normal;
			font-style: normal;
			font-variant: normal;
			font-size: 14px;
			speak: none;
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}
		.simulator-container.default-style .chapter-label h3 button::after {
			position: absolute;
			top: 0.2em;
			right: .3em;
			padding: .5em;
			color: var(--color, #0b6ba8);
			border: 1px solid var(--color, var(--primary-color, #0b6ba8));
			border-radius: 3px;
			background: #fff;
		}
		.simulator-container.default-style .chapter-label h3 button:hover::after {
			background: var(--color, var(--primary-color, #0b6ba8));
			color: #fff;
		}
		.simulator-container.default-style .chapter-label h3 button[aria-expanded='false']::after {
			content: '\\e608';
		}
		.simulator-container.default-style .chapter-label h3 button[aria-expanded='true']::after {
			content: '\\e60a';
		}
		.simulator-container.default-style .chapter-label h3 span {
			font-size: 1.42857em;
			font-weight: normal;
		}
		.simulator-container.default-style .chapter-label h3 button:hover, 
		.simulator-container.default-style .chapter-label h3 button:focus {
			color: var(--color, var(--primary-color, #0b6ba8));
			text-decoration: none;
		}
	`;

	var expand = `
		.simulator-container.default-style .collapse-expand-all-tools > button {
			display: inline-block;
			margin-bottom: 0;
			font-weight: normal;
			text-align: center;
			vertical-align: middle;
			cursor: pointer;
			background-image: none;
			border: 1px solid transparent;
			white-space: nowrap;
			padding: 6px 12px;
			font-size: 1em;
			line-height: 1.5;
			border-radius: 4px;
			overflow: visible;
			text-transform: none;
			background: rgba(0, 0, 0, 0) none repeat scroll 0 0;
			padding-right: 1.8em;
			position: relative;
			text-decoration: underline;
		}
		.simulator-container.default-style .collapse-expand-all-tools {
			margin-bottom: -3em;
			text-align: right;
		}
		.simulator-container.default-style .collapse-expand-all-tools > button::before, 
		.simulator-container.default-style .collapse-expand-all-tools > button::after {
			font-family: fonticon;
			font-style: normal;
			font-variant: normal;
			font-weight: 400;
			line-height: 1;
			text-transform: none;
		}
		.simulator-container.default-style .collapse-expand-all-tools > button:first-child::after {
			content: '';
		}
		.simulator-container.default-style .collapse-expand-all-tools > button:last-child::after {
			content: '';
		}
		.simulator-container.default-style .collapse-expand-all-tools > button::after {
			background-color: var(--color, var(--primary-color, #0b6ba8));
			border-radius: 3px;
			color: #fff;
			font-size: 0.65em;
			padding: 0.5em;
			position: absolute;
			right: 0;
			top: 0.7em;
		}
	`;

	var buttons = `
		.simulator-container.default-style .actionbuttons button {
			display: inline-block;
			margin: 0 0 1em 1em;
			font-size: 1.2em;
			font-weight: normal;
			border: 1px solid var(--primary-color, #0b6ba8);
			white-space: nowrap;
			padding: 6px 12px;
			line-height: 1.5;
			border-radius: 4px;
			text-transform: none;
			text-decoration: none;
			text-align: center;
			cursor: pointer;
			overflow: visible;
		}

		.simulator-container.default-style .actionbuttons button.btn-primary {
			color: #fff;
			background-color: var(--primary-color, #0b6ba8);
			float: right;
		}

		.simulator-container.default-style .actionbuttons button.btn-default {
			color: var(--primary-color, #0b6ba8);
			background-color: #fff;
			float: left;
		}
		.simulator-container.default-style .actionbuttons button:hover {
			filter: brightness(75%);
		}
	`;

	var widgets = `
	`;

	var functions = `
	`;

	window.addEventListener('DOMContentLoaded', function(event) {
		var head = document.querySelector('head');
		var style = head.querySelector('style');
		if (style === null) {
			var firstLink = head.querySelector('link[rel=stylesheet][href]');
			if (null !== firstLink) {
				style = head.insertBefore(document.createElement('style'), firstLink);
			} else {
				style = head.appendChild(document.createElement('style'));
			}
		}
		var css = icons + general + preloader + profiles + breadcrumb + grid + blockinfo + expand + buttons + widgets + functions;
		if (style.firstElementChild == null) {
			style.appendChild(document.createTextNode(css));
		} else {
			style.insertBefore(document.createTextNode(css), style.firstElementChild);
		}
	});

}(document, window));

(function (global) {
	'use strict';

	var translations = {
		'messages': {
			'fr': {
				"d": "JJ",
				"d-m-y": "JJ-MM-AA",
				"d-m-Y": "JJ-MM-AAAA",
				"d.m.Y": "JJ.MM.AAAA",
				"d. m. Y": "JJ. MM. AAAA",
				"d.m.Y.": "JJ.MM.AAAA.",
				"d/m/y": "JJ/MM/AA",
				"d/m/Y": "JJ/MM/AAAA",
				"d/m Y": "JJ/MM AAAA",
				"m": "MM",
				"m-d": "MM-JJ",
				"m-d-Y": "MM-JJ-AAAA",
				"m/d": "MM/JJ",
				"m/d/Y": "MM/JJ/AAAA",
				"m/y": "MM/AA",
				"m/Y": "MM/AAAA",
				"y": "AA",
				"Y": "AAAA",
				"y-m": "AA-MM",
				"Y-m": "AAAA-MM",
				"Y-m-d": "AAAA-MM-JJ",
				"y-m-d": "AA-MM-JJ",
				"Y. m. d.": "AAAA. MM. JJ",
				"Y/m/d": "AAAA/MM/JJ",
				"numbers only": "chiffres uniquement",
				"amount": "montant",
				"percentage": "pourcentage",
				"This value is not in the expected format": "Cette valeur n'est pas au format attendu",
				"The '%field%' field is required": "Le champ '%field%' est obligatoire",
				"The length of the field '%field%' cannot be less than %min%": "La longueur du champ '%field%' ne peut pas tre infrieure  %min%",
				"The value of the field '%field%' cannot be less than %min%": "La valeur du champ '%field%' ne peut pas tre infrieure  %min%",
				"The length of the field '%field%' cannot be greater than %max%": "La longueur du champ '%field%' ne peut pas tre suprieure  %max%",
				"The value of the field '%field%' cannot be greater than %max%": "La valeur du champ '%field%' ne peut pas tre suprieure  %max%",
				"Data to continue this simulation are not accessible. Please try again later.": "Les donnes pour continuer cette simulation ne sont pas accessibles. Veuillez ressayer ultrieurement.",
				"This value is not in the expected format": "Cette valeur n'est pas au format attendu",
				"The length of this value can not be less than %min%": "La longueur de cette valeur ne peut pas tre infrieure  %min%",
				"This value can not be less than %min%": "Cette valeur ne peut pas tre infrieure %min%",
				"The length of this value can not be greater than %max%": "La longueur de cette valeur ne peut pas tre suprieure  %max%",
				"This value can not be greater than %max%": "Cette valeur ne peut pas tre suprieure  %max%",
				"To continue you must first correct your entry": "Pour continuer, vous devez d'abord corriger votre saisie",
				"Steps of your simulation": "Les tapes de votre simulation",
				"Current step : %step%": "tape courante : %step%",
				"Simulator server takes too long to respond": "Le serveur de simulateurs met trop de temps  rpondre"
			},
			'es': {
				"d": "dd",
				"d-m-y": "dd-mm-aaaa",
				"d-m-Y": "dd-mm-aaaa",
				"d.m.Y": "dd.mm.aaaa",
				"d. m. Y": "dd. mm. aaaa",
				"d.m.Y.": "dd.mm.aaaa.",
				"d/m/y": "dd/mm/aaaa",
				"d/m/Y": "dd/mm/aaaa",
				"d/m Y": "dd/mm aaaa",
				"m": "m",
				"m-d": "mm-dd",
				"m-d-Y": "mm-dd-aaaa",
				"m/d": "mm/dd",
				"m/d/Y": "mm/dd/aaaa",
				"m/y": "mm/aaaa",
				"m/Y": "mm/aaaa",
				"y": "aaaa",
				"Y": "AAAA",
				"y-m": "aaaa-mm",
				"Y-m": "aaaamm",
				"Y-m-d": "aaaa-mm-dd",
				"y-m-d": "aaaa-mm-dd",
				"Y. m. d.": "aaaa. mm. dd.",
				"Y/m/d": "aaaa/mm/dd",
				"numbers only": "solo numeros",
				"amount": "cantidad",
				"percentage": "porcentaje",
				"This value is not in the expected format": "Este valor no tiene el formato esperado",
				"The '%field%' field is required": "El campo '%field%' es obligatorio",
				"The length of the field '%field%' cannot be less than %min%": "La longitud del campo '%field%' no puede ser inferior a %min%",
				"The value of the field '%field%' cannot be less than %min%": "El valor del campo '%field%' no puede ser menor que %min%",
				"The length of the field '%field%' cannot be greater than %max%": "La longitud del campo '%field%' no puede ser mayor que %max%",
				"The value of the field '%field%' cannot be greater than %max%": "El valor del campo '%field%' no puede ser mayor que %max%",
				"Data to continue this simulation are not accessible. Please try again later.": "No se puede acceder a los datos para continuar con esta simulacin. Vuelva a intentarlo ms tarde.",
				"This value is not in the expected format": "Este valor no tiene el formato esperado",
				"The length of this value can not be less than %min%": "La longitud de este valor no puede ser inferior a %min%",
				"This value can not be less than %min%": "Este valor no puede ser inferior a %min%",
				"The length of this value can not be greater than %max%": "La longitud de este valor no puede ser mayor que %max%",
				"This value can not be greater than %max%": "Este valor no puede ser mayor que %max%",
				"To continue you must first correct your entry": "Para continuar primero debes corregir tu entrada",
				"Steps of your simulation": "Pasos de tu simulacin",
				"Current step : %step%": "Paso actual : %step%",
				"Simulator server takes too long to respond": "El servidor del simulador tarda demasiado en responder"
			},
			'pt': {
				"d": "dd",
				"d-m-y": "dd-mm-aaaa",
				"d-m-Y": "dd-mm-aaaa",
				"d.m.Y": "dd.mm.aaaa",
				"d. m. Y": "dd. mm. aaaa",
				"d.m.Y.": "dd.mm.aaaa",
				"d/m/Y": "dd/mm/aaaa",
				"d/m/y": "dd/mm/aaaa",
				"d/m Y": "dd/mm aaaa",
				"m": "mm",
				"m-d": "mm-dd",
				"m-d-Y": "mm-dd-aaaa",
				"m/d": "mm/dd",
				"m/d/Y": "mm/dd/aaaa",
				"m/Y": "mm/aaaa",
				"m/y": "mm/aaaa",
				"y": "aaaa",
				"Y": "aaaa",
				"y-m": "aaaa-mm",
				"Y-m": "aaaa-mm",
				"Y-m-d": "aaaa-mm-dd",
				"y-m-d": "aaaa-mm-dd",
				"Y. m. d.": "aaaa. mm. dd.",
				"Y/m/d": "aaaa/mm/dd",
				"numbers only": "Apenas nmeros",
				"amount": "montante",
				"percentage": "percentagem",
				"This value is not in the expected format": "Este valor no est no formato esperado",
				"The '%field%' field is required": "O campo '%field%'  obrigatrio",
				"The length of the field '%field%' cannot be less than %min%": "O comprimento do campo '%field%' no pode ser inferior a %min%",
				"The value of the field '%field%' cannot be less than %min%": "O valor do campo '%field%' no pode ser inferior a %min%",
				"The length of the field '%field%' cannot be greater than %max%": "O comprimento do campo '%field%' no pode ser maior que %max%",
				"The value of the field '%field%' cannot be greater than %max%": "O valor do campo '%field%' no pode ser maior que %max%",
				"Data to continue this simulation are not accessible. Please try again later.": "Os dados para continuar esta simulao no esto acessveis. Por favor, tente novamente mais tarde.",
				"This value is not in the expected format": "Este valor no est no formato esperado",
				"The length of this value can not be less than %min%": "O comprimento deste valor no pode ser inferior a %min%",
				"This value can not be less than %min%": "Este valor no pode ser inferior a%min%",
				"The length of this value can not be greater than %max%": "O comprimento deste valor no pode ser maior que %max%",
				"This value can not be greater than %max%": "Este valor no pode ser maior que %max%",
				"To continue you must first correct your entry": "Para continuar, voc deve primeiro corrigir sua entrada",
				"Steps of your simulation": "Etapas de sua simulao",
				"Current step : %step%": "Etapa atual : %step%",
				"Simulator server takes too long to respond": "O servidor do simulador demora muito para responder"
			},
			'it': {
				"d": "d",
				"d-m-y": "dmy",
				"d-m-Y": "DMY",
				"d.m.Y": "DMY",
				"d. m. Y": "dm Y",
				"d.m.Y.": "DMY",
				"d/m/y": "d/m/y",
				"d/m/Y": "d/m/Y",
				"d/m Y": "d/m Y",
				"m": "m",
				"m-d": "md",
				"m-d-Y": "MDY",
				"m/d": "m/d",
				"m/d/Y": "m/d/Y",
				"m/Y": "mio",
				"m/y": "mio",
				"y": "y",
				"Y": "Y",
				"Y-m": "Ym",
				"y-m": "YM",
				"y-m-d": "ymd",
				"Y-m-d": "ymd",
				"Y. m. d.": "Y. md",
				"Y/m/d": "Y/m/d",
				"numbers only": "solo numeri",
				"amount": "quantit",
				"percentage": "percentuale",
				"This value is not in the expected format": "Questo valore non  nel formato previsto",
				"The '%field%' field is required": "Il campo '%field%'  obbligatorio",
				"The length of the field '%field%' cannot be less than %min%": "La lunghezza del campo '%field%' non pu essere inferiore a %min%",
				"The value of the field '%field%' cannot be less than %min%": "Il valore del campo '%field%' non pu essere inferiore a %min%",
				"The length of the field '%field%' cannot be greater than %max%": "La lunghezza del campo '%field%' non pu essere maggiore di %max%",
				"The value of the field '%field%' cannot be greater than %max%": "Il valore del campo '%field%' non pu essere maggiore di %max%",
				"Data to continue this simulation are not accessible. Please try again later.": "I dati per continuare questa simulazione non sono accessibili. Riprova pi tardi.",
				"This value is not in the expected format": "Questo valore non  nel formato previsto",
				"The length of this value can not be less than %min%": "La lunghezza di questo valore non pu essere inferiore a %min%",
				"This value can not be less than %min%": "Questo valore non pu essere inferiore a %min%",
				"The length of this value can not be greater than %max%": "La lunghezza di questo valore non pu essere maggiore di %max%",
				"This value can not be greater than %max%": "Questo valore non pu essere maggiore di %max%",
				"To continue you must first correct your entry": "Per continuare devi prima correggere la tua voce",
				"Steps of your simulation": "Fasi della tua simulazione",
				"Current step : %step%": "Passaggio corrente : %step%",
				"Simulator server takes too long to respond": "Il server del simulatore impiega troppo tempo per rispondere"
			}
		}
	};

	function Translator() {
	};

	Translator.locale = 'en';
	
	Translator.trans = function (message, params, domain) {
		domain = domain || 'messages';
		if (translations[domain]) {
			var messages = translations[domain];
			var locale = Translator.locale.substr(0, 2);
			if (messages[locale] && messages[locale][message]) {
				message = messages[locale][message];
			}
			if (typeof params != "undefined") {
				for (var param in params) {
					var value = params[param];
					message = message.replace('%' + param + '%', value);
				}
			}
		}
		return message;
	};

	global.Translator = Translator;
}(this));

// https://github.com/fdaciuk/ajax
;(function (root, factory) {
	'use strict';

	if (typeof define === 'function' && define.amd) {
		define('ajax', factory);
	} else if (typeof exports === 'object') {
		exports = module.exports = factory();
	} else {
		root.ajax = factory();
	}
})(this, function () {
	'use strict';

	function ajax (options) {
		var methods = ['get', 'post', 'put', 'delete'];
		options = options || {};
		options.baseUrl = options.baseUrl || '';
		if (options.method && options.url) {
			return xhrConnection(
				options.method,
				options.baseUrl + options.url,
				maybeData(options.data),
				options
			);
		}
		return methods.reduce(function (acc, method) {
			acc[method] = function (url, data) {
				return xhrConnection(
					method,
					options.baseUrl + url,
					maybeData(data),
					options
				);
			}
			return acc;
		}, {});
	}

	function maybeData (data) {
		return data || null;
	}

	function xhrConnection (type, url, data, options) {
		var returnMethods = ['then', 'catch', 'always'];
		var promiseMethods = returnMethods.reduce(function (promise, method) {
			promise[method] = function (callback) {
				promise[method] = callback;
				return promise;
			}
			return promise;
		}, {});
		var xhr = new XMLHttpRequest();
		var featuredUrl = getUrlWithData(url, data, type);
		xhr.open(type, featuredUrl, true);
		if (options.dataType) {
			xhr.responseType = options.dataType;
		}
		xhr.withCredentials = options.hasOwnProperty('withCredentials');
		setHeaders(xhr, options.headers, data);
		xhr.addEventListener('readystatechange', ready(promiseMethods, xhr), false);
		xhr.addEventListener('timeout', function() {
			promiseMethods.catch.apply(promiseMethods, parseResponse(xhr).splice(2, 1, 'timeout'));
		});
		xhr.send(objectToQueryString(data));
		promiseMethods.abort = function () {
			return xhr.abort();
		}
		return promiseMethods;
	}

	function getUrlWithData (url, data, type) {
		if (type.toLowerCase() !== 'get' || !data) {
			return url;
		}
		var dataAsQueryString = objectToQueryString(data);
		var queryStringSeparator = url.indexOf('?') > -1 ? '&' : '?';
		return url + queryStringSeparator + dataAsQueryString;
	}

	function setHeaders (xhr, headers, data) {
		headers = headers || {};
		if (!hasContentType(headers)) {
			headers['Content-Type'] = 'application/x-www-form-urlencoded';
		}
		Object.keys(headers).forEach((name) => {
			(headers[name] && xhr.setRequestHeader(name, headers[name]));
		})
	}

	function hasContentType (headers) {
		return Object.keys(headers).some(function (name) {
			return name.toLowerCase() === 'content-type';
		})
	}

	function ready (promiseMethods, xhr) {
		return function handleReady () {
			if (xhr.readyState === xhr.DONE) {
				xhr.removeEventListener('readystatechange', handleReady, false);
				promiseMethods.always.apply(promiseMethods, parseResponse(xhr));
				if (xhr.status >= 200 && xhr.status < 300) {
					promiseMethods.then.apply(promiseMethods, parseResponse(xhr));
				} else {
					promiseMethods.catch.apply(promiseMethods, parseResponse(xhr));
				}
			}
		}
	}

	function parseResponse (xhr) {
		var result;
		try {
			result = JSON.parse(xhr.response);
		} catch (e) {
			result = xhr.response || 'Parse response error';
		}
		return [ result, xhr, xhr.statusText ];
	}

	function objectToQueryString (data) {
		return isObject(data) ? getQueryString(data) : data;
	}

	function isObject (data) {
		return Object.prototype.toString.call(data) === '[object Object]';
	}

	function getQueryString (obj, prefix) {
		return Object.keys(obj).map(function (key) {
			if (obj.hasOwnProperty(key) && undefined !== obj[key]) {
				var val = obj[key];
				key = prefix ? prefix + '[' + key + ']' : key;
				return val !== null && typeof val === 'object' ? getQueryString(val, key) : encode(key) + '=' + encode(val);
			}
		})
		.filter(Boolean)
		.join('&');
	}

	function encode (value) {
		return encodeURIComponent(value);
	}

	return ajax;
});

(function (document, window) {
	'use strict';

	var cookie = {

		get: function(name) {
			if (!name) return;
			var parts = document.cookie.split(name + '=');
			if (parts.length === 2) return decodeURIComponent(parts.pop().split(';').shift());
			return;
		},

		create: function(name, value, params) {
			name = name || false; // test
			value = value || '';
			params.expires = params.expires || false;
			params.path = params.path || '/';
			if (name) {
				var cooky = encodeURIComponent(name) + '=' + encodeURIComponent(value) + ';';
				var path = 'path=' + params.path + ';';
				var domain = params.domain ? 'domain=' + params.domain + ';' : '';
				var secure = params.secure ? 'secure;' : '';
				var httpOnly = params.httpOnly ? 'httpOnly;' : '';
				var expires = '';
				if (params.expires) {
					params.expires = new Date(new Date().getTime() +
						parseInt(params.expires, 10) * 1000 * 60 * 60 * 24);
					expires = 'expires=' + params.expires.toUTCString() + ';';
				}
				document.cookie = cooky + expires + path + domain + secure + httpOnly;
				return true;
			}
			return false;
		},

		exists: function(name) {
			if (this.get(name)) return true;
			return false;
		},

		delete: function(params) {
			if (!params) return;
			if (this.get(params)) {
				return this.create({
					name: params.name,
					value: '',
					expires: -1,
					path: params.path,
					domain: params.domain
				});
			}
			return false;
		}

	}
	if (typeof define === 'function' && define.amd) {
		define([], function () {
			return cookie;
		});
	} else {
		window.cookie = cookie;
	}

}(document, window));

(function (document, window) {
	'use strict';

	const getCssPropUnitMap = (v) => {
		v = v.trim();
		const numParts = v.match('[0-9.]+');
		let unit = 'ms';
		let num;
		const numString = numParts ? numParts[0] : '';
		if (numString) {
			unit = v.split(numString)[1];
			num = Number(numString);
		}
		return { num, unit };
	};

	const convertCssTimeValueToMilliseconds = (val) => {
		const map = getCssPropUnitMap(val);
		const num = map ? map.num : undefined;
		if (!num) {
			return '';
		}
		const unit = val.replace(num + '', '');
		let value = num;
		if (unit === 's') {
			value = num * 1000;
		}
		return value + 'ms';
	};

	var getTransitionDuration = function(element) {
		const getJsPropName = (cssProp) => {
			return cssProp.replace(/-([a-z])/g, (letter) => {
				return letter[1].toUpperCase();
			});
		};
		const getCssComputedProperty = (prop) => {
			const style = window.getComputedStyle(element);
			return (style.getPropertyValue(prop) ||
				element.style[getJsPropName(prop)]);
		};
		const delayProp = getCssComputedProperty('transition-delay') || '0ms';
		const durationProp = getCssComputedProperty('transition-duration') || '0ms';
		const times = Array.isArray(durationProp) ? durationProp : [durationProp];
		const delay = Array.isArray(delayProp) ? delayProp : [delayProp];
		let highest = 0;
		let map;
		times.push.apply(times, delay); // account for delay
		times.forEach((value) => {
			value.split(',').forEach((v) => {
				v = convertCssTimeValueToMilliseconds(v);
				map = getCssPropUnitMap(v);
				if (map.num && map.num > highest) {
					highest = map.num;
				}
			});
		});
		return highest;
	}

	var waitForElementTransition = function (element) {
		const duration = getTransitionDuration(element);
		return new Promise((resolve) => {
			if (duration > 0) {
				setTimeout(() => {
					resolve(element);
				}, duration);
			}
			else {
				resolve(element);
			}
		});
	}

	var slide = {

		// Show an element
		down: function(element, callback, duration) {
			duration = duration || 0.3;
			element.style.overflowY = element.downoverflowY || 'visible';
			element.classList.remove('hidden'); 
			element.style.transition = 'height ' + duration + 's ease-in-out';
			element.style.height =  element.downheight || 'auto';
			waitForElementTransition(element).then(() => {
				element.style.transition = '';
				element.style.height = "";
				callback && callback.call(element, "complete");
			}, false);
		},

		// Hide an element
		up: function (element, callback, duration) {
			duration = duration || 0.3;
			if (!element.downheight) {
				element.downheight = element.scrollHeight + 'px';
			}
			if (!element.downoverflowY) {
				element.downoverflowY = element.style.overflowY || 'visible';
			}
			element.style.overflowY = "hidden";
			element.style.transition = 'height ' + duration + 's ease-in-out';
			element.style.height = "0px";
			waitForElementTransition(element).then(() => {
				element.style.transition = '';
				element.style.height = "";
				callback && callback.call(element, "complete");
			}, false);
		}

	}
	if (typeof define === 'function' && define.amd) {
		define([], function () {
			return slide;
		});
	} else {
		window.slide = slide;
	}

}(document, window));

/*
 * defiant.js [v2.2.3]
 * http://www.defiantjs.com
 * Copyright (c) 2013-2019 Hakan Bilgin <hbi@longscript.com>
 * License GNU AGPLv3
 */
(function(window, module) {
	'use strict';

	var defiant = {
		is_ie     : /(msie|trident)/i.test(navigator.userAgent),
		is_safari : /safari/i.test(navigator.userAgent),
		env       : 'production',
		xml_decl  : '<?xml version="1.0" encoding="utf-8"?>',
		namespace : 'xmlns:d="defiant-namespace"',
		tabsize   : 4,
		snapshots : {},
		node      : {},
		renderXml: function(template, data) {
			var processor = new window.XSLTProcessor(),
				span      = document.createElement('span'),
				tmpltXpath = '//xsl:template[@name="'+ template +'"]',
				temp = this.node.selectSingleNode(this.xsl_template, tmpltXpath);

			temp = this.node.selectSingleNode(this.xsl_template, tmpltXpath);
			temp.setAttribute('match', '/');
			processor.importStylesheet(this.xsl_template);
			span.appendChild(processor.transformToFragment(data, document));
			temp.removeAttribute('match');

			return span.innerHTML;
		},
		render: function(template, data) {
			var processor = new window.XSLTProcessor(),
				span      = document.createElement('span'),
				opt       = {match: '/'},
				tmpltXpath,
				scripts,
				temp,
				sorter;
			// handle arguments
			switch (typeof(template)) {
				case 'object':
					this.extend(opt, template);
					if (!opt.data) opt.data = data;
					break;
				case 'string':
					opt.template = template;
					opt.data = data;
					break;
				default:
					throw 'error';
			}
			opt.data = opt.data.nodeType ? opt.data : defiant.json.toXML(opt.data);
			tmpltXpath = '//xsl:template[@name="'+ opt.template +'"]';

			if (!this.xsl_template) this.gatherTemplates();

			if (opt.sorter) {
				sorter = this.node.selectSingleNode(this.xsl_template, tmpltXpath +'//xsl:for-each//xsl:sort');
				if (sorter) {
					if (opt.sorter.order) sorter.setAttribute('order', opt.sorter.order);
					if (opt.sorter.select) sorter.setAttribute('select', opt.sorter.select);
					sorter.setAttribute('data-type', opt.sorter.type || 'text');
				}
			}

			temp = this.node.selectSingleNode(this.xsl_template, tmpltXpath);
			temp.setAttribute('match', opt.match);
			processor.importStylesheet(this.xsl_template);
			span.appendChild(processor.transformToFragment(opt.data, document));
			temp.removeAttribute('match');

			if (this.is_safari) {
				scripts = span.getElementsByTagName('script');
				for (var i=0, il=scripts.length; i<il; i++) scripts[i].defer = true;
			}
			return span.innerHTML;
		},
		gatherTemplates: function() {
			var scripts = document.getElementsByTagName('script'),
				str     = '',
				i       = 0,
				il      = scripts.length;
			for (; i<il; i++) {
				if (scripts[i].type === 'defiant/xsl-template') str += scripts[i].innerHTML;
			}
			this.xsl_template = this.xmlFromString('<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xlink="http://www.w3.org/1999/xlink" '+ this.namespace +'>'+ str.replace(/defiant:(\w+)/g, '$1') +'</xsl:stylesheet>');
		},
		registerTemplate: function(str) {
			this.xsl_template = this.xmlFromString('<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:xlink="http://www.w3.org/1999/xlink" '+ this.namespace +'>'+ str.replace(/defiant:(\w+)/g, '$1') +'</xsl:stylesheet>');
		},
		getSnapshot: function(data, callback) {
			return this.json.toXML(data, callback || true);
		},
		createSnapshot: function(data, callback) {
			var that = this,
				snapshotId = 'snapshot_'+ Date.now();
			this.json.toXML(data, function(snapshot) {
				that.snapshots[snapshotId] = snapshot;
				callback(snapshotId);
			});
		},
		getFacets: function(data, facets) {
			var xml_org = (data.constructor === String && data.slice(0, 9) === 'snapshot_') ? this.snapshots[data].doc : defiant.json.toXML(data),
				xml_copy = xml_org.cloneNode(true),
				out = { 'a': function() { return 'b'; } },
				oCommon = {},
				weight = 0,
				len,
				batch = 50,
				heaviest,
				heaviest_children,
				heaviest_copy,
				common,
				key,
				getHeaviest = function(leaf) {
					var len = leaf.childNodes.length;
					switch (leaf.nodeType) {
						case 1:
							if (len >= weight) {
								weight = len;
								heaviest = leaf;
							}
						case 9:
							leaf.childNodes.map(function(item) {return getHeaviest(item)});
							break;
					}
				};
			// finds out heaviest node
			getHeaviest(xml_org);

			heaviest.childNodes.map(function(item) {
				if (!oCommon[item.nodeName]) oCommon[item.nodeName] = 1;
				oCommon[item.nodeName]++;
			});

			weight = 0;
			for (key in oCommon) {
				if (weight <= oCommon[key]) {
					weight = oCommon[key];
					common = key;
				}
			}

			// create facet template
			this.createFacetTemplate(facets);

			// empty clone heaviest children
			heaviest_copy = defiant.node.selectSingleNode(xml_copy, '//*[@d:mi="'+ heaviest.getAttribute('d:mi') +'"]');
			defiant.node.selectNodes(xml_copy, '//*[@d:mi="'+ heaviest.getAttribute('d:mi') +'"]/'+ common)
					.map(function(node) {return node.parentNode.removeChild(node)});

			heaviest_children = defiant.node.selectNodes(xml_org, '//*[@d:mi="'+ heaviest.getAttribute('d:mi') +'"]/'+ common);
			len = heaviest_children.length-1;

			heaviest_children.map(function(node, index) {
				heaviest_copy.appendChild(node.cloneNode(true));
				if (index % batch === batch-1 || index === len) {
					var pOutput = defiant.render('facets', xml_copy)
											.replace(/\n|\t/g, '')
											.replace(/"": 0,?/g, '')
											.replace(/,\}/g, '}'),
						partial = JSON.parse(pOutput);
					out = defiant.concatFacet(partial, out);
					defiant.node.selectNodes(xml_copy, '//*[@d:mi="'+ heaviest.getAttribute('d:mi') +'"]/'+ common)
							.map(function(node) {return node.parentNode.removeChild(node)});
				}
			});

			return out;
		},
		createFacetTemplate: function(facets) {
			var xsl_template,
				xsl_keys = [],
				xsl_facets = [],
				key;
			for (key in facets) {
				xsl_keys.push('<xsl:key name="'+ key +'Key" match="'+ facets[key].group +'" use="'+ facets[key].key +'" />');
				xsl_facets.push('"'+ key +'": {<xsl:for-each select="//'+ facets[key].group +'[@d:mi][count(. | key(\''+ key +'Key\', '+ facets[key].key +')[1]) = 1]">'+
					'"<xsl:value-of select="'+ facets[key].key +'" />": <xsl:value-of select="count(//'+ facets[key].group +'['+ facets[key].key +' = current()/'+ facets[key].key +'])" />'+
					'<xsl:if test="position() != last()">,</xsl:if></xsl:for-each>}'.replace(/\n|\t/g, ''));
			}
			xsl_template = xsl_keys.join('') +'<xsl:template name="facets">{'+ xsl_facets.join(',') +'}</xsl:template>';

			this.registerTemplate(xsl_template);
		},
		xmlFromString: function(str) {
			var parser,
				doc;
			str = str.replace(/>\s{1,}</g, '><');
			if (str.trim().match(/<\?xml/) === null) {
				str = this.xml_decl + str;
			}
			if ( 'ActiveXObject' in window ) {
				doc = new ActiveXObject('Msxml2.DOMDocument');
				doc.loadXML(str);
				doc.setProperty('SelectionNamespaces', this.namespace);
				if (str.indexOf('xsl:stylesheet') === -1) {
					doc.setProperty('SelectionLanguage', 'XPath');
				}
			} else {
				parser = new DOMParser();
				doc = parser.parseFromString(str, 'text/xml');
			}
			return doc;
		},
		concatFacet: function(src, dest) {
			for (var content in dest) {
				if (!src[content] || typeof(dest[content]) !== 'object') {
					src[content] = (src[content] || 0) + dest[content];
				} else {
					this.concatFacet(src[content], dest[content]);
				}
			}
			return src;
		},
		extend: function(src, dest) {
			for (var content in dest) {
				if (!src[content] || typeof(dest[content]) !== 'object') {
					src[content] = dest[content];
				} else {
					this.extend(src[content], dest[content]);
				}
			}
			return src;
		},
		node: {
			selectNodes: function(XNode, XPath) {
				if (XNode.evaluate) {
					var ns = XNode.createNSResolver(XNode.documentElement),
						qI = XNode.evaluate(XPath, XNode, ns, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null),
						res = [],
						i   = 0,
						il  = qI.snapshotLength;
					for (; i<il; i++) {
						res.push( qI.snapshotItem(i) );
					}
					return res;
				} else {
					return XNode.selectNodes(XPath);
				}
			},
			selectSingleNode: function(XNode, XPath) {
				if (XNode.evaluate) {
					var xI = this.selectNodes(XNode, XPath);
					return (xI.length > 0)? xI[0] : null;
				} else {
					return XNode.selectSingleNode(XPath);
				}
			},
			prettyPrint: function(node) {
				var root = defiant,
					tabs = root.tabsize,
					decl = root.xml_decl.toLowerCase(),
					ser,
					xstr;
				if (root.is_ie) {
					xstr = node.xml;
				} else {
					ser  = new XMLSerializer();
					xstr = ser.serializeToString(node);
				}
				if (root.env !== 'development') {
					// if environment is not development, remove defiant related info
					xstr = xstr.replace(/ \w+\:d=".*?"| d\:\w+=".*?"/g, '');
				}
				var str    = xstr.trim().replace(/(>)\s*(<)(\/*)/g, '$1\n$2$3'),
					lines  = str.split('\n'),
					indent = -1,
					i      = 0,
					il     = lines.length,
					start,
					end;
				for (; i<il; i++) {
					if (i === 0 && lines[i].toLowerCase() === decl) continue;
					start = lines[i].match(/<[A-Za-z_\:]+.*?>/g) !== null;
					//start = lines[i].match(/<[^\/]+>/g) !== null;
					end   = lines[i].match(/<\/[\w\:]+>/g) !== null;
					if (lines[i].match(/<.*?\/>/g) !== null) start = end = true;
					if (start) indent++;
					lines[i] = String().fill(indent, '\t') + lines[i];
					if (start && end) indent--;
					if (!start && end) indent--;
				}
				return lines.join('\n').replace(/\t/g, String().fill(tabs, ' '));
			},
			toJSON: function(xnode, stringify) {
				'use strict';

				var interpret = function(leaf) {
						var obj = {},
							win = window,
							attr,
							type,
							item,
							cname,
							cConstr,
							cval,
							text,
							i, il, a;
						switch (leaf.nodeType) {
							case 1:
								cConstr = leaf.getAttribute('d:constr');
								if (cConstr === 'Array') obj = [];
								else if (cConstr === 'String' && leaf.textContent === '') obj = '';

								attr = leaf.attributes;
								i = 0;
								il = attr.length;
								for (; i<il; i++) {
									a = attr.item(i);
									if (a.nodeName.match(/\:d|d\:/g) !== null) continue;

									cConstr = leaf.getAttribute('d:'+ a.nodeName);
									if (cConstr && cConstr !== 'undefined') {
										if (a.nodeValue === 'null') cval = null;
										else cval = win[ cConstr ]( (a.nodeValue === 'false') ? '' : a.nodeValue );
									} else {
										cval = a.nodeValue;
									}
									obj['@'+ a.nodeName] = cval;
								}
								break;
							case 3:
								type = leaf.parentNode.getAttribute('d:type');
								cval = (type) ? win[ type ]( leaf.nodeValue === 'false' ? '' : leaf.nodeValue ) : leaf.nodeValue;
								obj = cval;
								break;
						}
						if (leaf.hasChildNodes()) {
							i = 0;
							il = leaf.childNodes.length;
							for(; i<il; i++) {
								item  = leaf.childNodes.item(i);
								cname = item.nodeName;
								attr  = leaf.attributes;

								if (cname === 'd:name') {
									cname = item.getAttribute('d:name');
								}
								if (cname === '#text') {
									cConstr = leaf.getAttribute('d:constr');
									if (cConstr === 'undefined') cConstr = undefined;
									text = item.textContent || item.text;
									cval = cConstr === 'Boolean' && text === 'false' ? '' : text;

									if (!cConstr && !attr.length) obj = cval;
									else if (cConstr && il === 1) {
										obj = win[cConstr](cval);
									} else if (!leaf.hasChildNodes()) {
										obj[cname] = (cConstr)? win[cConstr](cval) : cval;
									} else {
										if (attr.length < 3) obj = (cConstr)? win[cConstr](cval) : cval;
										else obj[cname] = (cConstr)? win[cConstr](cval) : cval;
									}
								} else {
									if (item.getAttribute('d:constr') === 'null') {
										if (obj[cname] && obj[cname].push) obj[cname].push(null);
										else if (item.getAttribute('d:type') === 'ArrayItem') obj[cname] = [obj[cname]];
										else obj[cname] = null;
										continue;
									}
									if (obj[cname]) {
										if (obj[cname].push) obj[cname].push(interpret(item));
										else obj[cname] = [obj[cname], interpret(item)];
										continue;
									}
									cConstr = item.getAttribute('d:constr');
									switch (cConstr) {
										case 'null':
											if (obj.push) obj.push(null);
											else obj[cname] = null;
											break;
										case 'Array':
											if (item.parentNode.firstChild === item && cConstr === 'Array' && cname !== 'd:item') {
												if (cname === 'd:item' || cConstr === 'Array') {
													cval = interpret(item);
													obj[cname] = cval.length ? [cval] : cval;
												} else {
													obj[cname] = interpret(item);
												}
											}
											else if (obj.push) obj.push( interpret(item) );
											else obj[cname] = interpret(item);
											break;
										case 'String':
										case 'Number':
										case 'Boolean':
											text = item.textContent || item.text;
											cval = cConstr === 'Boolean' && text === 'false' ? '' : text;

											if (obj.push) obj.push( win[cConstr](cval) );
											else obj[cname] = interpret(item);
											break;
										default:
											if (obj.push) obj.push( interpret( item ) );
											else obj[cname] = interpret( item );
									}
								}
							}
						}
						if (leaf.nodeType === 1 && leaf.getAttribute('d:type') === 'ArrayItem') {
							obj = [obj];
						}
						return obj;
					},
					node = (xnode.nodeType === 9) ? xnode.documentElement : xnode,
					ret  = interpret(node),
					rn   = ret[node.nodeName];

				// exclude root, if "this" is root node
				if (node === node.ownerDocument.documentElement && rn && rn.constructor === Array) {
					ret = rn;
				}
				if (stringify && stringify.toString() === 'true') stringify = '\t';
				return stringify ? JSON.stringify(ret, null, stringify) : ret;
			}
		},
		json: {
			interpreter: {
				map              : [],
				rx_validate_name : /^(?!xml)[a-z_][\w\d.:]*$/i,
				rx_node          : /<(.+?)( .*?)>/,
				rx_constructor   : /<(.+?)( d:contr=".*?")>/,
				rx_namespace     : / xmlns\:d="defiant\-namespace"/,
				rx_data          : /(<.+?>)(.*?)(<\/d:data>)/i,
				rx_function      : /function (\w+)/i,
				namespace        : 'xmlns:d="defiant-namespace"',
				to_xml_str: function(tree) {
					return {
						str: this.hash_to_xml(null, tree),
						map: this.map
					};
				},
				hash_to_xml: function(name, tree, array_child) {
					var is_array = tree.constructor === Array,
						self = this,
						elem = [],
						attr = [],
						key,
						val,
						val_is_array,
						type,
						is_attr,
						cname,
						constr,
						cnName,
						i,
						il,
						fn = function(key, tree) {
							val = tree[key];
							if (val === null || val === undefined || val.toString() === 'NaN') val = null;

							is_attr = key.slice(0,1) === '@';
							cname   = array_child ? name : key;
							if (cname == +cname && tree.constructor !== Object) cname = 'd:item';
							if (val === null) {
								constr = null;
								cnName = false;
							} else {
								constr = val.constructor;
								cnName = constr.toString().match(self.rx_function)[1];
							}

							if (is_attr) {
								attr.push( cname.slice(1) +'="'+ self.escape_xml(val) +'"' );
								if (cnName !== 'String') attr.push( 'd:'+ cname.slice(1) +'="'+ cnName +'"' );
							} else if (val === null) {
								elem.push( self.scalar_to_xml( cname, val ) );
							} else {
								switch (constr) {
									case Function:
										// if constructor is function, then it's not a JSON structure
										throw 'JSON data should not contain functions. Please check your structure.';
										/* falls through */
									case Object:
										elem.push( self.hash_to_xml( cname, val ) );
										break;
									case Array:
										if (key === cname) {
											val_is_array = val.constructor === Array;
											if (val_is_array) {
												i = val.length;
												while (i--) {
													if (val[i] === null || !val[i] || val[i].constructor === Array) val_is_array = true;
													if (!val_is_array && val[i].constructor === Object) val_is_array = true;
												}
											}
											elem.push( self.scalar_to_xml( cname, val, val_is_array ) );
											break;
										}
										/* falls through */
									case String:
										if (typeof(val) === 'string') {
											val = val.toString().replace(/\&/g, '&amp;')
													.replace(/\r|\n/g, '&#13;');
										}
										if (cname === '#text') {
											// prepare map
											self.map.push(tree);
											attr.push('d:mi="'+ self.map.length +'"');
											attr.push('d:constr="'+ cnName +'"');
											elem.push( self.escape_xml(val) );
											break;
										}
										/* falls through */
									case Number:
									case Boolean:
										if (cname === '#text' && cnName !== 'String') {
											// prepare map
											self.map.push(tree);
											attr.push('d:mi="'+ self.map.length +'"');
											attr.push('d:constr="'+ cnName +'"');
											elem.push( self.escape_xml(val) );
											break;
										}
										elem.push( self.scalar_to_xml( cname, val ) );
										break;
								}
							}
						};
					if (tree.constructor === Array) {
						i = 0;
						il = tree.length;
						for (; i<il; i++) {
							fn(i.toString(), tree);
						}
					} else {
						for (key in tree) {
							fn(key, tree);
						}
					}
					if (!name) {
						name = 'd:data';
						attr.push(this.namespace);
						if (is_array) attr.push('d:constr="Array"');
					}
					if (name.match(this.rx_validate_name) === null) {
						attr.push( 'd:name="'+ name +'"' );
						name = 'd:name';
					}
					if (array_child) return elem.join('');
					// prepare map
					this.map.push(tree);
					attr.push('d:mi="'+ this.map.length +'"');

					return '<'+ name + (attr.length ? ' '+ attr.join(' ') : '') + (elem.length ? '>'+ elem.join('') +'</'+ name +'>' : '/>' );
				},
				scalar_to_xml: function(name, val, override) {
					var attr = '',
						text,
						constr,
						cnName;

					// check whether the nodename is valid
					if (name.match(this.rx_validate_name) === null) {
						attr += ' d:name="'+ name +'"';
						name = 'd:name';
						override = false;
					}
					if (val === null || val.toString() === 'NaN') val = null;
					if (val === null) return '<'+ name +' d:constr="null"/>';
					if (val.length === 1 && val.constructor === Array && !val[0]) {
						return '<'+ name +' d:constr="null" d:type="ArrayItem"/>';
					}
					if (val.length === 1 && val[0].constructor === Object) {
						
						text = this.hash_to_xml(false, val[0]);

						var a1 = text.match(this.rx_node),
							a2 = text.match(this.rx_constructor);
						a1 = (a1 !== null)? a1[2]
									.replace(this.rx_namespace, '')
									.replace(/>/, '')
									.replace(/"\/$/, '"') : '';
						a2 = (a2 !== null)? a2[2] : '';

						text = text.match(this.rx_data);
						text = (text !== null)? text[2] : '';

						return '<'+ name + a1 +' '+ a2 +' d:type="ArrayItem">'+ text +'</'+ name +'>';
					} else if (val.length === 0 && val.constructor === Array) {
						return '<'+ name +' d:constr="Array"/>';
					}
					// else 
					if (override) {
						return this.hash_to_xml( name, val, true );
					}

					constr = val.constructor;
					cnName = constr.toString().match(this.rx_function)[1];
					text = (constr === Array)   ? this.hash_to_xml( 'd:item', val, true )
												: this.escape_xml(val);

					attr += ' d:constr="'+ cnName +'"';
					// prepare map
					this.map.push(val);
					attr += ' d:mi="'+ this.map.length +'"';

					return (name === '#text') ? this.escape_xml(val) : '<'+ name + attr +'>'+ text +'</'+ name +'>';
				},
				escape_xml: function(text) {
					return String(text) .replace(/&/g, '&amp;')
										.replace(/</g, '&lt;')
										.replace(/>/g, '&gt;')
										.replace(/"/g, '&quot;')
										.replace(/&nbsp;/g, '&#160;');
				}
			},
			toXML: function(tree, callback) {
				var interpreter = defiant.json.interpreter,
					compiled,
					processed,
					doc,
					task;

				// depending on request
				switch (typeof callback) {
					case 'function':
						// parse in a dedicated thread			
						defiant.compiled.to_xml_str(tree, function(processed) {
							// snapshot distinctly improves performance
							callback({
								doc: defiant.xmlFromString(processed.str),
								src: tree,
								map: processed.map
							});
						});
						return;
					case 'boolean':
						processed = interpreter.to_xml_str.call(interpreter, tree);
						// return snapshot
						return {
							doc: defiant.xmlFromString(processed.str),
							src: tree,
							map: processed.map
						};
					default:
						processed = interpreter.to_xml_str.call(interpreter, tree);
						doc = defiant.xmlFromString(processed.str);

						this.search.map = processed.map;
						return doc;
				}
			},
			search: function(tree, xpath, single) {
				if (tree.constructor === String && tree.slice(0, 9) === 'snapshot_' && defiant.snapshots[tree]) {
					tree = defiant.snapshots[tree];
				}

				var self       = defiant.json,
					isSnapshot = tree.doc && tree.doc.nodeType,
					doc        = isSnapshot ? tree.doc : self.toXML(tree),
					map        = isSnapshot ? tree.map : self.search.map,
					src        = isSnapshot ? tree.src : tree,
					xres       = defiant.node[ single ? 'selectSingleNode' : 'selectNodes' ](doc, xpath.xTransform()),
					ret        = [],
					mapIndex,
					i;

				if (single) xres = [xres];
				i = xres.length;

				while (i--) {
					switch(xres[i].nodeType) {
						case 2:
						case 3: 
							ret.unshift( xres[i].nodeValue );
							break;
						default:
							mapIndex = +xres[i].getAttribute('d:mi');
							//if (map[mapIndex-1] !== false) {
								ret.unshift( map[mapIndex-1] );
							//}
					}
				}

				// if environment = development, add search tracing
				if (defiant.env === 'development') {
					ret.trace = self.matchTrace(src, ret, xres);
				}

				return ret;
			},
			matchTrace: function (root, hits, xres) {
				var trace = [],
					fIndex = 0,
					win = window,
					toJson = defiant.node.toJSON,
					stringify = function(data) {return JSON.stringify(data, null, '\t').replace(/\t/g, '')},
					jsonStr = stringify(root);
				xres.map(function(item, index) {
					var constr,
						pJson,
						pStr,
						hit,
						hstr,
						pIdx,
						lines,
						len = 0;
					switch (item.nodeType) {
						case 2:
							constr = xres[index].ownerElement ? xres[index].ownerElement.getAttribute('d:'+ xres[index].nodeName) : 'String';
							hit = win[constr](hits[index]);
							hstr = '"@'+ xres[index].nodeName +'": '+ hit;
							pIdx = jsonStr.indexOf(hstr, fIndex);
							break;
						case 3:
							constr = xres[index].parentNode.getAttribute('d:constr');
							hit = win[constr](hits[index]);
							hstr = '"'+ xres[index].parentNode.nodeName +'": '+ (hstr === 'Number' ? hit : '"'+ hit +'"');
							pIdx = jsonStr.indexOf(hstr, fIndex);
							break;
						default:
							constr = item.getAttribute('d:constr');
							if (['String', 'Number'].indexOf(constr) > -1) {
								pJson = toJson(xres[index].parentNode);
								pStr = stringify(pJson);
								hit = win[constr](hits[index]);
								hstr = '"'+ xres[index].nodeName +'": '+ (constr === 'Number' ? hit : '"'+ hit +'"');
								pIdx = jsonStr.indexOf(pStr, fIndex) + pStr.indexOf(hstr);
							} else {
								hstr = stringify( hits[index] );
								pIdx = jsonStr.indexOf(hstr);
								len = hstr.split('\n').length - 1;
							}
					}
					fIndex = pIdx + 1;
					lines = jsonStr.slice(0, pIdx).split('\n').length;
					trace.push([lines, len]);
				});
				return trace;
			}
		}
	};


	/* 
	 * x10.js v0.1.3 
	 * Web worker wrapper with simple interface 
	 * Copyright (c) 2013-2019, Hakan Bilgin <hbi@longscript.com> 
	 * Licensed under the MIT License 
	 */
	var x10 = {
		id: 1,
		work_handler: function(event) {
			var args = Array.prototype.slice.call(event.data, 2),
				func = event.data[0],
				taskId = event.data[1],
				ret  = tree[func].apply(tree, args);

			// make sure map is pure json
			ret.map = JSON.parse(JSON.stringify(ret.map));
			
			// return process finish
			postMessage([taskId, func, ret]);
		},
		setup: function(tree) {
			var url    = window.URL || window.webkitURL,
				script = 'var tree = {'+ this.parse(tree).join(',') +'};',
				blob   = new Blob([script + 'self.addEventListener("message", '+ this.work_handler.toString() +', false);'],
									{type: 'text/javascript'}),
				worker = new Worker(url.createObjectURL(blob));
			
			// thread pipe
			worker.onmessage = function(event) {
				var args = Array.prototype.slice.call(event.data, 2),
					taskId = event.data[0],
					func = event.data[1];
				
				x10.observer.emit('x10:'+ func + taskId, args);
				x10.observer.off('x10:'+ func + taskId);
			};

			return worker;
		},
		call_handler: function(func, worker) {
			return function() {
				var args = Array.prototype.slice.call(arguments, 0, -1),
					callback = arguments[arguments.length-1],
					taskId = x10.id++;

				// add task id
				args.unshift(taskId);

				// add method name
				args.unshift(func);

				// listen for 'done'
				x10.observer.on('x10:'+ func + taskId, function(event) {
					callback(event.detail[0]);
				});

				// start worker
				worker.postMessage(args);
			};
		},
		compile: function(hash) {
			var worker = this.setup(typeof(hash) === 'function' ? {func: hash} : hash),
				obj = {},
				fn;
			// create return object
			if (typeof(hash) === 'function') {
				obj.func = this.call_handler('func', worker);
				return obj.func;
			} else {
				for (fn in hash) {
					obj[fn] = this.call_handler(fn, worker);
				}
				return obj;
			}
		},
		parse: function(tree, isArray) {
			var hash = [],
				key,
				val,
				v;

			for (key in tree) {
				v = tree[key];
				// handle null
				if (v === null) {
					hash.push(key +':null');
					continue;
				}
				// handle undefined
				if (v === undefined) {
					hash.push(key +':undefined');
					continue;
				}
				switch (v.constructor) {
					case Date:     val = 'new Date('+ v.valueOf() +')';           break;
					case Object:   val = '{'+ this.parse(v).join(',') +'}';       break;
					case Array:    val = '['+ this.parse(v, true).join(',') +']'; break;
					case String:   val = '"'+ v.replace(/"/g, '\\"') +'"';        break;
					case RegExp:
					case Function: val = v.toString();                            break;
					default:       val = v;
				}
				if (isArray) hash.push(val);
				else hash.push(key +':'+ val);
			}
			return hash;
		},
		// simple event emitter
		observer: (function() {
			var stack = {};

			return {
				on: function(type, fn) {
					if (!stack[type]) {
						stack[type] = [];
					}
					stack[type].unshift(fn);
				},
				off: function(type, fn) {
					if (!stack[type]) return;
					var i = stack[type].indexOf(fn);
					stack[type].splice(i,1);
				},
				emit: function(type, detail) {
					if (!stack[type]) return;
					var event = {
							type         : type,
							detail       : detail,
							isCanceled   : false,
							cancelBubble : function() {
								this.isCanceled = true;
							}
						},
						len = stack[type].length;
					while(len--) {
						if (event.isCanceled) return;
						stack[type][len](event);
					}
				}
			};
		})()
	};

	// extending STRING
	if (!String.prototype.fill) {
		String.prototype.fill = function(i, c) {
			var str = this;
			c = c || ' ';
			for (; str.length<i; str+=c){}
			return str;
		};
	}

	if (!String.prototype.trim) {
		String.prototype.trim = function () {
			return this.replace(/^\s+|\s+$/gm, '');
		};
	}

	if (!String.prototype.xTransform) {
		String.prototype.xTransform = function () {
			var str = this;
			if (this.indexOf('translate(') === -1) {
				str = this.replace(/contains\(([^,]+),([^\\)]+)\)/g, function(c,h,n) {
					var a = 'abcdefghijklmnopqrstuvwxyz';
					return "contains(translate("+ h +", \""+ a.toUpperCase() +"\", \""+ a +"\"),"+ n.toLowerCase() +")";
				});
			}
			return str.toString();
		};
	}

	/* jshint ignore:start */
	if (typeof(JSON) === 'undefined') {
		window.JSON = {
			parse: function (sJSON) { return eval("(" + sJSON + ")"); },
			stringify: function (vContent) {
				if (vContent instanceof Object) {
					var sOutput = "";
					if (vContent.constructor === Array) {
						for (var nId = 0; nId < vContent.length; sOutput += this.stringify(vContent[nId]) + ",", nId++);
						return "[" + sOutput.substr(0, sOutput.length - 1) + "]";
					}
					if (vContent.toString !== Object.prototype.toString) {
						return "\"" + vContent.toString().replace(/"/g, "\\$&") + "\"";
					}
					for (var sProp in vContent) {
						sOutput += "\"" + sProp.replace(/"/g, "\\$&") + "\":" + this.stringify(vContent[sProp]) + ",";
					}
					return "{" + sOutput.substr(0, sOutput.length - 1) + "}";
				}
				return typeof vContent === "string" ? "\"" + vContent.replace(/"/g, "\\$&") + "\"" : String(vContent);
			}
		};
	}
	/* jshint ignore:end */

	// compile interpreter with 'x10.js'
	defiant.compiled = x10.compile(defiant.json.interpreter);
	defiant.search = defiant.json.search;
	defiant.x10 = x10;

	JSON.search = function(data, xpath, first) {
		console.warn('[Deprication] Defiant will stop extending the JSON object. Please use this method instead; "defiant.json.search".')
		return defiant.json.search(data, xpath, first);
	};
	JSON.toXML = function(data) {
		console.warn('[Deprication] Defiant will stop extending the JSON object. Please use this method instead; "defiant.json.toXML".')
		return defiant.json.toXML(data);
	};

	NodeList.prototype.map = Array.prototype.map;

	window.defiant = window.defiant || defiant;
	module.exports = defiant;

})(
	typeof window !== 'undefined' ? window : {},
	typeof module !== 'undefined' ? module : {}
);


// this is IE polyfill
if (!window.XSLTProcessor && typeof(XSLTProcessor) === 'undefined') {
	// emulating XSLT Processor (enough to be used in defiant)
	var XSLTProcessor = function() {};
	XSLTProcessor.prototype = {
		importStylesheet: function(xsldoc) {
			this.xsldoc = xsldoc;
		},
		transformToFragment: function(data, doc) {
			var str = data.transformNode(this.xsldoc),
				span = document.createElement('span');
			span.innerHTML = str;
			return span;
		}
	};
} else if (typeof(XSLTProcessor) !== 'function' && !window.XSLTProcessor) {
	// throw error
	throw 'XSLTProcessor transformNode not implemented';
}

/*global exports, require*/
/* eslint-disable no-eval */
/* JSONPath 0.8.0 - XPath for JSON
 *
 * Copyright (c) 2007 Stefan Goessner (goessner.net)
 * Licensed under the MIT (MIT-LICENSE.txt) licence.
 */

var module;
(function (glbl, require) {'use strict';

// Make sure to know if we are in real node or not (the `require` variable
// could actually be require.js, for example.
var isNode = module && !!module.exports;

var allowedResultTypes = ['value', 'path', 'pointer', 'parent', 'parentProperty', 'all'];

if (!Array.prototype.includes) {
    Array.prototype.includes = function (item) { // eslint-disable-line no-extend-native
        return this.indexOf(item) > -1;
    };
}
if (!String.prototype.includes) {
    String.prototype.includes = function (item) { // eslint-disable-line no-extend-native
        return this.indexOf(item) > -1;
    };
}

var moveToAnotherArray = function (source, target, conditionCb) {
  for (var i = 0, kl = source.length; i < kl; i++) {
      var key = source[i];
      if (conditionCb(key)) {
          target.push(source.splice(i--, 1)[0]);
      }
  }
};

var vm = isNode
    ? require('vm') : {
        runInNewContext: function (expr, context) {
            var keys = Object.keys(context);
            var funcs = [];
            moveToAnotherArray(keys, funcs, function (key) {
                return typeof context[key] === 'function';
            });
            var code = funcs.reduce(function (s, func) {
                return 'var ' + func + '=' + context[func].toString() + ';' + s;
            }, '');
            code += keys.reduce(function (s, vr) {
                return 'var ' + vr + '=' + JSON.stringify(context[vr]).replace(/\u2028|\u2029/g, function (m) {
                    // http://www.thespanner.co.uk/2011/07/25/the-json-specification-is-now-wrong/
                    return '\\u202' + (m === '\u2028' ? '8' : '9');
                }) + ';' + s;
            }, expr);
            return eval(code);
        }
    };

function push (arr, elem) {arr = arr.slice(); arr.push(elem); return arr;}
function unshift (elem, arr) {arr = arr.slice(); arr.unshift(elem); return arr;}
function NewError (value) {
  this.avoidNew = true;
  this.value = value;
  this.message = 'JSONPath should not be called with "new" (it prevents return of (unwrapped) scalar values)';
}

function JSONPath (opts, expr, obj, callback, otherTypeCallback) {
    if (!(this instanceof JSONPath)) {
        try {
            return new JSONPath(opts, expr, obj, callback, otherTypeCallback);
        }
        catch (e) {
            if (!e.avoidNew) {
                throw e;
            }
            return e.value;
        }
    }

    if (typeof opts === 'string') {
        otherTypeCallback = callback;
        callback = obj;
        obj = expr;
        expr = opts;
        opts = {};
    }
    opts = opts || {};
    var objArgs = opts.hasOwnProperty('json') && opts.hasOwnProperty('path');
    this.json = opts.json || obj;
    this.path = opts.path || expr;
    this.resultType = (opts.resultType && opts.resultType.toLowerCase()) || 'value';
    this.flatten = opts.flatten || false;
    this.wrap = opts.hasOwnProperty('wrap') ? opts.wrap : true;
    this.sandbox = opts.sandbox || {};
    this.preventEval = opts.preventEval || false;
    this.parent = opts.parent || null;
    this.parentProperty = opts.parentProperty || null;
    this.callback = opts.callback || callback || null;
    this.otherTypeCallback = opts.otherTypeCallback || otherTypeCallback || function () {
        throw new Error('You must supply an otherTypeCallback callback option with the @other() operator.');
    };

    if (opts.autostart !== false) {
        var ret = this.evaluate({
            path: (objArgs ? opts.path : expr),
            json: (objArgs ? opts.json : obj)
        });
        if (!ret || typeof ret !== 'object') {
            throw new NewError(ret);
        }
        return ret;
    }
}

// PUBLIC METHODS

JSONPath.prototype.evaluate = function (expr, json, callback, otherTypeCallback) {
    var self = this,
        flatten = this.flatten,
        wrap = this.wrap,
        currParent = this.parent,
        currParentProperty = this.parentProperty;

    this.currResultType = this.resultType;
    this.currPreventEval = this.preventEval;
    this.currSandbox = this.sandbox;
    callback = callback || this.callback;
    this.currOtherTypeCallback = otherTypeCallback || this.otherTypeCallback;

    json = json || this.json;
    expr = expr || this.path;
    if (expr && typeof expr === 'object') {
        if (!expr.path) {
            throw new Error('You must supply a "path" property when providing an object argument to JSONPath.evaluate().');
        }
        json = expr.hasOwnProperty('json') ? expr.json : json;
        flatten = expr.hasOwnProperty('flatten') ? expr.flatten : flatten;
        this.currResultType = expr.hasOwnProperty('resultType') ? expr.resultType : this.currResultType;
        this.currSandbox = expr.hasOwnProperty('sandbox') ? expr.sandbox : this.currSandbox;
        wrap = expr.hasOwnProperty('wrap') ? expr.wrap : wrap;
        this.currPreventEval = expr.hasOwnProperty('preventEval') ? expr.preventEval : this.currPreventEval;
        callback = expr.hasOwnProperty('callback') ? expr.callback : callback;
        this.currOtherTypeCallback = expr.hasOwnProperty('otherTypeCallback') ? expr.otherTypeCallback : this.currOtherTypeCallback;
        currParent = expr.hasOwnProperty('parent') ? expr.parent : currParent;
        currParentProperty = expr.hasOwnProperty('parentProperty') ? expr.parentProperty : currParentProperty;
        expr = expr.path;
    }
    currParent = currParent || null;
    currParentProperty = currParentProperty || null;

    if (Array.isArray(expr)) {
        expr = JSONPath.toPathString(expr);
    }
    if (!expr || !json || !allowedResultTypes.includes(this.currResultType)) {
        return;
    }
    this._obj = json;

    var exprList = JSONPath.toPathArray(expr);
    if (exprList[0] === '$' && exprList.length > 1) {exprList.shift();}
    this._hasParentSelector = null;
    var result = this._trace(exprList, json, ['$'], currParent, currParentProperty, callback);
    result = result.filter(function (ea) {return ea && !ea.isParentSelector;});

    if (!result.length) {return wrap ? [] : undefined;}
    if (result.length === 1 && !wrap && !Array.isArray(result[0].value)) {
        return this._getPreferredOutput(result[0]);
    }
    return result.reduce(function (result, ea) {
        var valOrPath = self._getPreferredOutput(ea);
        if (flatten && Array.isArray(valOrPath)) {
            result = result.concat(valOrPath);
        }
        else {
            result.push(valOrPath);
        }
        return result;
    }, []);
};

// PRIVATE METHODS

JSONPath.prototype._getPreferredOutput = function (ea) {
    var resultType = this.currResultType;
    switch (resultType) {
    case 'all':
        ea.path = typeof ea.path === 'string' ? ea.path : JSONPath.toPathString(ea.path);
        return ea;
    case 'value': case 'parent': case 'parentProperty':
        return ea[resultType];
    case 'path':
        return JSONPath.toPathString(ea[resultType]);
    case 'pointer':
        return JSONPath.toPointer(ea.path);
    }
};

JSONPath.prototype._handleCallback = function (fullRetObj, callback, type) {
    if (callback) {
        var preferredOutput = this._getPreferredOutput(fullRetObj);
        fullRetObj.path = typeof fullRetObj.path === 'string' ? fullRetObj.path : JSONPath.toPathString(fullRetObj.path);
        callback(preferredOutput, type, fullRetObj);
    }
};

JSONPath.prototype._trace = function (expr, val, path, parent, parentPropName, callback, literalPriority) {
    // No expr to follow? return path and value as the result of this trace branch
    var retObj, self = this;
    if (!expr.length) {
        retObj = {path: path, value: val, parent: parent, parentProperty: parentPropName};
        this._handleCallback(retObj, callback, 'value');
        return retObj;
    }

    var loc = expr[0], x = expr.slice(1);

    // We need to gather the return value of recursive trace calls in order to
    // do the parent sel computation.
    var ret = [];
    function retPush (elem) {
        ret.push(elem);
    }
    function addRet (elems) {
        if (Array.isArray(elems)) {
            elems.forEach(retPush);
        } else {
            ret.push(elems);
        }
    }

    if ((typeof loc !== 'string' || literalPriority) && val && Object.prototype.hasOwnProperty.call(val, loc)) { // simple case--directly follow property
        addRet(this._trace(x, val[loc], push(path, loc), val, loc, callback));
    }
    else if (loc === '*') { // all child properties
        this._walk(loc, x, val, path, parent, parentPropName, callback, function (m, l, x, v, p, par, pr, cb) {
            addRet(self._trace(unshift(m, x), v, p, par, pr, cb, true));
        });
    }
    else if (loc === '..') { // all descendent parent properties
        addRet(this._trace(x, val, path, parent, parentPropName, callback)); // Check remaining expression with val's immediate children
        this._walk(loc, x, val, path, parent, parentPropName, callback, function (m, l, x, v, p, par, pr, cb) {
            // We don't join m and x here because we only want parents, not scalar values
            if (typeof v[m] === 'object') { // Keep going with recursive descent on val's object children
                addRet(self._trace(unshift(l, x), v[m], push(p, m), v, m, cb));
            }
        });
    }
    // The parent sel computation is handled in the frame above using the
    // ancestor object of val
    else if (loc === '^') {
        // This is not a final endpoint, so we do not invoke the callback here
        this._hasParentSelector = true;
        return path.length ? {
            path: path.slice(0, -1),
            expr: x,
            isParentSelector: true
        } : [];
    }
    else if (loc === '~') { // property name
        retObj = {path: push(path, loc), value: parentPropName, parent: parent, parentProperty: null};
        this._handleCallback(retObj, callback, 'property');
        return retObj;
    }
    else if (loc === '$') { // root only
        addRet(this._trace(x, val, path, null, null, callback));
    }
    else if (/^(-?[0-9]*):(-?[0-9]*):?([0-9]*)$/.test(loc)) { // [start:end:step]  Python slice syntax
        addRet(this._slice(loc, x, val, path, parent, parentPropName, callback));
    }
    else if (loc.indexOf('?(') === 0) { // [?(expr)] (filtering)
        if (this.currPreventEval) {
            throw new Error('Eval [?(expr)] prevented in JSONPath expression.');
        }
        this._walk(loc, x, val, path, parent, parentPropName, callback, function (m, l, x, v, p, par, pr, cb) {
            if (self._eval(l.replace(/^\?\((.*?)\)$/, '$1'), v[m], m, p, par, pr)) {
                addRet(self._trace(unshift(m, x), v, p, par, pr, cb));
            }
        });
    }
    else if (loc[0] === '(') { // [(expr)] (dynamic property/index)
        if (this.currPreventEval) {
            throw new Error('Eval [(expr)] prevented in JSONPath expression.');
        }
        // As this will resolve to a property name (but we don't know it yet), property and parent information is relative to the parent of the property to which this expression will resolve
        addRet(this._trace(unshift(this._eval(loc, val, path[path.length - 1], path.slice(0, -1), parent, parentPropName), x), val, path, parent, parentPropName, callback));
    }
    else if (loc[0] === '@') { // value type: @boolean(), etc.
        var addType = false;
        var valueType = loc.slice(1, -2);
        switch (valueType) {
        case 'scalar':
            if (!val || !(['object', 'function'].includes(typeof val))) {
                addType = true;
            }
            break;
        case 'boolean': case 'string': case 'undefined': case 'function':
            if (typeof val === valueType) {
                addType = true;
            }
            break;
        case 'number':
            if (typeof val === valueType && isFinite(val)) {
                addType = true;
            }
            break;
        case 'nonFinite':
            if (typeof val === 'number' && !isFinite(val)) {
                addType = true;
            }
            break;
        case 'object':
            if (val && typeof val === valueType) {
                addType = true;
            }
            break;
        case 'array':
            if (Array.isArray(val)) {
                addType = true;
            }
            break;
        case 'other':
            addType = this.currOtherTypeCallback(val, path, parent, parentPropName);
            break;
        case 'integer':
            if (val === +val && isFinite(val) && !(val % 1)) {
                addType = true;
            }
            break;
        case 'null':
            if (val === null) {
                addType = true;
            }
            break;
        }
        if (addType) {
            retObj = {path: path, value: val, parent: parent, parentProperty: parentPropName};
            this._handleCallback(retObj, callback, 'value');
            return retObj;
        }
    }
    else if (loc[0] === '`' && val && Object.prototype.hasOwnProperty.call(val, loc.slice(1))) { // `-escaped property
        var locProp = loc.slice(1);
        addRet(this._trace(x, val[locProp], push(path, locProp), val, locProp, callback, true));
    }
    else if (loc.includes(',')) { // [name1,name2,...]
        var parts, i;
        for (parts = loc.split(','), i = 0; i < parts.length; i++) {
            addRet(this._trace(unshift(parts[i], x), val, path, parent, parentPropName, callback));
        }
    }
    else if (!literalPriority && val && Object.prototype.hasOwnProperty.call(val, loc)) { // simple case--directly follow property
        addRet(this._trace(x, val[loc], push(path, loc), val, loc, callback, true));
    }

    // We check the resulting values for parent selections. For parent
    // selections we discard the value object and continue the trace with the
    // current val object
    if (this._hasParentSelector) {
        for (var t = 0; t < ret.length; t++) {
            var rett = ret[t];
            if (rett.isParentSelector) {
                var tmp = self._trace(rett.expr, val, rett.path, parent, parentPropName, callback);
                if (Array.isArray(tmp)) {
                    ret[t] = tmp[0];
                    for (var tt = 1, tl = tmp.length; tt < tl; tt++) {
                        t++;
                        ret.splice(t, 0, tmp[tt]);
                    }
                } else {
                    ret[t] = tmp;
                }
            }
        }
    }
    return ret;
};

JSONPath.prototype._walk = function (loc, expr, val, path, parent, parentPropName, callback, f) {
    var i, n, m;
    if (Array.isArray(val)) {
        for (i = 0, n = val.length; i < n; i++) {
            f(i, loc, expr, val, path, parent, parentPropName, callback);
        }
    }
    else if (typeof val === 'object') {
        for (m in val) {
            if (Object.prototype.hasOwnProperty.call(val, m)) {
                f(m, loc, expr, val, path, parent, parentPropName, callback);
            }
        }
    }
};

JSONPath.prototype._slice = function (loc, expr, val, path, parent, parentPropName, callback) {
    if (!Array.isArray(val)) {return;}
    var i,
        len = val.length, parts = loc.split(':'),
        start = (parts[0] && parseInt(parts[0], 10)) || 0,
        end = (parts[1] && parseInt(parts[1], 10)) || len,
        step = (parts[2] && parseInt(parts[2], 10)) || 1;
    start = (start < 0) ? Math.max(0, start + len) : Math.min(len, start);
    end = (end < 0) ? Math.max(0, end + len) : Math.min(len, end);
    var ret = [];
    for (i = start; i < end; i += step) {
        var tmp = this._trace(unshift(i, expr), val, path, parent, parentPropName, callback);
        if (Array.isArray(tmp)) {
            tmp.forEach(function (t) {
                ret.push(t);
            });
        }
        else {
            ret.push(tmp);
        }
    }
    return ret;
};

JSONPath.prototype._eval = function (code, _v, _vname, path, parent, parentPropName) {
    if (!this._obj || !_v) {return false;}
    if (code.includes('@parentProperty')) {
        this.currSandbox._$_parentProperty = parentPropName;
        code = code.replace(/@parentProperty/g, '_$_parentProperty');
    }
    if (code.includes('@parent')) {
        this.currSandbox._$_parent = parent;
        code = code.replace(/@parent/g, '_$_parent');
    }
    if (code.includes('@property')) {
        this.currSandbox._$_property = _vname;
        code = code.replace(/@property/g, '_$_property');
    }
    if (code.includes('@path')) {
        this.currSandbox._$_path = JSONPath.toPathString(path.concat([_vname]));
        code = code.replace(/@path/g, '_$_path');
    }
    if (code.match(/@([\.\s\)\[])/)) {
        this.currSandbox._$_v = _v;
        code = code.replace(/@([\.\s\)\[])/g, '_$_v$1');
    }
    try {
        return vm.runInNewContext(code, this.currSandbox);
    }
    catch (e) {
        console.log(e);
        throw new Error('jsonPath: ' + e.message + ': ' + code);
    }
};

// PUBLIC CLASS PROPERTIES AND METHODS

// Could store the cache object itself
JSONPath.cache = {};

JSONPath.toPathString = function (pathArr) {
    var i, n, x = pathArr, p = '$';
    for (i = 1, n = x.length; i < n; i++) {
        if (!(/^(~|\^|@.*?\(\))$/).test(x[i])) {
            p += (/^[0-9*]+$/).test(x[i]) ? ('[' + x[i] + ']') : ("['" + x[i] + "']");
        }
    }
    return p;
};

JSONPath.toPointer = function (pointer) {
    var i, n, x = pointer, p = '';
    for (i = 1, n = x.length; i < n; i++) {
        if (!(/^(~|\^|@.*?\(\))$/).test(x[i])) {
            p += '/' + x[i].toString()
                  .replace(/\~/g, '~0')
                  .replace(/\//g, '~1');
        }
    }
    return p;
};

JSONPath.toPathArray = function (expr) {
    var cache = JSONPath.cache;
    if (cache[expr]) {return cache[expr].concat();}
    var subx = [];
    var normalized = expr
                    // Properties
                    .replace(/@(?:null|boolean|number|string|integer|undefined|nonFinite|scalar|array|object|function|other)\(\)/g, ';$&;')
                    // Parenthetical evaluations (filtering and otherwise), directly within brackets or single quotes
                    .replace(/[\['](\??\(.*?\))[\]']/g, function ($0, $1) {return '[#' + (subx.push($1) - 1) + ']';})
                    // Escape periods and tildes within properties
                    .replace(/\['([^'\]]*)'\]/g, function ($0, prop) {
                        return "['" + prop
                            .replace(/\./g, '%@%')
                            .replace(/~/g, '%%@@%%') +
                            "']";
                    })
                    // Properties operator
                    .replace(/~/g, ';~;')
                    // Split by property boundaries
                    .replace(/'?\.'?(?![^\[]*\])|\['?/g, ';')
                    // Reinsert periods within properties
                    .replace(/%@%/g, '.')
                    // Reinsert tildes within properties
                    .replace(/%%@@%%/g, '~')
                    // Parent
                    .replace(/(?:;)?(\^+)(?:;)?/g, function ($0, ups) {return ';' + ups.split('').join(';') + ';';})
                    // Descendents
                    .replace(/;;;|;;/g, ';..;')
                    // Remove trailing
                    .replace(/;$|'?\]|'$/g, '');

    var exprList = normalized.split(';').map(function (expr) {
        var match = expr.match(/#([0-9]+)/);
        return !match || !match[1] ? expr : subx[match[1]];
    });
    cache[expr] = exprList;
    return cache[expr];
};

// For backward compatibility (deprecated)
JSONPath.eval = function (obj, expr, opts) {
    return JSONPath(opts, expr, obj);
};

if (typeof define === 'function' && define.amd) {
    define(function () {return JSONPath;});
}
else if (isNode) {
    module.exports = JSONPath;
}
else {
    glbl.jsonPath = { // Deprecated
        eval: JSONPath.eval
    };
    glbl.JSONPath = JSONPath;
}
}(this || self, typeof require === 'undefined' ? null : require));

(function (document, window) {
	'use strict';

	var uniqueId = function(prefix) {
		return (prefix || 'ui-id') + '-' + Math.floor((Math.random()*1000)+1);
	};

	var closePanel = function(panel) {
		slide.up(panel, status => {
			panel.setAttribute('aria-hidden', 'true');
			panel.setAttribute('tabIndex', '-1');
			panel.classList.add('hidden');
			panel.classList.remove('in');
		});
	};

	var openPanel = function(panel) {
		slide.down(panel, status => {
			panel.setAttribute('aria-hidden', 'false');
			panel.setAttribute('tabIndex', '0');
			panel.classList.remove('hidden');
			panel.classList.add('in');
		});
	};

	var togglePanel = function(tab) {
		var target = tab.hasAttribute('data-target')
				? tab.getAttribute('data-target')
				: tab.getAttribute('href');
		var curPanel = document.querySelector(target);
		if (curPanel.classList.contains('in')) {
			tab.setAttribute('aria-selected' , 'false');
			tab.setAttribute('aria-expanded', 'false');
			closePanel(curPanel);
		} else {
			if (tab.hasAttribute('data-parent')) {
				var tablist = document.querySelector(tab.getAttribute('data-parent'));
				if (tablist !== null) {
					var openedPanel = tablist.querySelector('.in');
					if (openedPanel !== null) {
						closePanel(openedPanel);
					}
				}
			}
			openPanel(curPanel);
			tab.setAttribute('aria-selected', 'true');
			tab.setAttribute('aria-expanded', 'true');
		}
	};

	var tabs =  document.querySelectorAll('[data-toggle="expand"]');
	tabs.forEach( tab => {
		var tabid = tab.getAttribute('id') || uniqueId('ui-expand');
		tab.setAttribute('id', tabid);
		tab.setAttribute('role', 'tab');
		tab.setAttribute('aria-selected', 'false');
		tab.setAttribute('aria-expanded', 'false');
		if (tab.hasAttribute('data-parent')) {
			var tablist = document.querySelector(tab.getAttribute('data-parent'));
			if (tablist){
				tablist.setAttribute('role', 'tablist');
				tablist.setAttribute('aria-multiselectable', 'true');
			}
		}
		var target = tab.hasAttribute('data-target')
				? tab.getAttribute('data-target')
				: tab.getAttribute('href');
		tab.setAttribute('aria-controls', target.substr(1));
		var panel = document.querySelector(target);
		panel.setAttribute('role', 'tabpanel');
		panel.setAttribute('aria-labelledby', tabid);
		panel.style.transition = 'height 2s ease';
		if (panel.classList.contains('in')) {
			tab.setAttribute('aria-selected', 'true');
			tab.setAttribute('aria-expanded', 'true');
			panel.setAttribute('tabindex', '0');
			panel.setAttribute('aria-hidden', 'false');
		} else {
			closePanel(panel);
		}
		tab.addEventListener('keydown', function (event) {
			var key = event.which || event.keyCode;
			if ([37, 38, 39, 40].indexOf(key) < 0) {
				return;
			}
			if (! this.hasAttribute('data-parent')) {
				return;
			}
			var tablist = document.querySelector(this.getAttribute('data-parent'));
			if (tablist === null) {
				return;
			}
			var tabs = tablist.querySelectorAll("[data-parent='" + this.getAttribute('data-parent') + "']");
			var index = -1;
			tabs.forEach( (that, i) => {
				if (that === this) {
					index = i;
				}
			});
			if (key == 38 || key == 37) { // up & left
				index--;
			}
			if (key == 39 || key == 40) { // down & right
				index++;
			}
			if (index < 0) {
				index = tabs.length -1;
			}
			if (index == tabs.length) {
				index = 0;
			}
			tabs[index].focus();
			event.preventDefault();
			event.stopPropagation();
		});
		tab.addEventListener('click', function(event) {
			togglePanel(this);
			event.preventDefault();
			event.stopPropagation();
		});
	});
}(document, window));

(function (document, window) {
	'use strict';

	var uniqueId = function(prefix) {
		return (prefix || 'ui-id') + '-' + Math.floor((Math.random()*1000)+1);
	};

	var closePanel = function(panel) {
		panel.setAttribute('aria-hidden', 'true');
		panel.setAttribute('tabIndex', '-1');
		panel.classList.add('hidden');
		panel.classList.remove('active');
	};

	var openPanel = function(panel) {
		panel.setAttribute('aria-hidden', 'false');
		panel.setAttribute('tabIndex', '0');
		panel.classList.remove('hidden');
		panel.classList.add('active');
	};

	var selectTab = function(tab) {
		if (tab.parentElement.classList.contains('active')) {
			return;
		}
		var active = tab.closest('.step-panels-list').querySelector('.active');
		if (null !== active) {
			var openedTab = active.querySelector('[data-toggle="tab"]');
			var openedTarget = openedTab.hasAttribute('data-target')
					? openedTab.getAttribute('data-target')
					: openedTab.getAttribute('href');
			var openedPanel = document.querySelector(openedTarget);
			if (openedPanel !== null) {
				closePanel(openedPanel);
				openedTab.setAttribute('tabIndex', '-1');
				openedTab.setAttribute('aria-selected', 'false');
				openedTab.setAttribute('aria-expanded', 'false');
				openedTab.parentElement.classList.remove('active');
			}
		}
		var target = tab.hasAttribute('data-target')
				? tab.getAttribute('data-target')
				: tab.getAttribute('href');
		var panel = document.querySelector(target);
		openPanel(panel);
		tab.parentElement.classList.add('active');
		tab.setAttribute('tabIndex', '0');
		tab.setAttribute('aria-selected', 'true');
		tab.setAttribute('aria-expanded', 'true');
	};

	var tablist = document.querySelector('.simulator-container .step-panels-list');
	if (null !== tablist) {
		var lis = tablist.querySelectorAll('li');
		var tabs = tablist.querySelectorAll('[data-toggle="tab"]');

		tablist.setAttribute('role', 'tablist');
		lis.forEach( li => li.setAttribute('role', 'presentation'));

		tabs.forEach( (tab, index) => {
			var target = tab.hasAttribute('data-target')
				? tab.getAttribute('data-target')
				: tab.getAttribute('href');
			var panel = document.querySelector(target);
			var tabid = tab.getAttribute('id') || uniqueId('ui-tab');
			tab.setAttribute('id', tabid);
			tab.setAttribute('role', 'tab');
			tab.setAttribute('aria-controls', target.substr(1));
			panel.setAttribute('role', 'tabpanel');
			panel.setAttribute('aria-labelledby', tabid);
			if (tab.parentElement.classList.contains('active')) {
				tab.setAttribute('tabIndex', '0');
				tab.setAttribute('aria-selected', 'true');
				panel.setAttribute('tabIndex', '0');
				panel.setAttribute('aria-hidden', 'false');
			} else {
				tab.setAttribute('tabIndex', '-1');
				tab.setAttribute('aria-selected', 'false');
				closePanel(panel);
				tab.parentElement.classList.remove('active');
			}

			tab.addEventListener('keydown', function (event) {
				var key = event.which || event.keyCode;
				if ([37, 38, 39, 40].indexOf(key) < 0) {
					return;
				}
				var tablist = this.closest('ul[role=tablist] ');
				if (tablist === null) {
					return;
				}
				var tabs = tablist.querySelectorAll('[role=tab]');
				var index = -1;
				tabs.forEach( (that, i) => {
					if (that === this) {
						index = i;
					}
				});
				if (key == 38 || key == 37) { // up & left
					index--;
				}
				if (key == 39 || key == 40) { // down & right
					index++;
				}
				if (index < 0) {
					index = tabs.length -1;
				}
				if (index == tabs.length) {
					index = 0;
				}
				var nextTab = tabs[index];
				if (nextTab.getAttribute('role') === 'tab') {
					selectTab(nextTab);			//Comment this line for dynamically loaded tabPabels, to save Ajax requests on arrow key navigation
					nextTab.focus();
				}
				event.preventDefault();
				event.stopPropagation();
			});

			tab.addEventListener('click', function(event) {
				selectTab(this);
				event.preventDefault();
				event.stopPropagation();
			});

		});
	}

}(document, window));

(function () {
	"use strict";

	Date.msPERDAY = 1000 * 60 * 60 * 24;

	Date.locale = "en-us";

	Date.format = "d/m/Y";
	Date.inputFormat = "j/n/Y";

	Date.makeRegExp = function() {
		var matches = Date.inputFormat.match(/(j|n|Y)([^jnY]+)(j|n|Y)([^jnY]+)(j|n|Y)/);
		var regPart = [];
		var replacePart = [];
		for (var i = 1; i <= 5; i += 2) {
			if (matches[i] == 'j') {
				regPart.push('(\\d{1,2})');
				replacePart.push('$1');
			} else if (matches[i] == 'n') {
				regPart.push('(\\d{1,2})');
				replacePart.push('$2');
			} else {
				regPart.push('(\\d{4})');
				replacePart.push('$3');
			}
		}
		Date.regexp = regPart[0] + matches[2] + regPart[1] + matches[4] + regPart[2];
		Date.replacement = replacePart.join('.');
	}

	Date.setRegionalSettings = function(settings) {
		var locale = settings.locale.toLowerCase();
		if (! Date.locales[locale]) {
			locale = locale.substr(0, 2);
		}
		Date.locale = locale;
		Date.format = settings.dateFormat;
		Date.inputFormat = settings.dateFormat.replace('d', 'j').replace('m', 'n');
		Date.makeRegExp();
	}

	Date.easter = function(year) {
		try {
			year = Number( year );
			if ( year != year ) { 
				throw new TypeError( "Value must be a number." );
			}
			else if ( year > 275760 || year < -271820 ) {
				throw new RangeError( "Value be between -271820 and 275760 due to technical limitations of Date constructor." );
			}
		}
		catch ( e ) { console && console.log( e ); }
	 
		year = Math.floor( year );
		var c = Math.floor( year / 100 );
		var n = year - 19 * Math.floor( year / 19 );
		var k = Math.floor( ( c - 17 ) / 25 );
		var i = c - Math.floor( c / 4 ) - Math.floor( ( c - k ) / 3 ) + 19 * n + 15;
		i = i - 30 * Math.floor( i / 30 );
		i = i - Math.floor( i / 28 ) * ( 1 - Math.floor( i / 28 ) * Math.floor( 29 / ( i + 1 ) ) * Math.floor( ( 21 - n ) / 11 ) );
		var j = year + Math.floor( year / 4 ) + i + 2 - c + Math.floor( c / 4 );
		j = j - 7 * Math.floor( j / 7 );
		var l = i - j;
		var m = 3 + Math.floor( ( l + 40 ) / 44 );
		var d = l + 28 - 31 * Math.floor( m / 4 );
		var z = new Date();
		z.setFullYear(year);
		z.setMonth(m - 1);
		z.setDate(d);
		z.setHours(0,0,0,0);
		return z;
	};

	Date.nthDayOfMonth = function(nth, day, month, year) {
		var date = Date.createFromFormat("Y-n-j", year + "-" + month + "-01" );
		while(date.getDay()!=day){
			date.setDate(date.getDate()+1) ;
		}
		date.setDate(date.getDate() + (nth - 1) * 7);
		return date;
	}

	Date.holidaysOfYear = function(year, lang) {
		var country = "US";
		if (lang) {
			var c = lang.split("-");
			c = c[c.length - 1].toUpperCase();
			if (Date.holidays[c]) {
				country = c;
			}
		}
		var fixed =  Date.holidays[country].fixed_holidays;
		var holidays =  Date.holidays[country].moveable_holidays(year);
		for (var monthday of fixed) {
			holidays.push(Date.createFromFormat("Y-n-j", year + "-" + monthday));
		}
		return holidays;
	};

	Date.prototype.msPERDAY = Date.msPERDAY;

	Date.prototype.copy = function () { 
		return new Date( +this ); 
	};

	Date.prototype.workingDaysBefore = function(endDate) {
		// Validate input
		if (endDate < this)
			return 0;

		// Calculate days between dates
		var startDate = this.copy();
		startDate.setHours(0,0,0,1);  // Start just after midnight
		endDate.setHours(23,59,59,999);  // End just before midnight

		var diff = Date.UTC(endDate.getFullYear(), endDate.getMonth(), endDate.getDate()) - Date.UTC(startDate.getFullYear(), startDate.getMonth(), startDate.getDate());  // Milliseconds between datetime objects    
		var days = Math.ceil(diff / this.msPERDAY) + 1;

		// Subtract two weekend days for every week in between
		var weeks = Math.floor(days / 7);
		var days = days - (weeks * 2);

		// Handle special cases
		var startDay = startDate.getDay();
		var endDay = endDate.getDay();

		// Remove weekend not previously removed.   
		if (startDay - endDay > 1)
			days = days - 2;

		// Remove start day if span starts on Sunday but ends before Saturday
		if (startDay == 0 && endDay != 6)
			days = days - 1;

		// Remove end day if span ends on Saturday but starts after Sunday
		if (endDay == 6 && startDay != 0)
			days = days - 1;  

		var locale = Date.locale ? Date.locale : "en-us";
		var startYear = startDate.getFullYear();
		var endYear = endDate.getFullYear();
		startDate.setHours(0,0,0,0);
		for (var y = startYear; y <= endYear; y++) {
			var holidays = Date.holidaysOfYear(y, locale);
			for (var holiday of holidays) {
				var d = holiday.getDay();
				if (d != 0 && d != 6 && holiday >= startDate && holiday <= endDate)
					days = days - 1;
			}
		}
		return days;
	};

	Date.prototype.isWorkingDay = function() {
		var day = this.getDay();
		if (day == 0 || day == 6) {
			return false; 
		}
		var locale = Date.locale ? Date.locale : "en-us";
		var holidays = Date.holidaysOfYear(this.getFullYear(), locale);
		var isHoliday = false;
		var self = this;
		for (var holiday of holidays) {
			if (holiday == self) {
				isHoliday = true;
				return false;
			}
		}
		return ! isHoliday;
	}

	Date.prototype.nextWorkingDay = function() {
		var d = new Date(+this);
		while (! d.isWorkingDay()) {
			d.addDays(1); 
		}
		return d;
	};

	Date.prototype.firstDayOfMonth = function() {
		return new Date(this.getFullYear(), this.getMonth(), 1);
	};

	Date.prototype.lastDayOfMonth = function() {
		return new Date(this.getFullYear(), this.getMonth() + 1, 0);
	};

	Date.prototype.lastday = function() {
		var d = new Date(this.getFullYear(), this.getMonth() + 1, 0);
		return d.getDate();
	};

	Date.prototype.getDaysBetween = function(d) {
		var tmp = d.copy();
		tmp.setHours(this.getHours(), this.getMinutes(), this.getSeconds(), this.getMilliseconds());
		var diff = tmp.getTime() - this.getTime();
		return Math.ceil(diff/this.msPERDAY);
	};

	Date.prototype.getDayOfYear = function() {
		var start = new Date(this.getFullYear(), 0, 0);
		return this.getDaysBetween(start) * -1;
	};

	Date.prototype.getDaysInMonth = function(){
		var d = new Date(this.getFullYear(), this.getMonth()+1, 0);
		return d.getDate();
	};

	Date.prototype.getWeekNumber = function(){
		var d = new Date(+this);
		d.setHours(0,0,0);
		d.setDate(d.getDate()+4-(d.getDay()||7));
		return Math.ceil((((d-new Date(d.getFullYear(),0,1))/8.64e7)+1)/7);
	};

	Date.prototype.isLeapYear = function(utc) {
		var y = utc ? this.getUTCFullYear() : this.getFullYear();
		return !(y % 4) && (y % 100) || !(y % 400) ? true : false;
	};

	Date.prototype.addDays = function(d) {
		this.setTime( this.getTime() + d * Date.msPERDAY );
		return this;
	};

	Date.prototype.addWeeks = function(w) {
		this.addDays(w * 7);
		return this;
	};

	Date.prototype.addMonths = function(m) {
		var d = this.getDate();
		this.setMonth(this.getMonth() + m);
		if (this.getDate() < d)
			 this.setDate(0);
		return this;
	};

	Date.prototype.addYears = function(y) {
		var m = this.getMonth();
		this.setFullYear(this.getFullYear() + y);
		if (m < this.getMonth()) {
			this.setDate(0);
		}
		return this;
	};

	Date.prototype.addWeekDays = function(d) {
		var startDay = this.getDay();  //current weekday 0 thru 6
		var wkEnds = 0;                //# of weekends needed
		var partialWeek = d % 5;       //# of weekdays for partial week
		if (d < 0) {                   //subtracting weekdays 
			wkEnds = Math.ceil(d/5);   //negative number weekends
			switch (startDay) {
				case 6:                  //start Sat. 1 less weekend
					if (partialWeek == 0 && wkEnds < 0) 
					wkEnds++;
					break;
				case 0:                   //starting day is Sunday
					if (partialWeek == 0) 
						d++;              //decrease days to add
					else 
						d--;              //increase days to add
					break;
				default:
					if (partialWeek <= -startDay) 
						wkEnds--;
			}
		} else if (d > 0) {            //adding weekdays
			wkEnds = Math.floor(d/5);
			var w = wkEnds;
			switch (startDay) {
				case 6:
					/* If staring day is Sat. and
					 * no partial week one less day needed
					 * if partial week one more day needed
					 */
					if (partialWeek == 0) 
						d--;
					else 
						d++;
					break;
				case 0:        //Sunday
					if (partialWeek == 0 && wkEnds > 0) 
					wkEnds--;
					break;
				default:
					if (5 - day < partialWeek) 
						wkEnds++;
			}
		}
		d += wkEnds * 2;
		this.addDays(d);
		return this;
	};

	Date.prototype.getWeekDays = function(d) {
		var wkEnds = 0;
		var days = Math.abs(this.getDaysBetween(d));
		var startDay = 0, endDay = 0;
		if (days) {
			if (d < this) {
				startDay = d.getDay();
				endDay = this.getDay();
			} else {
				startDay = this.getDay();
				endDay = d.getDay();
			}
			wkEnds = Math.floor(days/7);
			if (startDay != 6 && startDay > endDay) 
				wkEnds++;
			if (startDay != endDay && (startDay == 6 || endDay == 6) ) 
				days--;
			days -= (wkEnds * 2);
		}
		return days;
	};

	Date.prototype.getMonthsBetween = function(d) {
		var sDate, eDate;   
		var d1 = this.getFullYear() * 12 + this.getMonth();
		var d2 = d.getFullYear() * 12 + d.getMonth();
		var sign;
		var months = 0;
		if (this == d) {
			months = 0;
		} else if (d1 == d2) { //same year and month
			months = (d.getDate() - this.getDate())/this.lastday();
		} else {
			if (d1 <  d2) {
				sDate = this;
				eDate = d;
				sign = 1;
			} else {
				sDate = d;
				eDate = this;
				sign = -1;
			}
			var sAdj = sDate.lastday() - sDate.getDate();
			var eAdj = eDate.getDate();
			var adj = (sAdj + eAdj)/sDate.lastday() -1;
			months = Math.abs(d2 - d1) + adj;
			months = (months * sign);
		}
		return months;
	};

	Date.prototype.getYearsBetween = function(d) {
		var months = this.getMonthsBetween(d);
		return months/12;
	};

	Date.prototype.getAge = function() {
		var today = new Date();
		return this.getYearsBetween(today).toFixed(2);
	};

	Date.prototype.sameDayEachWeek = function (day, date) {
		var aDays = new Array();
		var eDate, nextDate, adj;
		if (this > date) {
			eDate = this;
			nextDate = date.copy();
		} else {
			eDate = date;
			nextDate = this.copy();
		}
		adj = (day - nextDate.getDay() + 7) %7;
		nextDate.setDate(nextDate.getDate() + adj);
		while (nextDate < eDate) {
			aDays[aDays.length] = nextDate.copy();
			nextDate.setDate(nextDate.getDate() + 7);
		}
		return aDays;
	};

	Date.toDate = function(d) {
		var newDate;
		if (arguments.length == 0) {
			newDate = new Date();
		} else if (d instanceof Date) {
			newDate = new Date(d.getTime());
		} else if (typeof d == "string") {
			newDate = new Date(d);
		} else if (arguments.length >= 3) {
			var dte = [0, 0, 0, 0, 0, 0];
			for (var i = 0; i < arguments.length && i < 7; i++) {
				dte[i] = arguments[i];
			}
			newDate = new Date(dte[0], dte[1], dte[2], dte[3], dte[4], dte[5]);
		} else if (typeof d == "number") {
			newDate = new Date(d);
		} else {
			newDate = null;
		}  
		if (newDate == "Invalid Date")
			return null;
		else
			return newDate;
	};

	Date.prototype.setLocale = function (lang) {
		if (lang && lang in Date.locales) {
			Date.locale = lang;
		}
		return this;
	};

	Date.prototype.getLocale = function () {
		return Date.locale || "en";
	};

	Date.prototype.getMonthName = function (lang) {
		var locale = "en";
		if (lang && lang in Date.locales) {
			locale = lang;
		} else if (Date.locale && Date.locale in Date.locales) {
			locale = Date.locale;
		}
		return Date.locales[locale].month_names[this.getMonth()];
	};

	Date.prototype.getMonthNameShort = function (lang) {
		var locale = "en";
		if (lang && lang in Date.locales) {
			locale = lang;
		} else if (Date.locale && Date.locale in Date.locales) {
			locale = Date.locale;
		}
		return Date.locales[locale].month_names_short[this.getMonth()];
	};

	Date.prototype.getDayName = function (lang) {
		var locale = "en";
		if (lang && lang in Date.locales) {
			locale = lang;
		} else if (Date.locale && Date.locale in Date.locales) {
			locale = Date.locale;
		}
		return Date.locales[locale].day_names[this.getDay()];
	};

	Date.prototype.getDayNameShort = function (lang) {
		var locale = "en";
		if (lang && lang in Date.locales) {
			locale = lang;
		} else if (Date.locale && Date.locale in Date.locales) {
			locale = Date.locale;
		}
		return Date.locales[locale].day_names_short[this.getDay()];
	};

	Date.prototype.getDateSuffix = function (lang) {
		var locale = "en";
		if (lang && lang in Date.locales) {
			locale = lang;
		} else if (Date.locale && Date.locale in Date.locales) {
			locale = Date.locale;
		}
		return Date.locales[locale].date_suffix(this.getDate());
	};

	Date.prototype.getMeridiem = function (isLower, lang) {
		var locale = "en";
		if (lang && lang in Date.locales) {
			locale = lang;
		} else if (Date.locale && Date.locale in Date.locales) {
			locale = Date.locale;
		}
		return Date.locales[locale].meridiem(this.getHours(), this.getMinutes(), isLower);
	};

	Date.prototype.getLastDate = function () {
		return (new Date(this.getFullYear(), this.getMonth() + 1, 0)).getDate();
	};

	/* languages from http://momentjs.com */

	Date.locales = {
		"en": {
			month_names: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
			month_names_short: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
			day_names: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
			day_names_short: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
			date_suffix: function (date) {
				var day10 = ~~ (date % 100 / 10);
				var day1 = date % 10;
				if (day10 === 1) {
					return "th";
				} else if (day1 === 1) {
					return "st";
				} else if (day1 === 2) {
					return "nd";
				} else if (day1 === 3) {
					return "rd";
				} else {
					return "th";
				}
			},
			meridiem : function (hour, minute, isLower) {
				if (hour < 12) {
					return isLower ? "am" : "AM";
				} else {
					return isLower ? "pm" : "PM";
				}
			}
		},
		"en-us": {
			month_names: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
			month_names_short: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
			day_names: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
			day_names_short: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
			date_suffix: function (date) {
				var day10 = ~~ (date % 100 / 10);
				var day1 = date % 10;
				if (day10 === 1) {
					return "th";
				} else if (day1 === 1) {
					return "st";
				} else if (day1 === 2) {
					return "nd";
				} else if (day1 === 3) {
					return "rd";
				} else {
					return "th";
				}
			},
			meridiem : function (hour, minute, isLower) {
				if (hour < 12) {
					return isLower ? "am" : "AM";
				} else {
					return isLower ? "pm" : "PM";
				}
			}
		},
		"ar-ma": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem : function (hour, minute, isLower) {
				return "";
			}
		},
		"ar": {
			month_names: "/  _/ _/ _/ _/ _/ _/ _/ _/ _/  _/  _/  ".split("_"),
			month_names_short: "/  _/ _/ _/ _/ _/ _/ _/ _/ _/  _/  _/  ".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"bg": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				var lastDigit = date % 10,
					last2Digits = date % 100;
				if (date === 0) {
					return '-';
				} else if (last2Digits === 0) {
					return '-';
				} else if (last2Digits > 10 && last2Digits < 20) {
					return '-';
				} else if (lastDigit === 1) {
					return '-';
				} else if (lastDigit === 2) {
					return '-';
				} else if (lastDigit === 7 || lastDigit === 8) {
					return '-';
				} else {
					return '-';
				}
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"br": {
			month_names: "Genver_C'hwevrer_Meurzh_Ebrel_Mae_Mezheven_Gouere_Eost_Gwengolo_Here_Du_Kerzu".split("_"),
			month_names_short: "Gen_C'hwe_Meu_Ebr_Mae_Eve_Gou_Eos_Gwe_Her_Du_Ker".split("_"),
			day_names: "Sul_Lun_Meurzh_Merc'her_Yaou_Gwener_Sadorn".split("_"),
			day_names_short: "Sul_Lun_Meu_Mer_Yao_Gwe_Sad".split("_"),
			date_suffix: function (date) {
				return (date === 1) ? 'a' : 'vet';
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"bs": {
			month_names: "januar_februar_mart_april_maj_juni_juli_avgust_septembar_oktobar_novembar_decembar".split("_"),
			month_names_short: "jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),
			day_names: "nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),
			day_names_short: "ned._pon._uto._sri._et._pet._sub.".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"ca": {
			month_names: "gener_febrer_mar_abril_maig_juny_juliol_agost_setembre_octubre_novembre_desembre".split("_"),
			month_names_short: "gen._febr._mar._abr._mai._jun._jul._ag._set._oct._nov._des.".split("_"),
			day_names: "diumenge_dilluns_dimarts_dimecres_dijous_divendres_dissabte".split("_"),
			day_names_short: "dg._dl._dt._dc._dj._dv._ds.".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"cs": {
			month_names: "leden_nor_bezen_duben_kvten_erven_ervenec_srpen_z_jen_listopad_prosinec".split("_"),
			month_names_short: "led_no_be_dub_kv_vn_vc_srp_z_j_lis_pro".split("_"),
			day_names: "nedle_pondl_ter_steda_tvrtek_ptek_sobota".split("_"),
			day_names_short: "ne_po_t_st_t_p_so".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"cv": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "-";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"cy": {
			month_names: "Ionawr_Chwefror_Mawrth_Ebrill_Mai_Mehefin_Gorffennaf_Awst_Medi_Hydref_Tachwedd_Rhagfyr".split("_"),
			month_names_short: "Ion_Chwe_Maw_Ebr_Mai_Meh_Gor_Aws_Med_Hyd_Tach_Rhag".split("_"),
			day_names: "Dydd Sul_Dydd Llun_Dydd Mawrth_Dydd Mercher_Dydd Iau_Dydd Gwener_Dydd Sadwrn".split("_"),
			day_names_short: "Sul_Llun_Maw_Mer_Iau_Gwe_Sad".split("_"),
			date_suffix: function (date) {
				var b = date,
					output = '',
					lookup = [
						'', 'af', 'il', 'ydd', 'ydd', 'ed', 'ed', 'ed', 'fed', 'fed', 'fed', // 1af to 10fed
						'eg', 'fed', 'eg', 'eg', 'fed', 'eg', 'eg', 'fed', 'eg', 'fed' // 11eg to 20fed
					];

				if (b > 20) {
					if (b === 40 || b === 50 || b === 60 || b === 80 || b === 100) {
						output = 'fed'; // not 30ain, 70ain or 90ain
					} else {
						output = 'ain';
					}
				} else if (b > 0) {
					output = lookup[b];
				}

				return output;
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"da": {
			month_names: "januar_februar_marts_april_maj_juni_juli_august_september_oktober_november_december".split("_"),
			month_names_short: "jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),
			day_names: "sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),
			day_names_short: "sn_man_tir_ons_tor_fre_lr".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"de": {
			month_names: "Januar_Februar_Mrz_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),
			month_names_short: "Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),
			day_names: "Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),
			day_names_short: "So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"el": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				if (hour > 11) {
					return isLower ? '' : '';
				} else {
					return isLower ? '' : '';
				}
			}
		},
		"en-au": {
			month_names: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
			month_names_short: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
			day_names: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
			day_names_short: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
			date_suffix: function (date) {
				var day10 = ~~ (date % 100 / 10);
				var day1 = date % 10;
				if (day10 === 1) {
					return "th";
				} else if (day1 === 1) {
					return "st";
				} else if (day1 === 2) {
					return "nd";
				} else if (day1 === 3) {
					return "rd";
				} else {
					return "th";
				}
			},
			meridiem: function (hour, minute, isLower) {
				if (hour < 12) {
					return isLower ? "am" : "AM";
				} else {
					return isLower ? "pm" : "PM";
				}
			}
		},
		"en-ca": {
			month_names: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
			month_names_short: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
			day_names: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
			day_names_short: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
			date_suffix: function (date) {
				var day10 = ~~ (date % 100 / 10);
				var day1 = date % 10;
				if (day10 === 1) {
					return "th";
				} else if (day1 === 1) {
					return "st";
				} else if (day1 === 2) {
					return "nd";
				} else if (day1 === 3) {
					return "rd";
				} else {
					return "th";
				}
			},
			meridiem: function (hour, minute, isLower) {
				if (hour < 12) {
					return isLower ? "am" : "AM";
				} else {
					return isLower ? "pm" : "PM";
				}
			}
		},
		"en-gb": {
			month_names: ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"],
			month_names_short: ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"],
			day_names: ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"],
			day_names_short: ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"],
			date_suffix: function (date) {
				var day10 = ~~ (date % 100 / 10);
				var day1 = date % 10;
				if (day10 === 1) {
					return "th";
				} else if (day1 === 1) {
					return "st";
				} else if (day1 === 2) {
					return "nd";
				} else if (day1 === 3) {
					return "rd";
				} else {
					return "th";
				}
			},
			meridiem: function (hour, minute, isLower) {
				if (hour < 12) {
					return isLower ? "am" : "AM";
				} else {
					return isLower ? "pm" : "PM";
				}
			}
		},
		"eo": {
			month_names: "januaro_februaro_marto_aprilo_majo_junio_julio_agusto_septembro_oktobro_novembro_decembro".split("_"),
			month_names_short: "jan_feb_mar_apr_maj_jun_jul_ag_sep_okt_nov_dec".split("_"),
			day_names: "Dimano_Lundo_Mardo_Merkredo_ado_Vendredo_Sabato".split("_"),
			day_names_short: "Dim_Lun_Mard_Merk_a_Ven_Sab".split("_"),
			date_suffix: function (date) {
				return "a";
			},
			meridiem: function (hour, minute, isLower) {
				if (hour < 12) {
					return isLower ? 'a.t.m.' : 'A.T.M.';
				} else {
					return isLower ? 'p.t.m.' : 'P.T.M.';
				}
			}
		},
		"es": {
			month_names: "enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),
			month_names_short: "ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_"),
			day_names: "domingo_lunes_martes_mircoles_jueves_viernes_sbado".split("_"),
			day_names_short: "dom._lun._mar._mi._jue._vie._sb.".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"et": {
			month_names: "jaanuar_veebruar_mrts_aprill_mai_juuni_juuli_august_september_oktoober_november_detsember".split("_"),
			month_names_short: "jaan_veebr_mrts_apr_mai_juuni_juuli_aug_sept_okt_nov_dets".split("_"),
			day_names: "phapev_esmaspev_teisipev_kolmapev_neljapev_reede_laupev".split("_"),
			day_names_short: "P_E_T_K_N_R_L".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"eu": {
			month_names: "urtarrila_otsaila_martxoa_apirila_maiatza_ekaina_uztaila_abuztua_iraila_urria_azaroa_abendua".split("_"),
			month_names_short: "urt._ots._mar._api._mai._eka._uzt._abu._ira._urr._aza._abe.".split("_"),
			day_names: "igandea_astelehena_asteartea_asteazkena_osteguna_ostirala_larunbata".split("_"),
			day_names_short: "ig._al._ar._az._og._ol._lr.".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"fa": {
			month_names: '___________'.split('_'),
			month_names_short: '___________'.split('_'),
			day_names: '\u200c__\u200c__\u200c__'.split('_'),
			day_names_short: '\u200c__\u200c__\u200c__'.split('_'),
			meridiem: function (hour, minute, isLower) {
				if (hour < 12) {
					return "  ";
				} else {
					return "  ";
				}
			},
			date_suffix: function (date) {
				return '';
			}
		},
		"fi": {
			month_names: "tammikuu_helmikuu_maaliskuu_huhtikuu_toukokuu_keskuu_heinkuu_elokuu_syyskuu_lokakuu_marraskuu_joulukuu".split("_"),
			month_names_short: "tammi_helmi_maalis_huhti_touko_kes_hein_elo_syys_loka_marras_joulu".split("_"),
			day_names: "sunnuntai_maanantai_tiistai_keskiviikko_torstai_perjantai_lauantai".split("_"),
			day_names_short: "su_ma_ti_ke_to_pe_la".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"fo": {
			month_names: "januar_februar_mars_aprl_mai_juni_juli_august_september_oktober_november_desember".split("_"),
			month_names_short: "jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),
			day_names: "sunnudagur_mnadagur_tsdagur_mikudagur_hsdagur_frggjadagur_leygardagur".split("_"),
			day_names_short: "sun_mn_ts_mik_hs_fr_ley".split("_"),
			date_suffix: function () {
				return '.';
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"fr-ca": {
			month_names: "janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),
			month_names_short: "janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),
			day_names: "dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),
			day_names_short: "dim._lun._mar._mer._jeu._ven._sam.".split("_"),
			date_suffix: function (date) {
				return (date === 1 ? 'er' : '');
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"fr": {
			month_names: "janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),
			month_names_short: "janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),
			day_names: "dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),
			day_names_short: "dim._lun._mar._mer._jeu._ven._sam.".split("_"),
			date_suffix: function (date) {
				return (date === 1 ? 'er' : '');
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"fr-fr": {
			month_names: "janvier_fvrier_mars_avril_mai_juin_juillet_aot_septembre_octobre_novembre_dcembre".split("_"),
			month_names_short: "janv._fvr._mars_avr._mai_juin_juil._aot_sept._oct._nov._dc.".split("_"),
			day_names: "dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),
			day_names_short: "dim._lun._mar._mer._jeu._ven._sam.".split("_"),
			date_suffix: function (date) {
				return (date === 1 ? 'er' : '');
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"gl": {
			month_names: "Xaneiro_Febreiro_Marzo_Abril_Maio_Xuo_Xullo_Agosto_Setembro_Outubro_Novembro_Decembro".split("_"),
			month_names_short: "Xan._Feb._Mar._Abr._Mai._Xu._Xul._Ago._Set._Out._Nov._Dec.".split("_"),
			day_names: "Domingo_Luns_Martes_Mrcores_Xoves_Venres_Sbado".split("_"),
			day_names_short: "Dom._Lun._Mar._Mr._Xov._Ven._Sb.".split("_"),
			date_suffix: function (date) {
				return '';
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"he": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"hi": {
			month_names: '___________'.split("_"),
			month_names_short: '._.__.___._._._._._.'.split("_"),
			day_names: '______'.split("_"),
			day_names_short: '______'.split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 4) {
					return "";
				} else if (hour < 10) {
					return "";
				} else if (hour < 17) {
					return "";
				} else if (hour < 20) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (date) {
				return "";
			}
		},
		"hr": {
			month_names: "sjeanj_veljaa_oujak_travanj_svibanj_lipanj_srpanj_kolovoz_rujan_listopad_studeni_prosinac".split("_"),
			month_names_short: "sje._vel._ou._tra._svi._lip._srp._kol._ruj._lis._stu._pro.".split("_"),
			day_names: "nedjelja_ponedjeljak_utorak_srijeda_etvrtak_petak_subota".split("_"),
			day_names_short: "ned._pon._uto._sri._et._pet._sub.".split("_"),
			date_suffix: function () {
				return '.';
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"hu": {
			month_names: "janur_februr_mrcius_prilis_mjus_jnius_jlius_augusztus_szeptember_oktber_november_december".split("_"),
			month_names_short: "jan_feb_mrc_pr_mj_jn_jl_aug_szept_okt_nov_dec".split("_"),
			day_names: "vasrnap_htf_kedd_szerda_cstrtk_pntek_szombat".split("_"),
			day_names_short: "vas_ht_kedd_sze_cst_pn_szo".split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 12) {
					return isLower === true ? 'de' : 'DE';
				} else {
					return isLower === true ? 'du' : 'DU';
				}
			},
			date_suffix: function () {
				return '.';
			}
		},
		"hy-am": {
			month_names: '___________'.split('_'),
			month_names_short: '___________'.split('_'),
			day_names: '______'.split('_'),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				if (hour < 4) {
					return "";
				} else if (hour < 12) {
					return "";
				} else if (hour < 17) {
					return "";
				} else {
					return "";
				}
			}
		},
		"id": {
			month_names: "Januari_Februari_Maret_April_Mei_Juni_Juli_Agustus_September_Oktober_November_Desember".split("_"),
			month_names_short: "Jan_Feb_Mar_Apr_Mei_Jun_Jul_Ags_Sep_Okt_Nov_Des".split("_"),
			day_names: "Minggu_Senin_Selasa_Rabu_Kamis_Jumat_Sabtu".split("_"),
			day_names_short: "Min_Sen_Sel_Rab_Kam_Jum_Sab".split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 11) {
					return 'pagi';
				} else if (hour < 15) {
					return 'siang';
				} else if (hour < 19) {
					return 'sore';
				} else {
					return 'malam';
				}
			},
			date_suffix: function (date) {
				return "";
			}
		},
		"is": {
			month_names: "janar_febrar_mars_aprl_ma_jn_jl_gst_september_oktber_nvember_desember".split("_"),
			month_names_short: "jan_feb_mar_apr_ma_jn_jl_g_sep_okt_nv_des".split("_"),
			day_names: "sunnudagur_mnudagur_rijudagur_mivikudagur_fimmtudagur_fstudagur_laugardagur".split("_"),
			day_names_short: "sun_mn_ri_mi_fim_fs_lau".split("_"),
			date_suffix: function () {
				return '.';
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"it": {
			month_names: "Gennaio_Febbraio_Marzo_Aprile_Maggio_Giugno_Luglio_Agosto_Settembre_Ottobre_Novembre_Dicembre".split("_"),
			month_names_short: "Gen_Feb_Mar_Apr_Mag_Giu_Lug_Ago_Set_Ott_Nov_Dic".split("_"),
			day_names: "Domenica_Luned_Marted_Mercoled_Gioved_Venerd_Sabato".split("_"),
			day_names_short: "Dom_Lun_Mar_Mer_Gio_Ven_Sab".split("_"),
			date_suffix: function () {
				return '';
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"ja": {
			month_names: "1_2_3_4_5_6_7_8_9_10_11_12".split("_"),
			month_names_short: "1_2_3_4_5_6_7_8_9_10_11_12".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 12) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (date) {
				return "";
			}
		},
		"ka": {
			month_names: '___________'.split('_'),
			month_names_short: "___________".split("_"),
			day_names: '______'.split('_'),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				if (date === 0) {
					return "";
				}

				if (date === 1) {
					return "-";
				}

				if ((date < 20) || (date <= 100 && (date % 20 === 0)) || (date % 100 === 0)) {
					return "-";
				}

				return "-";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"km": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"ko": {
			month_names: "1_2_3_4_5_6_7_8_9_10_11_12".split("_"),
			month_names_short: "1_2_3_4_5_6_7_8_9_10_11_12".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return hour < 12 ? '' : '';
			}
		},
		"lb": {
			month_names: "Januar_Februar_Merz_Abrll_Mee_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),
			month_names_short: "Jan._Febr._Mrz._Abr._Mee_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),
			day_names: "Sonndeg_Mindeg_Dnschdeg_Mttwoch_Donneschdeg_Freideg_Samschdeg".split("_"),
			day_names_short: "So._M._D._M._Do._Fr._Sa.".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"lt": {
			month_names: "sausio_vasario_kovo_balandio_gegus_birlio_liepos_rugpjio_rugsjo_spalio_lapkriio_gruodio".split("_"),
			month_names_short: "sau_vas_kov_bal_geg_bir_lie_rgp_rgs_spa_lap_grd".split("_"),
			day_names: "pirmadienis_antradienis_treiadienis_ketvirtadienis_penktadienis_etadienis_sekmadienis".split("_"),
			day_names_short: "Sek_Pir_Ant_Tre_Ket_Pen_e".split("_"),
			date_suffix: function (date) {
				return "-oji";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"lv": {
			month_names: "janvris_februris_marts_aprlis_maijs_jnijs_jlijs_augusts_septembris_oktobris_novembris_decembris".split("_"),
			month_names_short: "jan_feb_mar_apr_mai_jn_jl_aug_sep_okt_nov_dec".split("_"),
			day_names: "svtdiena_pirmdiena_otrdiena_trediena_ceturtdiena_piektdiena_sestdiena".split("_"),
			day_names_short: "Sv_P_O_T_C_Pk_S".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"mk": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				var lastDigit = date % 10,
					last2Digits = date % 100;
				if (date === 0) {
					return '-';
				} else if (last2Digits === 0) {
					return '-';
				} else if (last2Digits > 10 && last2Digits < 20) {
					return '-';
				} else if (lastDigit === 1) {
					return '-';
				} else if (lastDigit === 2) {
					return '-';
				} else if (lastDigit === 7 || lastDigit === 8) {
					return '-';
				} else {
					return '-';
				}
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"ml": {
			month_names: '___________'.split("_"),
			month_names_short: '._._._.___._._._._._.'.split("_"),
			day_names: '______'.split("_"),
			day_names_short: '______'.split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 4) {
					return "";
				} else if (hour < 12) {
					return "";
				} else if (hour < 17) {
					return " ";
				} else if (hour < 20) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (date) {
				return "";
			}
		},
		"mr": {
			month_names: '___________'.split("_"),
			month_names_short: '._._._._._._._._._._._.'.split("_"),
			day_names: '______'.split("_"),
			day_names_short: '______'.split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 4) {
					return "";
				} else if (hour < 10) {
					return "";
				} else if (hour < 17) {
					return "";
				} else if (hour < 20) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (date) {
				return "";
			}
		},
		"ms-my": {
			month_names: "Januari_Februari_Mac_April_Mei_Jun_Julai_Ogos_September_Oktober_November_Disember".split("_"),
			month_names_short: "Jan_Feb_Mac_Apr_Mei_Jun_Jul_Ogs_Sep_Okt_Nov_Dis".split("_"),
			day_names: "Ahad_Isnin_Selasa_Rabu_Khamis_Jumaat_Sabtu".split("_"),
			day_names_short: "Ahd_Isn_Sel_Rab_Kha_Jum_Sab".split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 11) {
					return 'pagi';
				} else if (hour < 15) {
					return 'tengahari';
				} else if (hour < 19) {
					return 'petang';
				} else {
					return 'malam';
				}
			},
			date_suffix: function (date) {
				return "";
			}
		},
		"nb": {
			month_names: "januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),
			month_names_short: "jan._feb._mars_april_mai_juni_juli_aug._sep._okt._nov._des.".split("_"),
			day_names: "sndag_mandag_tirsdag_onsdag_torsdag_fredag_lrdag".split("_"),
			day_names_short: "s._ma._ti._on._to._fr._l.".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"ne": {
			month_names: '___________'.split("_"),
			month_names_short: '._.__.___._._._._._.'.split("_"),
			day_names: '______'.split("_"),
			day_names_short: '._._._._._._.'.split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 3) {
					return "";
				} else if (hour < 10) {
					return "";
				} else if (hour < 15) {
					return "";
				} else if (hour < 18) {
					return "";
				} else if (hour < 20) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (date) {
				return "";
			}
		},
		"nl": {
			month_names: "januari_februari_maart_april_mei_juni_juli_augustus_september_oktober_november_december".split("_"),
			month_names_short: "jan._feb._mrt._apr._mei_jun._jul._aug._sep._okt._nov._dec.".split("_"),
			day_names: "zondag_maandag_dinsdag_woensdag_donderdag_vrijdag_zaterdag".split("_"),
			day_names_short: "zo._ma._di._wo._do._vr._za.".split("_"),
			date_suffix: function (date) {
				return ((date === 1 || date === 8 || date >= 20) ? 'ste' : 'de');
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"nn": {
			month_names: "januar_februar_mars_april_mai_juni_juli_august_september_oktober_november_desember".split("_"),
			month_names_short: "jan_feb_mar_apr_mai_jun_jul_aug_sep_okt_nov_des".split("_"),
			day_names: "sundag_mndag_tysdag_onsdag_torsdag_fredag_laurdag".split("_"),
			day_names_short: "sun_mn_tys_ons_tor_fre_lau".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"pl": {
			month_names: "stycze_luty_marzec_kwiecie_maj_czerwiec_lipiec_sierpie_wrzesie_padziernik_listopad_grudzie".split("_"),
			month_names_short: "sty_lut_mar_kwi_maj_cze_lip_sie_wrz_pa_lis_gru".split("_"),
			day_names: "niedziela_poniedziaek_wtorek_roda_czwartek_pitek_sobota".split("_"),
			day_names_short: "nie_pon_wt_r_czw_pt_sb".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"pt-br": {
			month_names: "janeiro_fevereiro_maro_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),
			month_names_short: "jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),
			day_names: "domingo_segunda-feira_tera-feira_quarta-feira_quinta-feira_sexta-feira_sbado".split("_"),
			day_names_short: "dom_seg_ter_qua_qui_sex_sb".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"pt": {
			month_names: "janeiro_fevereiro_maro_abril_maio_junho_julho_agosto_setembro_outubro_novembro_dezembro".split("_"),
			month_names_short: "jan_fev_mar_abr_mai_jun_jul_ago_set_out_nov_dez".split("_"),
			day_names: "domingo_segunda-feira_tera-feira_quarta-feira_quinta-feira_sexta-feira_sbado".split("_"),
			day_names_short: "dom_seg_ter_qua_qui_sex_sb".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"ro": {
			month_names: "ianuarie_februarie_martie_aprilie_mai_iunie_iulie_august_septembrie_octombrie_noiembrie_decembrie".split("_"),
			month_names_short: "ian._febr._mart._apr._mai_iun._iul._aug._sept._oct._nov._dec.".split("_"),
			day_names: "duminic_luni_mari_miercuri_joi_vineri_smbt".split("_"),
			day_names_short: "Dum_Lun_Mar_Mie_Joi_Vin_Sm".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"ru": {
			month_names: '___________'.split('_'),
			month_names_short: '___________'.split('_'),
			day_names: '______'.split('_'),
			day_names_short: "______".split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 4) {
					return "";
				} else if (hour < 12) {
					return "";
				} else if (hour < 17) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (date) {
				return '-';
			}
		},
		"sk": {
			month_names: "janur_februr_marec_aprl_mj_jn_jl_august_september_oktber_november_december".split("_"),
			month_names_short: "jan_feb_mar_apr_mj_jn_jl_aug_sep_okt_nov_dec".split("_"),
			day_names: "nedea_pondelok_utorok_streda_tvrtok_piatok_sobota".split("_"),
			day_names_short: "ne_po_ut_st_t_pi_so".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"sl": {
			month_names: "januar_februar_marec_april_maj_junij_julij_avgust_september_oktober_november_december".split("_"),
			month_names_short: "jan._feb._mar._apr._maj._jun._jul._avg._sep._okt._nov._dec.".split("_"),
			day_names: "nedelja_ponedeljek_torek_sreda_etrtek_petek_sobota".split("_"),
			day_names_short: "ned._pon._tor._sre._et._pet._sob.".split("_"),
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"sq": {
			month_names: "Janar_Shkurt_Mars_Prill_Maj_Qershor_Korrik_Gusht_Shtator_Tetor_Nntor_Dhjetor".split("_"),
			month_names_short: "Jan_Shk_Mar_Pri_Maj_Qer_Kor_Gus_Sht_Tet_Nn_Dhj".split("_"),
			day_names: "E Diel_E Hn_E Mart_E Mrkur_E Enjte_E Premte_E Shtun".split("_"),
			day_names_short: "Die_Hn_Mar_Mr_Enj_Pre_Sht".split("_"),
			meridiem: function (hour, minute, isLower) {
				return hour < 12 ? 'PD' : 'MD';
			},
			date_suffix: function (date) {
				return ".";
			}
		},
		"sr-cyr": {
			month_names: ['', '', '', '', '', '', '', '', '', '', '', ''],
			month_names_short: ['.', '.', '.', '.', '', '', '', '.', '.', '.', '.', '.'],
			day_names: ['', '', '', '', '', '', ''],
			day_names_short: ['.', '.', '.', '.', '.', '.', '.'],
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"sr": {
			month_names: ['januar', 'februar', 'mart', 'april', 'maj', 'jun', 'jul', 'avgust', 'septembar', 'oktobar', 'novembar', 'decembar'],
			month_names_short: ['jan.', 'feb.', 'mar.', 'apr.', 'maj', 'jun', 'jul', 'avg.', 'sep.', 'okt.', 'nov.', 'dec.'],
			day_names: ['nedelja', 'ponedeljak', 'utorak', 'sreda', 'etvrtak', 'petak', 'subota'],
			day_names_short: ['ned.', 'pon.', 'uto.', 'sre.', 'et.', 'pet.', 'sub.'],
			date_suffix: function (date) {
				return ".";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"sv": {
			month_names: "januari_februari_mars_april_maj_juni_juli_augusti_september_oktober_november_december".split("_"),
			month_names_short: "jan_feb_mar_apr_maj_jun_jul_aug_sep_okt_nov_dec".split("_"),
			day_names: "sndag_mndag_tisdag_onsdag_torsdag_fredag_lrdag".split("_"),
			day_names_short: "sn_mn_tis_ons_tor_fre_lr".split("_"),
			date_suffix: function (number) {
				var b = number % 10,
					output = (~~(number % 100 / 10) === 1) ? 'e' :
					(b === 1) ? 'a' :
					(b === 2) ? 'a' :
					(b === 3) ? 'e' : 'e';
				return output;
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"ta": {
			month_names: '___________'.split("_"),
			month_names_short: '___________'.split("_"),
			day_names: '______'.split("_"),
			day_names_short: '______'.split("_"),
			date_suffix: function (date) {
				return '';
			},
			meridiem: function (hour, minute, isLower) {
				if (hour >= 6 && hour <= 10) {
					return " ";
				} else if (hour >= 10 && hour <= 14) {
					return " ";
				} else if (hour >= 14 && hour <= 18) {
					return " ";
				} else if (hour >= 18 && hour <= 20) {
					return " ";
				} else if (hour >= 20 && hour <= 24) {
					return " ";
				} else if (hour >= 0 && hour <= 6) {
					return " ";
				}
			}
		},
		"th": {
			month_names: "_ ___ _______".split("_"),
			month_names_short: "_ ___ _______".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			meridiem: function (hour, minute, isLower) {
				if (hour < 12) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (date) {
				return "";
			}
		},
		"tl-ph": {
			month_names: "Enero_Pebrero_Marso_Abril_Mayo_Hunyo_Hulyo_Agosto_Setyembre_Oktubre_Nobyembre_Disyembre".split("_"),
			month_names_short: "Ene_Peb_Mar_Abr_May_Hun_Hul_Ago_Set_Okt_Nob_Dis".split("_"),
			day_names: "Linggo_Lunes_Martes_Miyerkules_Huwebes_Biyernes_Sabado".split("_"),
			day_names_short: "Lin_Lun_Mar_Miy_Huw_Biy_Sab".split("_"),
			date_suffix: function (number) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"tr": {
			month_names: "Ocak_ubat_Mart_Nisan_Mays_Haziran_Temmuz_Austos_Eyll_Ekim_Kasm_Aralk".split("_"),
			month_names_short: "Oca_ub_Mar_Nis_May_Haz_Tem_Au_Eyl_Eki_Kas_Ara".split("_"),
			day_names: "Pazar_Pazartesi_Sal_aramba_Perembe_Cuma_Cumartesi".split("_"),
			day_names_short: "Paz_Pts_Sal_ar_Per_Cum_Cts".split("_"),
			date_suffix: function (number) {
				if (number === 0) { // special case for zero
					return number + "'nc";
				}
				var a = number % 10,
					b = number % 100 - a,
					c = number >= 100 ? 100 : null;

				return (suffixes[a] || suffixes[b] || suffixes[c]);
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"tzm-la": {
			month_names: "innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),
			month_names_short: "innayr_brayr_mars_ibrir_mayyw_ywnyw_ywlywz_wt_wtanbir_ktwbr_nwwanbir_dwjnbir".split("_"),
			day_names: "asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),
			day_names_short: "asamas_aynas_asinas_akras_akwas_asimwas_asiyas".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"tzm": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"uk": {
			month_names: '___________'.split('_'),
			month_names_short: "___________".split("_"),
			day_names: '______'.split('_'),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "-";
			},
			meridiem: function (hour, minute, isLower) {
				if (hour < 4) {
					return "";
				} else if (hour < 12) {
					return "";
				} else if (hour < 17) {
					return "";
				} else {
					return "";
				}
			}
		},
		"uz": {
			month_names: "___________".split("_"),
			month_names_short: "___________".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"vi": {
			month_names: "thng 1_thng 2_thng 3_thng 4_thng 5_thng 6_thng 7_thng 8_thng 9_thng 10_thng 11_thng 12".split("_"),
			month_names_short: "Th01_Th02_Th03_Th04_Th05_Th06_Th07_Th08_Th09_Th10_Th11_Th12".split("_"),
			day_names: "ch nht_th hai_th ba_th t_th nm_th su_th by".split("_"),
			day_names_short: "CN_T2_T3_T4_T5_T6_T7".split("_"),
			date_suffix: function (date) {
				return "";
			},
			meridiem: function (hour, minute, isLower) {
				return "";
			}
		},
		"zh-cn": {
			month_names: "___________".split("_"),
			month_names_short: "1_2_3_4_5_6_7_8_9_10_11_12".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			meridiem: function (hour, minute, isLower) {
				var hm = hour * 100 + minute;
				if (hm < 600) {
					return "";
				} else if (hm < 900) {
					return "";
				} else if (hm < 1130) {
					return "";
				} else if (hm < 1230) {
					return "";
				} else if (hm < 1800) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (number, period) {
				return number + "";

			}
		},
		"zh-tw": {
			month_names: "___________".split("_"),
			month_names_short: "1_2_3_4_5_6_7_8_9_10_11_12".split("_"),
			day_names: "______".split("_"),
			day_names_short: "______".split("_"),
			meridiem: function (hour, minute, isLower) {
				var hm = hour * 100 + minute;
				if (hm < 900) {
					return "";
				} else if (hm < 1130) {
					return "";
				} else if (hm < 1230) {
					return "";
				} else if (hm < 1800) {
					return "";
				} else {
					return "";
				}
			},
			date_suffix: function (number, period) {
				return number + "";
			}

		}
	};

	Date.holidays = {
		"FR": {
			fixed_holidays: ["01-01", "05-01", "05-08", "07-14", "08-15", "11-01", "11-11", "12-25"],
			moveable_holidays: function(year) {
				var holidays = [];
				var easter = Date.easter(year);
				holidays.push(easter.copy());
				holidays.push(easter.addDays(1).copy());
				holidays.push(easter.addDays(38).copy());
				holidays.push(easter.addDays(10).copy());
				holidays.push(easter.addDays(1).copy());
				return holidays;
			}
		},
		"US": {
			fixed_holidays: ["01-01", "07-04", "11-01", "12-25"],
			moveable_holidays: function(year) {
				return [];
			}
		},
	};

	Date.prototype.format = function (formatString) {

		var addPadding = function (value, length) {
			var negative = ((value < 0) ? "-" : "");
			var zeros = "0";
			for (var i = 2; i < length; i++) {
				zeros += "0";
			}
			return negative + (zeros + Math.abs(value).toString()).slice(-length);
		};

		var replacements = {
			date: this,
			d: function () {
				return addPadding(this.date.getDate(), 2);
			},
			D: function () {
				return this.date.getDayNameShort();
			},
			j: function () {
				return this.date.getDate();
			},
			l: function () {
				return this.date.getDayName();
			},
			N: function () {
				return this.date.getDay() + 1;
			},
			S: function () {
				return this.date.getDateSuffix();
			},
			w: function () {
				return this.date.getDay();
			},
			z: function () {
				return this.date.getDayOfYear();
			},
			W: function () {
				return this.date.getWeekNumber();
			},
			F: function () {
				return this.date.getMonthName();
			},
			m: function () {
				return addPadding((this.date.getMonth() + 1), 2);
			},
			M: function () {
				return this.date.getMonthNameShort();
			},
			n: function () {
				return this.date.getMonth() + 1;
			},
			t: function () {
				return this.date.getDaysInMonth();
			},
			L: function () {
				return this.date.isLeapYear() ? 1 : 0;
			},
			o: function () {
				return this.date.getFullYear();
			},
			Y: function () {
				return this.date.getFullYear();
			},
			y: function () {
				return this.date.getFullYear() % 100;
			},
			a: function () {
				return this.date.getMeridiem(true);
			},
			A: function () {
				return this.date.getMeridiem(false);
			},
			H: function () {
				return addPadding(this.date.getHours(), 2);
			},
			G: function () {
				return this.date.getHours();
			},
			h: function () {
				var hour = this.date.getHours();
				if (hour > 12) {
					hour -= 12;
				} else if (hour < 1) {
					hour = 12;
				}
				return addPadding(hour, 2);
			},
			g: function () {
				var hour = this.date.getHours();
				if (hour > 12) {
					hour -= 12;
				} else if (hour < 1) {
					hour = 12;
				}
				return hour;
			},
			i: function () {
				return addPadding(this.date.getMinutes(), 2);
			},
			s: function () {
				return addPadding(this.date.getSeconds(), 2);
			},
			u: function () {
				return Math.floor(this.date.getMilliseconds() * 1000);
			},
			Z: function () {
				return this.date.getTimezoneOffset() * 60;
			},
			P: function () {
				return Math.floor(-this.date.getTimezoneOffset() / 60) + ":" + addPadding(-this.date.getTimezoneOffset() % 60, 2);
			}
		};


		var formats = new Array();
		while (formatString.length > 0) {
			if (formatString[0] === "\"") {
				var temp = /"[^"]*"/m.exec(formatString);
				if (temp === null) {
					formats.push(formatString.substring(1));
					formatString = "";
				} else {
					temp = temp[0].substring(1, temp[0].length - 1);
					formats.push(temp);
					formatString = formatString.substring(temp.length + 2);
				}
			} else if (formatString[0] === "'") {
				var temp = /'[^']*'/m.exec(formatString);
				if (temp === null) {
					formats.push(formatString.substring(1));
					formatString = "";
				} else {
					temp = temp[0].substring(1, temp[0].length - 1);
					formats.push(temp);
					formatString = formatString.substring(temp.length + 2);
				}
			} else if (formatString[0] === "\\") {
				if (formatString.length > 1) {
					formats.push(formatString.substring(1, 2));
					formatString = formatString.substring(2);
				} else {
					formats.push("\\");
					formatString = "";
				}
			} else {
				var foundMatch = false;
				for (var i = formatString.length; i > 0; i--) {
					if (formatString.substring(0, i) in replacements) {
						formats.push(replacements[formatString.substring(0, i)]());
						formatString = formatString.substring(i);
						foundMatch = true;
						break;
					}
				}
				if (!foundMatch) {
					formats.push(formatString[0]);
					formatString = formatString.substring(1);
				}
			}
		}

		return formats.join("");
	};

	Date.createFromFormat = function (format, value) {
		var now = new Date();
		var parsed = {
			date: now.getDate(),
			year: now.getFullYear(),
			month: now.getMonth(),
			hours: 0,
			minutes:  0,
			seconds:  0,
			milliseconds: 0
		};
		try { 
			for(var i = 0; i < format.length; i++) {
				var f = format.charAt(i);
				switch (f) {
					case 'd':
						parsed.date = parseInt(value.substring(0, 2), 10);
						value = value.substring(2);
						break;
					case 'j':
						var next = parseInt(value.charAt(1), 10);
						var len = (next >= 0 && next <= 9 ) ? 2 : 1;
						parsed.date = parseInt(value.substring(0, len), 10);
						value = value.substring(len);
						break;
					case 'F':
						var months = Date.locales[this.getLocale()].month_names;
						var len = months[0].length;
						var month = value.substring(0, len);
						value = value.substring(len);
						for (var m = 0; m < 12; m++) {
							if (months[m] == month) {
								parsed.month = m;
								break;
							}
						}
						break;
					case 'M':
						var months = Date.locales[this.getLocale()].month_names_short;
						var len = months[0].length;
						var month = value.substring(0, len);
						value = value.substring(len);
						for (var m = 0; m < 12; m++) {
							if (months[m] == month) {
								parsed.month = m;
								break;
							}
						}
						break;
					case 'm':
						parsed.month = parseInt(value.substring(0, 2), 10) - 1;
						value = value.substring(2);
						break;
					case 'n':
						var next = parseInt(value.charAt(1), 10);
						var len = (next >= 0 && next <= 9 ) ? 2 : 1;
						parsed.month = parseInt(value.substring(0, len), 10) - 1;
						if (parsed.month > 11) {
							throw new Error('Invalid month');
						}
						value = value.substring(len);
						break;
					case 'o':
					case 'Y':
						parsed.year = parseInt(value.substring(0, 4), 10);
						value = value.substring(4);
						break;
					case 'y':
						var year = parseInt(value.substring(0, 2), 10);
						parsed.year = (year > 50 ) ? year + 1900 : year + 2000;
						value = value.substring(2);
						break;
					case 'H':
						parsed.hours = parseInt(value.substring(0, 2), 10);
						value = value.substring(2);
						break;
					case 'G':
						var next = parseInt(value.charAt(1), 10);
						var len = (next >= 0 && next <= 9 ) ? 2 : 1;
						parsed.hours = parseInt(value.substring(0, len), 10);
						value = value.substring(len);
						break;
					case 'i':
						parsed.minutes = parseInt(value.substring(0, 2), 10);
						value = value.substring(2);
						break;
					case 's':
						parsed.seconds = parseInt(value.substring(0, 2), 10);
						value = value.substring(2);
						break;
					case 'u':
						var len = 0;
						for (var i = 0; i < value.length; i++) {
							if (value.charAt(i) < '0' || value.charAt(i) > '9') {
								break;
							}
							len++;
						}
						parsed.milliseconds = parseInt(value.substring(0, len), 10) / 1000;
						value = value.substring(len);
					   break;
					default:
						value = value.substring(1);
				}
			}
			if (parsed.year > 9999) {
				throw 'Invalid year';
			}
			if (parsed.month > 11) {
				throw 'Invalid month';
			}
			if (!(parsed.year % 4) && (parsed.year % 100) || !(parsed.year % 400)) { // leap year
				if (parsed.date < 1 || (parsed.month == 1 && parsed.date > 29)) {
					throw 'Invalid day';
				}
			} else {
				if (parsed.date < 1 || (parsed.month == 1 && parsed.date > 28)) {
					throw 'Invalid day';
				}
			}
			if (parsed.hours > 23) {
				throw 'Invalid hours';
			}
			if (parsed.minutes > 59) {
				throw 'Invalid minutes';
			}
			if (parsed.seconds > 59) {
				throw 'Invalid seconds';
			}
			return new Date(parsed.year, parsed.month, parsed.date, parsed.hours, parsed.minutes, parsed.seconds, parsed.milliseconds);
		} catch(err) {
			throw "Date parsing error : " + err;
		}
	};

	Date.isDate = function(value){
		var re = new RegExp("^" + Date.regexp + "$");
		return re.test(value);
	};

})();

(function (global) {
	'use strict';

	function MoneyFunction() {
	};

	MoneyFunction.decimalPoint = '.';
	MoneyFunction.moneySymbol = '$';
	MoneyFunction.symbolPosition = 'before';
	MoneyFunction.groupingSeparator = ',';
	MoneyFunction.groupingSize = 3;

	MoneyFunction.setRegionalSettings = function(settings) {
		MoneyFunction.decimalPoint = settings.decimalPoint;
		MoneyFunction.moneySymbol = settings.moneySymbol;
		MoneyFunction.symbolPosition = settings.symbolPosition;
		MoneyFunction.groupingSeparator = settings.groupingSeparator;
		MoneyFunction.groupingSize = settings.groupingSize;
	}

	global.MoneyFunction = MoneyFunction;

}(this));

(function (global) {
	'use strict';

	function Token(type, value) {
		this.type  = type;
		this.arity = 0;
		this.value = value;
	};

	Token.TYPE = {
		T_UNDEFINED			: 0,
		T_NUMBER	  		: 1,  
		T_DATE				: 2, 
		T_BOOLEAN			: 3, 
		T_TEXT				: 4, 
		T_ANY				: 5, 
		T_IDENT				: 6,  
		T_FUNCTION			: 7,  
		T_ARRAY				: 8,  
		T_POPEN				: 9,  
		T_PCLOSE			: 10, 
		T_SBOPEN			: 11,  
		T_SBCLOSE			: 12, 
		T_COMMA				: 13, 
		T_NOOP				: 14, 
		T_PLUS				: 15, 
		T_MINUS				: 16, 
		T_TIMES				: 17, 
		T_DIV				: 18, 
		T_MOD				: 19, 
		T_POW				: 20, 
		T_UNARY_PLUS		: 21, 
		T_UNARY_MINUS		: 22, 
		T_NOT				: 23, 
		T_FIELD				: 24, 
		T_EQUAL				: 25,
		T_NOT_EQUAL			: 26,
		T_LESS_THAN			: 27,
		T_LESS_OR_EQUAL		: 28,
		T_GREATER_THAN		: 29,
		T_GREATER_OR_EQUAL	: 30,
		T_CONTAINS			: 31,
		T_NOT_CONTAINS		: 32,
		T_BITWISE_AND		: 33,
		T_BITWISE_OR		: 34,
		T_BITWISE_XOR		: 35,
		T_LOGICAL_AND		: 36,
		T_LOGICAL_OR		: 37,
		T_TERNARY			: 38,
		T_TERNARY_ELSE		: 39,
		T_DEGRE				: 40,

		A_NONE				: 0,
		A_LEFT				: 1,
		A_RIGHT				: 2
	};

	Token.prototype = {
		isUnaryOperator: function (){
			switch (this.type) {
				case Token.TYPE.T_NOT:
				case Token.TYPE.T_UNARY_PLUS:
				case Token.TYPE.T_UNARY_MINUS:
				case Token.TYPE.T_TERNARY_ELSE:
				case Token.TYPE.T_DEGRE:
					return true;
			}
			return false;
		},

		isBinaryOperator: function (){
			switch (this.type) {
				case Token.TYPE.T_POW:
				case Token.TYPE.T_TIMES:
				case Token.TYPE.T_DIV:
				case Token.TYPE.T_MOD:
				case Token.TYPE.T_PLUS:
				case Token.TYPE.T_MINUS:
				case Token.TYPE.T_BITWISE_AND:
				case Token.TYPE.T_BITWISE_OR:
				case Token.TYPE.T_BITWISE_XOR:
				case Token.TYPE.T_LOGICAL_AND:
				case Token.TYPE.T_LOGICAL_OR:
					return true;
			}
			return false;
		},

		isTernaryOperator: function (){
			switch (this.type) {
				case Token.TYPE.T_TERNARY:
					return true;
			}
			return false;
		},

		isOperator: function (){
			return this.isUnaryOperator() 
				|| this.isBinaryOperator() 
				|| this.isTernaryOperator();
		},

		isComparator: function (){
			switch (this.type) {
				case Token.TYPE.T_EQUAL:
				case Token.TYPE.T_NOT_EQUAL:
				case Token.TYPE.T_LESS_THAN:
				case Token.TYPE.T_LESS_OR_EQUAL:
				case Token.TYPE.T_GREATER_THAN:
				case Token.TYPE.T_GREATER_OR_EQUAL:
				case Token.TYPE.T_CONTAINS:
				case Token.TYPE.T_NOT_CONTAINS:
					return true;
			}
			return false;
		},

		isVariable: function(){
			switch (this.type) {
				case Token.TYPE.T_IDENT:
				case Token.TYPE.T_FIELD:
				case Token.TYPE.T_UNDEFINED:
					return true;
			}
			return false;
		},

		isUndefined: function(){
			return this.type == Token.TYPE.T_UNDEFINED;
		},

		isBeforeFunctionArgument: function (){
			switch (this.type) {
				case Token.TYPE.T_POPEN:
				case Token.TYPE.T_COMMA:
				case Token.TYPE.T_NOOP:
					return true;
			}
			return false;
		},

		precedence: function (){
			switch (this.type) {
				case Token.TYPE.T_POPEN:
				case Token.TYPE.T_PCLOSE:
				case Token.TYPE.T_POW:
					return 1;
				case Token.TYPE.T_NOT:
				case Token.TYPE.T_UNARY_PLUS:
				case Token.TYPE.T_UNARY_MINUS:
				case Token.TYPE.T_DEGRE:
					return 2;
				case Token.TYPE.T_TIMES:
				case Token.TYPE.T_DIV:
				case Token.TYPE.T_MOD:
					return 3;
				case Token.TYPE.T_PLUS:
				case Token.TYPE.T_MINUS:
					return 4;
				case Token.TYPE.T_LESS_THAN:
				case Token.TYPE.T_LESS_OR_EQUAL:
				case Token.TYPE.T_GREATER_THAN:
				case Token.TYPE.T_GREATER_OR_EQUAL:
					return 6;
				case Token.TYPE.T_EQUAL:
				case Token.TYPE.T_NOT_EQUAL:
				case Token.TYPE.T_CONTAINS:
				case Token.TYPE.T_NOT_CONTAINS:
					return 7;
				case Token.TYPE.T_BITWISE_AND:
					return 8;
				case Token.TYPE.T_BITWISE_XOR:
					return 9;
				case Token.TYPE.T_BITWISE_OR:
					return 10;
				case Token.TYPE.T_LOGICAL_AND:
					return 11;
				case Token.TYPE.T_LOGICAL_OR:
					return 12;
				case Token.TYPE.T_TERNARY_ELSE:
					return 13;
				case Token.TYPE.T_TERNARY:
					return 14;
				case Token.TYPE.T_COMMA:
					return 15;
			}
			return 16;
		},

		associativity: function (){
			switch (this.type) {
				case Token.TYPE.T_POW:
				case Token.TYPE.T_NOT:
				case Token.TYPE.T_UNARY_PLUS:
				case Token.TYPE.T_UNARY_MINUS:
					return Token.TYPE.A_RIGHT;
				case Token.TYPE.T_DEGRE:
				case Token.TYPE.T_TIMES:
				case Token.TYPE.T_DIV:
				case Token.TYPE.T_MOD:
				case Token.TYPE.T_PLUS:
				case Token.TYPE.T_MINUS:
				case Token.TYPE.T_LESS_THAN:
				case Token.TYPE.T_LESS_OR_EQUAL:
				case Token.TYPE.T_GREATER_THAN:
				case Token.TYPE.T_GREATER_OR_EQUAL:
				case Token.TYPE.T_EQUAL:
				case Token.TYPE.T_NOT_EQUAL:
				case Token.TYPE.T_CONTAINS:
				case Token.TYPE.T_NOT_CONTAINS:
				case Token.TYPE.T_BITWISE_AND:
				case Token.TYPE.T_BITWISE_XOR:
				case Token.TYPE.T_BITWISE_OR:
				case Token.TYPE.T_LOGICAL_AND:
				case Token.TYPE.T_LOGICAL_OR:
				case Token.TYPE.T_TERNARY:
					return Token.TYPE.A_LEFT;
				case Token.TYPE.T_TERNARY_ELSE:
					return Token.TYPE.A_RIGHT;
				case Token.TYPE.T_COMMA:
					return Token.TYPE.A_LEFT;
			}
			return Token.TYPE.A_NONE;
		},

		toString: function () {
			switch (this.type) {
				case Token.TYPE.T_DATE:
					return this.value.format(Date.format);
					break;
				case Token.TYPE.T_BOOLEAN:
					return this.value ? 'true' : 'false';
					break;
				case Token.TYPE.T_FUNCTION:
					return this.value;
					break;
				case Token.TYPE.T_ARRAY:
					return JSON.stringify(this.value);
					break;
				default:
					return this.value.toString();
			}
		}
	};

	global.Token = Token;

}(this));

(function (global) {
	'use strict';

	Number.isNumeric = Number.isNumeric || function(value) {
		var type = typeof value;
		return (type === "number" || type === "string") &&
				!isNaN(value - parseFloat(value));
	}

	function Expression(expression) {
		this.expression = expression;
		this.tokens = [];
		this.postfixed = false;
	};

	Expression.prototype = {
		get: function (){
			return this.tokens;
		},

		push: function (t){
			this.tokens.push(t);
		},

		pop: function (){
			return this.tokens.pop();
		},

		peek: function (){
			return this.tokens[this.tokens.length - 1];
		},

		postfix : function () {
			var stack = [];
			var rpn = [];

			for (var token of this.tokens) {
				switch (token.type) {
					case Token.TYPE.T_COMMA:
						while (stack.length != 0 && stack[stack.length-1].type != Token.TYPE.T_POPEN) {
							rpn.push(stack.pop());
						}
						if (stack.length > 1
							&& stack[stack.length-2].type == Token.TYPE.T_FUNCTION) {
							stack[stack.length-2].arity++;
						}
						break;
					case Token.TYPE.T_NUMBER:
					case Token.TYPE.T_DATE:
					case Token.TYPE.T_BOOLEAN:
					case Token.TYPE.T_TEXT:
					case Token.TYPE.T_ANY:
					case Token.TYPE.T_IDENT:
					case Token.TYPE.T_FIELD:
					case Token.TYPE.T_ARRAY:
					case Token.TYPE.T_UNDEFINED:
						rpn.push(token);
						break;
					case Token.TYPE.T_PCLOSE:
						while (stack.length != 0 && stack[stack.length-1].type != Token.TYPE.T_POPEN) {
							rpn.push(stack.pop());
						}
						if (stack.length == 0) {
							throw new Error("Closing parenthesis without opening parenthesis");
						}
						stack.pop();
						if (stack.length != 0
							&& stack[stack.length-1].type == Token.TYPE.T_FUNCTION) {
							stack[stack.length-1].arity++;
							rpn.push(stack.pop());
						}
						break;
					case Token.TYPE.T_POPEN:
					case Token.TYPE.T_FUNCTION:
						stack.push(token);
						break;
					default:
						if (token.isOperator() || token.isComparator()) {
							while (stack.length != 0
								&& (stack[stack.length-1].isOperator() || stack[stack.length-1].isComparator())
								&& ((token.associativity() == Token.TYPE.A_LEFT && token.precedence() >= stack[stack.length-1].precedence()) || (token.associativity() == Token.TYPE.A_RIGHT && token.precedence() > stack[stack.length-1].precedence()))) {
								rpn.push(stack.pop());
							}
							stack.push(token);
						} else {
							throw new Error("Unrecognized token " + token.value);
						}
						break;
				}
			}
			while (stack.length != 0 && stack[stack.length-1].type != Token.TYPE.T_POPEN) {
				rpn.push(stack.pop());
			}
			if (stack.length != 0) {
				throw new Error("Opening parenthesis without closing parenthesis");
			}
			this.tokens = rpn;
			this.postfixed = true;
		},

		setFields: function (fields) {
			for (var token of this.tokens) {
				if (token.type == Token.TYPE.T_FIELD && fields.length >= token.value) {
					var value = fields[token.value - 1];
					if (Array.isArray(value)) {
						token.type = Token.TYPE.T_ARRAY;
						token.value = value;
					} else if (Date.isDate(value)) {
						token.type = Token.TYPE.T_DATE;
						token.value = Date.createFromFormat(Date.inputFormat, value);
					} else if (Number.isNumeric(value)) {
						token.type = Token.TYPE.T_NUMBER;
						token.value = parseFloat(value);
					} else if (value === 'true' || value === 'false') {
						token.type = Token.TYPE.T_BOOLEAN;
						token.value = value === 'true';
					} else {
						token.type = Token.TYPE.T_TEXT;
						token.value = value;
					}
				}
			}
		},

		setNamedFields: function (fields) {
			for (var token of this.tokens) {
				if (token.type == Token.TYPE.T_IDENT && typeof fields[token.value] !== 'undefined' && fields[token.value] !== null) {
					var value = fields[token.value];
					if (Array.isArray(value)) {
						token.type = Token.TYPE.T_ARRAY;
						token.value = value;
					} else if (Date.isDate(value)) {
						token.type = Token.TYPE.T_DATE;
						token.value = Date.createFromFormat(Date.inputFormat, value);
					} else if (Number.isNumeric(value)) {
						token.type = Token.TYPE.T_NUMBER;
						token.value = parseFloat(value);
					} else if (value === 'true' || value === 'false') {
						token.type = Token.TYPE.T_BOOLEAN;
						token.value = value === 'true';
					} else {
						token.type = Token.TYPE.T_TEXT;
						token.value = value;
					}
				}
			}
		},

		setVariables: function (variables) {
			var completed = true;
			for (var token of this.tokens) {
				if (token.type == Token.TYPE.T_FIELD) {
					var value = variables['' + token.value];
					if (typeof value === 'undefined' || value === null || value.length == 0) {
						completed = false;
					} else if (Array.isArray(value)) {
						token.type = Token.TYPE.T_ARRAY;
						token.value = value;
					} else if (Date.isDate(value)) {
						token.type = Token.TYPE.T_DATE;
						token.value = Date.createFromFormat(Date.inputFormat, value);
					} else if (Number.isNumeric(value)) {
						token.type = Token.TYPE.T_NUMBER;
						token.value = parseFloat(value);
					} else if (value === 'true' || value === 'false') {
						token.type = Token.TYPE.T_BOOLEAN;
						token.value = value === 'true';
					} else {
						token.type = Token.TYPE.T_TEXT;
						token.value = value;
					}
				} else if (token.type == Token.TYPE.T_IDENT) {
					var value = variables[token.value];
					if (typeof value === 'undefined' || value === null || value.length == 0) {
						completed = false;
					} else if (Array.isArray(value)) {
						token.type = Token.TYPE.T_ARRAY;
						token.value = value;
					} else if (Date.isDate(value)) {
						token.type = Token.TYPE.T_DATE;
						token.value = Date.createFromFormat(Date.inputFormat, value);
					} else if (Number.isNumeric(value)) {
						token.type = Token.TYPE.T_NUMBER;
						token.value = parseFloat(value);
					} else if (value === 'true' || value === 'false') {
						token.type = Token.TYPE.T_BOOLEAN;
						token.value = value === 'true';
					} else {
						token.type = Token.TYPE.T_TEXT;
						token.value = value;
					}
				}
			}
			return completed;
		},

		evaluate: function () {
			try {
				var ops = [];
				var self = this;
				for (var token of this.tokens) {
					if (token.isOperator()) {
						ops.push(self.operation(token, ops));
					} else if (token.isComparator()) {
						ops.push(self.comparison(token, ops));
					} else {
						switch (token.type) {
							case Token.TYPE.T_NUMBER:
							case Token.TYPE.T_DATE:
							case Token.TYPE.T_BOOLEAN:
							case Token.TYPE.T_TEXT:
							case Token.TYPE.T_ANY:
							case Token.TYPE.T_IDENT:
							case Token.TYPE.T_FIELD:
							case Token.TYPE.T_ARRAY:
							case Token.TYPE.T_UNDEFINED:
								ops.push(token);
								break;
							case Token.TYPE.T_FUNCTION:
								ops.push(self.func(token, ops));
								break;
							default:
								throw new Error("Unrecognized token " + token.value);
						}
					}
				}
				var result = ops[ops.length-1];
				return result.isVariable() ? false : '' + result;
			} catch (e) {
				return false;
			}
		},

		operation: function (op, args) {
			if (op.isUnaryOperator()) {
				if (args.length < 1) {
					throw new Error("Illegal number (" + args.length + ") of operands for " + op);
				}
				var arg1 = args.pop();
			} else if (op.isBinaryOperator()) {
				if (args.length < 2) {
					throw new Error("Illegal number (" + args.length + ") of operands for " + op);
				}
				var arg2 = args.pop();
				var arg1 = args.pop();
			} else if (op.isTernaryOperator()) {
				if (args.length < 3) {
					throw new Error("Illegal number (" + args.length + ") of operands for " + op);
				}
				var arg3 = args.pop();
				var arg2 = args.pop();
				var arg1 = args.pop();
			}
			var result = new Token(Token.TYPE.T_NUMBER, 0);
			switch (op.type) {
				case Token.TYPE.T_PLUS:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type == Token.TYPE.T_NUMBER) { 
						if (arg2.type == Token.TYPE.T_NUMBER) {
							result.value = arg1.value + arg2.value;
						} else if (arg2.type == Token.TYPE.T_DATE) {
							var date = arg2.value;
							date.addDays(arg1.value);
							result.type = Token.TYPE.T_DATE;
							result.value = date;
						} else if (arg2.type == Token.TYPE.T_TEXT) {
							result.type = Token.TYPE.T_TEXT;
							result.value = arg1.value.toString() + arg2.value;
						} else {
							throw  new Error("Illegal argument '" + arg2 + "' for " + op);
						}
					} else if (arg1.type == Token.TYPE.T_DATE) {
						if (arg2.type == Token.TYPE.T_NUMBER) {
							var date = arg1.value;
							date.addDays(arg2.value);
							result.type = Token.TYPE.T_DATE;
							result.value = date;
						} else if (arg2.type == Token.TYPE.T_TEXT) {
							result.type = Token.TYPE.T_TEXT;
							result.value = arg1.value.format(Date.format) + arg2.value;
						} else {
							throw new Error("Illegal argument '" + arg2 + "' for " + op);
						}
					} else if (arg1.type == Token.TYPE.T_TEXT) {
						result.type = Token.TYPE.T_TEXT;
						if (arg2.type == Token.TYPE.T_NUMBER) {
							result.value = arg1.value + arg2.value.toString();
						} else if (arg2.type == Token.TYPE.T_DATE) {
							result.value = arg1.value + arg2.value.format(Date.format);
						} else if (arg2.type == Token.TYPE.T_TEXT) {
							result.value = arg1.value + arg2.value;
						} else {
							throw new Error("Illegal argument '" + arg2 + "' for " + op);
						}
					} else {
						throw new Error("Illegal argument '" + arg1 + "' for " + op);
					}
					break;
				case Token.TYPE.T_MINUS:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type == Token.TYPE.T_NUMBER) { 
						if (arg2.type == Token.TYPE.T_NUMBER) {
							result.value = arg1.value - arg2.value;
						} else {
							throw new Error("Illegal argument '" + arg2 + "' for " + op);
						}
					} else if (arg1.type == Token.TYPE.T_DATE) {
						if (arg2.type == Token.TYPE.T_NUMBER) {
							var date = arg1.value;
							date.addDays(-arg2.value);
							result.type = Token.TYPE.T_DATE;
							result.value = date;
						} else if (arg2.type == Token.TYPE.T_DATE) {
							result.value = (arg1.value > arg2.value)
								? arg2.value.getDaysBetween(arg1.value)
								: 0;
						} else {
							throw new Error("Illegal argument '" + arg2 + "' for " + op);
						}
					} else {
						throw new Error("Illegal argument '" + arg1 + "' for " + op);
					}
					break;
				case Token.TYPE.T_TIMES:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type != Token.TYPE.T_NUMBER || arg2.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument '" + arg2 + "' : operands must be numbers for " + op);
					} else {
						result.value = arg1.value * arg2.value;
					}
					break;
				case Token.TYPE.T_DIV:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type != Token.TYPE.T_NUMBER || arg2.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument : operands must be numbers for " + op);
					} else {
						result.value = arg1.value / arg2.value;
					}
					break;
				case Token.TYPE.T_MOD:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type != Token.TYPE.T_NUMBER || arg2.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument : operands must be numbers for " + op);
					} else {
						result.value = arg1.value % arg2.value;
					}
					break;
				case Token.TYPE.T_POW:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type != Token.TYPE.T_NUMBER || arg2.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument : operands must be numbers for " + op);
					} else {
						result.value = Math.pow(arg1.value, arg2.value);
					}
					break;
				case Token.TYPE.T_BITWISE_AND:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type != Token.TYPE.T_NUMBER || arg2.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument : operands must be numbers for " + op);
					} else {
						result.value = arg1.value & arg2.value;
					}
					break;
				case Token.TYPE.T_BITWISE_XOR:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type != Token.TYPE.T_NUMBER || arg2.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument : operands must be numbers for " + op);
					} else {
						result.value = arg1.value ^ arg2.value;
					}
					break;
				case Token.TYPE.T_BITWISE_OR:
					if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else if (arg1.type != Token.TYPE.T_NUMBER || arg2.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument : operands must be numbers for " + op);
					} else {
						result.value = arg1.value | arg2.value;
					}
					break;
				case Token.TYPE.T_LOGICAL_AND:
					result.type = Token.TYPE.T_BOOLEAN;
					if (arg1.type == Token.TYPE.T_BOOLEAN && arg2.type == Token.TYPE.T_BOOLEAN) {
						result.value = arg1.value && arg2.value;
					} else if (arg1.type == Token.TYPE.T_BOOLEAN) {
						if (! arg1.value) {
							result.value = false;
						} else if (arg2.isVariable()) {
							result.type = Token.TYPE.T_UNDEFINED;
							result.value = [arg1, arg2];
						} else {
							throw new Error("Illegal argument 2 : operand must be boolean for "+ op);
						}
					} else if (arg2.type == Token.TYPE.T_BOOLEAN) {
						if (! arg2.value) {
							result.value = false;
						} else if (arg1.isVariable()) {
							result.type = Token.TYPE.T_UNDEFINED;
							result.value = [arg1, arg2];
						} else {
							throw new Error("Illegal argument 1 : operand must be boolean for " + op);
						}
					} else if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else {
						throw new Error("Illegal argument : operands must be boolean for " + op);
					}
					break;
				case Token.TYPE.T_LOGICAL_OR:
					result.type = Token.TYPE.T_BOOLEAN;
					if (arg1.type == Token.TYPE.T_BOOLEAN && arg2.type == Token.TYPE.T_BOOLEAN) {
						result.value = arg1.value || arg2.value;
					} else if (arg1.type == Token.TYPE.T_BOOLEAN) {
						if (arg1.value) {
							result.value = true;
						} else if (arg2.isVariable()) {
							result.type = Token.TYPE.T_UNDEFINED;
							result.value = [arg1, arg2];
						} else {
							throw new Error("Illegal argument 2 : operand must be boolean for " + op);
						}
					} else if (arg2.type == Token.TYPE.T_BOOLEAN) {
						if (arg2.value) {
							result.value = true;
						} else if (arg1.isVariable()) {
							result.type = Token.TYPE.T_UNDEFINED;
							result.value = [arg1, arg2];
						} else {
							throw new Error("Illegal argument 1 : operand must be boolean for " + op);
						}
					} else if (arg1.isVariable() || arg2.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2];
					} else {
						throw new Error("Illegal argument : operands must be boolean for " + op);
					}
					break;
				case Token.TYPE.T_UNARY_PLUS:
					if (arg1.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1];
					} else if (arg1.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument '" + arg1 + "' : operand must be a number for " + op);
					} else {
						result.value = arg1.value;
					}
					break;
				case Token.TYPE.T_UNARY_MINUS:
					if (arg1.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1];
					} else if (arg1.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument '" + arg1 + "' : operand must be a number for " + op);
					} else {
						result.value = -arg1.value;
					}
					break;
				case Token.TYPE.T_NOT:
					if (arg1.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1];
					} else if (arg1.type != Token.TYPE.T_NUMBER && arg1.type != Token.TYPE.T_BOOLEAN) { 
						throw new Error("Illegal argument '" + arg1 + "' : operand must be a number or a boolean for " + op);
					} else {
						result.type = arg1.type;
						result.value = !arg1.value;
					}
					break;
				case Token.TYPE.T_DEGRE:
					if (arg1.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1];
					} else if (arg1.type != Token.TYPE.T_NUMBER) { 
						throw new Error("Illegal argument '" + arg1 + "' : operand must be a number for " + op);
					} else {
						result.value = arg1.value * Math.PI / 180;
					}
					break;
				case Token.TYPE.T_TERNARY_ELSE:
					result = arg1;
					break;
				case Token.TYPE.T_TERNARY:
					if (arg1.isVariable()) {
						result.type = Token.TYPE.T_UNDEFINED;
						result.value = [arg1, arg2, arg3];
					} else if (arg1.type != Token.TYPE.T_BOOLEAN) { 
						throw new Error("Illegal argument '" + arg1 + "' : operand 1 must be a condition for " + op);
					} else {
						result = arg1.value ? arg2 : arg3;
					}
					break;
			}
			this.guessType(result);
			return result;
		},

		comparison: function (op, args) {
			if (args.length < 2) {
				throw new Error("Illegal number (" + args.length + ") of operands for " + op);
			}
			var arg2 = args.pop();
			var arg1 = args.pop();
			var result;
			if (arg1.isVariable() || arg2.isVariable()) {
				result = new Token(Token.TYPE.T_UNDEFINED, [arg1, arg2]);
			} else if (op.type != Token.TYPE.T_CONTAINS && arg1.type != arg2.type) { 
				throw new Error("operand types for '" + op + "' are not identical");
			} else if (op.type == Token.TYPE.T_CONTAINS && arg1.type != Token.TYPE.T_ARRAY) { 
				throw new Error("first operand type for '" + op + "' is not an array");
			} else {
				result = new Token(Token.TYPE.T_BOOLEAN, false);
				switch (op.type) {
					case Token.TYPE.T_EQUAL:
						result.value = (arg1.value == arg2.value);
						break;
					case Token.TYPE.T_NOT_EQUAL:
						result.value = (arg1.value != arg2.value);
						break;
					case Token.TYPE.T_LESS_THAN:
						result.value = (arg1.value < arg2.value);
						break;
					case Token.TYPE.T_LESS_OR_EQUAL:
						result.value = (arg1.value <= arg2.value);
						break;
					case Token.TYPE.T_GREATER_THAN:
						result.value = (arg1.value > arg2.value);
						break;
					case Token.TYPE.T_GREATER_OR_EQUAL:
						result.value = (arg1.value >= arg2.value);
						break;
					case Token.TYPE.T_CONTAINS:
						result.value = Array.isArray(arg1.value) && arg1.value.indexOf(arg2.value.toString()) >= 0;
						break;
					case Token.TYPE.T_NOT_CONTAINS:
						result.value = ! Array.isArray(arg1.value) || arg1.value.indexOf(arg2.value.toString()) < 0;
						break;
				}
			}
			return result;
		},

		guessType : function (token) {
			if (token.type == Token.TYPE.T_TEXT) {
				if (Date.isDate(token.value)) {
					token.type = Token.TYPE.T_DATE;
					token.value = Date.createFromFormat(Date.inputFormat, token.value);
				} else if (Number.isNumeric(token.value)) {
					token.type = Token.TYPE.T_NUMBER;
					token.value = parseFloat(token.value);
				} else if (token.value === 'true' || token.value === 'false') {
					token.type = Token.TYPE.T_BOOLEAN;
					token.value = token.value === 'true';
				}
			}
		},

		func: function (func, args) {
			var functions = {
				"abs": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.abs(a); }],
				"acos": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.acos(a); }],
				"acosh": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.acosh(a); }],
				"addMonths": [2, [Token.TYPE.T_NUMBER, Token.TYPE.T_DATE], Token.TYPE.T_DATE, function(a, b) { return b.addMonths(a); }],
				"asin": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.asin(a); }],
				"asinh": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.asinh(a); }],
				"atan": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.atan(a); }],
				"atan2": [2, [Token.TYPE.T_NUMBER, Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a, b) { return Math.atan2(a, b); }],
				"atanh": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.atanh(a); }],
				"ceil": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.ceil(a); }],
				"concat": [-1, [Token.TYPE.T_TEXT], Token.TYPE.T_TEXT, function(a) {
					var c = '';
					for (var v of a) {
						c += v !== undefined ? v : '';
					}
					return c; 
				}],
				"cos": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.cos(a); }],
				"cosh": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.cosh(a); }],
				"count": [-1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) {
					var c = 0;
					for (var v of a) {
						if (v !== undefined) {
							c += 1;
						}
					}
					return c; 
				}],
				"day": [1, [Token.TYPE.T_DATE], Token.TYPE.T_NUMBER, function(a) { return a.getDate(); }],
				"exp": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.exp(a); }],
				"firstDayOfMonth": [1, [Token.TYPE.T_DATE], Token.TYPE.T_DATE, function(a) { return a.firstDayOfMonth(); }],
				"floor": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.floor(a); }],
				"fullmonth": [1, [Token.TYPE.T_DATE], Token.TYPE.T_TEXT, function(a) { return a.getMonthName('fr') + ' ' + a.format('Y'); }],
				"get": [2, [Token.TYPE.T_ARRAY, Token.TYPE.T_NUMBER], Token.TYPE.T_TEXT, function(a, b) { return b < a.lengh + 1 ? a[b - 1] : ''; }],
				"lastday": [2, [Token.TYPE.T_NUMBER, Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a, b) { var d = Date.createFromFormat('Y-n-j', a + '-' + b + '-1' );return d.lastday(false); }],
				"lastDayOfMonth": [1, [Token.TYPE.T_DATE], Token.TYPE.T_DATE, function(a) { return a.lastDayOfMonth(); }],
				"lcfirst": [1, [Token.TYPE.T_TEXT], Token.TYPE.T_TEXT, function(a) { return a.replace(/(^[A-Z])/,function (p) { return p.toLowerCase(); } ); }],
				"length": [1, [Token.TYPE.T_TEXT], Token.TYPE.T_NUMBER, function(a) { return a.length; }],
				"log": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.log(a); }],
				"log10": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.log10(a); }],
				"lower": [1, [Token.TYPE.T_TEXT], Token.TYPE.T_TEXT, function(a) { return a.toLowerCase(); }],
				"match": [2, [Token.TYPE.T_TEXT, Token.TYPE.T_TEXT], Token.TYPE.T_BOOLEAN, function(a, b) { return b.match(a) != null; }],
				"max": [-1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.max.apply(null, a); }],
				"min": [-1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.min.apply(null, a); }],
				"money": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_TEXT, function(a) { 

					return new Intl.NumberFormat(Date.locale, {
						minimumFractionDigits: 2,
						maximumFractionDigits: 2
						
					}).format(a);
				}],
				"month": [1, [Token.TYPE.T_DATE], Token.TYPE.T_NUMBER, function(a) { return a.getMonth() + 1; }],
				"nextWorkDay": [1, [Token.TYPE.T_DATE], Token.TYPE.T_DATE, function(a) { return a.nextWorkingDay(); }],
				"pow": [2, [Token.TYPE.T_NUMBER, Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a, b) { return Math.pow(a, b); }],
				"rand": [0, [], Token.TYPE.T_NUMBER, function() { return Math.random(); }],
				"replace": [3, [Token.TYPE.T_TEXT, Token.TYPE.T_TEXT, Token.TYPE.T_TEXT], Token.TYPE.T_TEXT, function(a, b, c) {
					var d = c;
					while (d.indexOf(a) >= 0){
						d = d.replace(a, b);
					}
					return d;
				}],
				"round": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.round(a); }],
				"sin": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.sin(a); }],
				"sinh": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.sinh(a); }],
				"size": [1, [Token.TYPE.T_ARRAY], Token.TYPE.T_NUMBER, function(a) { return a.length; }],
				"split": [2, [Token.TYPE.T_TEXT, Token.TYPE.T_TEXT], Token.TYPE.T_ARRAY, function(a, b) { return b.split(a); }],
				"sqrt": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.sqrt(a); }],
				"substr": [3, [Token.TYPE.T_TEXT, Token.TYPE.T_NUMBER, Token.TYPE.T_NUMBER], Token.TYPE.T_TEXT, function(a, b, c) {
					if (b > 0) {
						b--;
					}
					return a.substr(b, c);
				}],
				"sum": [-1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) {
					var s = 0;
					for (var v of a) {
						if (v !== undefined) {
							s += v;
						}
					}
					return s; 
				}],
				"tan": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.tan(a); }],
				"tanh": [1, [Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a) { return Math.tanh(a); }],
				"titlecase": [1, [Token.TYPE.T_TEXT], Token.TYPE.T_TEXT, function(a) {
					return a.toLowerCase().replace(/^[\u00C0-\u1FFF\u2C00-\uD7FF\w]|[-\s][\u00C0-\u1FFF\u2C00-\uD7FF\w]/g, function(letter) {
						return letter.toUpperCase();
					});
				}],
				"trim": [1, [Token.TYPE.T_TEXT], Token.TYPE.T_TEXT, function(a) { return trim(a); }],
				"ucfirst": [1, [Token.TYPE.T_TEXT], Token.TYPE.T_TEXT, function(a) { return a.replace(/(^[a-z])/,function (p) { return p.toUpperCase(); } ); }],
				"upper": [1, [Token.TYPE.T_TEXT], Token.TYPE.T_TEXT, function(a) { return a.toUpperCase(); }],
				"workdays": [2, [Token.TYPE.T_DATE, Token.TYPE.T_DATE], Token.TYPE.T_NUMBER, function(a, b) { return a.workingDaysBefore(b); }],
				"workdaysofmonth": [2, [Token.TYPE.T_NUMBER, Token.TYPE.T_NUMBER], Token.TYPE.T_NUMBER, function(a, b) {
					var d1 = Date.createFromFormat('Y-n-j', a + '-' + b + '-1' );
					var d2 = new Date(d1.getFullYear(), d1.getMonth() + 1, 0);
					return d1.workingDaysBefore(d2); 
				}],
				"year": [1, [Token.TYPE.T_DATE], Token.TYPE.T_NUMBER, function(a) { return a.getFullYear(); }]
			};
			if (func.value === "defined") {
				if (args.length < 1) { 
					throw new Error("Illegal number (" + args.length + ") of operands for function" + func);
				}
				var arg = args.pop();
				if (arg.isVariable()) {
					return new Token(Token.TYPE.T_BOOLEAN, false);
				}
				if (typeof arg.value === "undefined" || arg.value === null || arg.value === "") {
					return new Token(Token.TYPE.T_BOOLEAN, false);
				}
				return new Token(Token.TYPE.T_BOOLEAN, true);
			}
			if (typeof functions[func.value] === "undefined" || functions[func.value] === null) {
				throw new Error("Unknown function : " + func);
			}
			var argc = functions[func.value][0];
			var variableArgsCount = false;
			if (argc == -1) {
				argc = func.arity;
				variableArgsCount = true;
			}
			if (args.length < argc) {
				throw new Error("Illegal number (" + args.length + ") of operands for function" + func);
			}
			var argv = [];
			for (; argc > 0; --argc) {
				var arg = args.pop();
				if (! variableArgsCount) {
					if (arg.isVariable()) {
						return new Token(Token.TYPE.T_UNDEFINED, [arg]);
					}
					var type = functions[func.value][1][argc - 1];
					if (type == Token.TYPE.T_TEXT && (arg.type == Token.TYPE.T_NUMBER || arg.type == Token.TYPE.T_DATE)) {
						arg.value += '';
					} else if (arg.type != type) { 
						var expected = "";
						switch (type) {
							case Token.TYPE.T_NUMBER:
								expected = "number";
								break;
							case Token.TYPE.T_DATE: 
								expected = "date";
								break;
							case Token.TYPE.T_BOOLEAN:
								expected = "boolean";
								break;
							case Token.TYPE.T_TEXT: 
								expected = "text";
								break;
							case Token.TYPE.T_ARRAY: 
								expected = "array";
								break;
						}
						throw new Error("Illegal type for argument '" + arg + "' : operand must be a " + expected + " for " + func);
					}
				} else if (arg.isVariable()) {
					if (func.value == 'sum' || func.value == 'count' || func.value == 'concat') {
						arg.value = undefined;
					} else {
						return new Token(Token.TYPE.T_UNDEFINED, [arg]);
					}
				}
				argv.unshift(arg.value); 
			}
			if (variableArgsCount) {
				argv = [argv];
			}
			return new Token(functions[func.value][2], functions[func.value][3].apply(this, argv));
		}
	};

	global.Expression = Expression;

}(this));

(function (global) {
	'use strict';

	var PATTERN = /([\s!,\+\-\*\/\^%\(\)\[\]=<\>\~\&\^\|\?\:])/g;

	var lookup = {
		'+': Token.TYPE.T_PLUS,
		'-': Token.TYPE.T_MINUS,
		'/': Token.TYPE.T_DIV,
		'%': Token.TYPE.T_MOD,
		'(': Token.TYPE.T_POPEN,
		')': Token.TYPE.T_PCLOSE,
		'[': Token.TYPE.T_SBOPEN,
		']': Token.TYPE.T_SBCLOSE,
		'*': Token.TYPE.T_TIMES,
		'!': Token.TYPE.T_NOT,
		',': Token.TYPE.T_COMMA,
		'=': Token.TYPE.T_EQUAL,
		'<': Token.TYPE.T_LESS_THAN,
		'>': Token.TYPE.T_GREATER_THAN,
		'~': Token.TYPE.T_CONTAINS,
		'&': Token.TYPE.T_BITWISE_AND,
		'^': Token.TYPE.T_BITWISE_XOR,
		'|': Token.TYPE.T_BITWISE_OR,
		'?': Token.TYPE.T_TERNARY,
		':': Token.TYPE.T_TERNARY_ELSE,
		'': Token.TYPE.T_DEGRE
	};

	function ExpressionParser() {
		this.text = [];
	};

	ExpressionParser.prototype = {
		parse: function (infix) {
			var constants = {
				'pi'	: new Token(Token.TYPE.T_NUMBER, Math.PI),
				'now'	: new Token(Token.TYPE.T_DATE, new Date()),
				'today'	: new Token(Token.TYPE.T_DATE, new Date()),
				'true'	: new Token(Token.TYPE.T_BOOLEAN, true),
				'false'	: new Token(Token.TYPE.T_BOOLEAN, false)
			};
			var expr = new Expression(infix);
			var self = this;
			infix = infix.replace(/\\\'/g, '`');
			infix = infix.replace(/('[^']*')/g, function (match, m1, str) {
				self.text.push(m1.substr(1, m1.length - 2).replace(/`/g, "\'"));
				return "" + self.text.length;
			});
			infix = infix.replace(/\\\"/g, '`');
			infix = infix.replace(/("[^"]*")/g, function (match, m1, str) {
				self.text.push(m1.substr(1, m1.length - 2).replace(/`/g, '\"'));
				return "" + self.text.length;
			});
			infix = this.maskDate(infix);
			var toks = infix.split(PATTERN);
			var prev = new Token(Token.TYPE.T_NOOP, 'noop');
			for (var value of toks) {
				value = value.replace(/^\s+|\s+$/g, '');
				var matches;
				if (Number.isNumeric(value)) {
					if (prev.type == Token.TYPE.T_PCLOSE)
						expr.push(new Token(Token.TYPE.T_TIMES, '*'));
					expr.push(prev = new Token(Token.TYPE.T_NUMBER, parseFloat(value)));
				} else if (value.match(/^#\d+/)) {
					if (prev.type == Token.TYPE.T_PCLOSE)
						expr.push(new Token(Token.TYPE.T_TIMES, '*'));
					expr.push(prev = new Token(Token.TYPE.T_FIELD, parseInt(value.substr(1), 10)));
				} else if (matches = value.match(/^(\d+)/)) {
					if (prev.type == Token.TYPE.T_PCLOSE)
						expr.push(new Token(Token.TYPE.T_TIMES, '*'));
					var i = parseInt(matches[1], 10);
					expr.push(prev = new Token(Token.TYPE.T_TEXT, self.text[i - 1]));
				} else if (matches = value.match(/^D(\d{1,2})\.(\d{1,2})\.(\d{4})/)) {
					if (prev.type == Token.TYPE.T_PCLOSE)
						expr.push(new Token(Token.TYPE.T_TIMES, '*'));
					var date = Date.createFromFormat("j/n/Y", matches[1] + "/" + matches[2] + "/" + matches[3]);
					expr.push(prev = new Token(Token.TYPE.T_DATE, date));
				} else if (constants[value]) {
					if (prev.type == Token.TYPE.T_PCLOSE)
						expr.push(new Token(Token.TYPE.T_TIMES, '*'));
					expr.push(prev = constants[value]);
				} else if (value !== "") {
					var type;
					switch (type = lookup[value] ? lookup[value] : Token.TYPE.T_IDENT) {
						case Token.TYPE.T_EQUAL:
							switch (prev.type) {
								case Token.TYPE.T_NOT:
									expr.pop();
									type = Token.TYPE.T_NOT_EQUAL;
									value = "!=";
									break;
								case Token.TYPE.T_LESS_THAN:
									expr.pop();
									type = Token.TYPE.T_LESS_OR_EQUAL;
									value = "<=";
									break;
								case Token.TYPE.T_GREATER_THAN:
									expr.pop();
									type = Token.TYPE.T_GREATER_OR_EQUAL;
									value = ">=";
									break;
							}
							break;
						case Token.TYPE.T_CONTAINS:
							if (prev.type == Token.TYPE.T_NOT) {
								expr.pop();
								type = Token.TYPE.T_NOT_CONTAINS;
								value = "!~";
								break;
							}
						case Token.TYPE.T_BITWISE_AND:
							if (prev.type == Token.TYPE.T_BITWISE_AND) {
								expr.pop();
								type = Token.TYPE.T_LOGICAL_AND;
								value = "&&";
							}
							break;
						case Token.TYPE.T_BITWISE_OR:
							if (prev.type == Token.TYPE.T_BITWISE_OR) {
								expr.pop();
								type = Token.TYPE.T_LOGICAL_OR;
								value = "||";
							}
							break;
						case Token.TYPE.T_TIMES:
							if (prev.type == Token.TYPE.T_TIMES) {
								expr.pop();
								type = Token.TYPE.T_POW;
								value = "**";
							}
							break;
						case Token.TYPE.T_PLUS:
							if (prev.isOperator() || prev.isComparator() || prev.isBeforeFunctionArgument())
								type = Token.TYPE.T_UNARY_PLUS;
							break;

						case Token.TYPE.T_MINUS:
							if (prev.isOperator() || prev.isComparator() || prev.isBeforeFunctionArgument())
								type = Token.TYPE.T_UNARY_MINUS;
							break;

						case Token.TYPE.T_POPEN:
							switch (prev.type) {
								case Token.TYPE.T_IDENT:
									prev.type = Token.TYPE.T_FUNCTION;
									break;

								case Token.TYPE.T_NUMBER:
								case Token.TYPE.T_DATE:
								case Token.TYPE.T_BOOLEAN:
								case Token.TYPE.T_TEXT:
								case Token.TYPE.T_ARRAY:
								case Token.TYPE.T_PCLOSE:
									expr.push(new Token(Token.TYPE.T_TIMES, '*'));
									break;
							}
							break;

						case Token.TYPE.T_SBOPEN:
							t = expr.pop();
							expr.push(new Token(Token.TYPE.T_FUNCTION, 'get'));
							expr.push(new Token(Token.TYPE.T_POPEN, '('));
							expr.push(t);
							type = Token.TYPE.T_COMMA;
							value = ',';
							break;

						case Token.TYPE.T_SBCLOSE:
							type = Token.TYPE.T_PCLOSE;
							value = '(';
							break;

					}
					expr.push(prev = new Token(type, value));
				}
			}
			return expr;
		},

		maskDate: function (infix) {
			var re = new RegExp(Date.regexp, "g");
			return infix.replace(re, "D"+Date.replacement);
		}

	};

	global.ExpressionParser = ExpressionParser;
}(this));

(function (global) {
	'use strict';

	function RuleEngine(rules) {
		this.rulesData = rules.rulesData || [];
		this.actionsAdapter = rules.actionsAdapter;
	}

	RuleEngine.prototype = { 
		runAll: function(conditionsAdapter, cb) {
			var self = this;
			self.rulesData.forEach( (rule, r) => {
				self.run(r, conditionsAdapter, cb);
			});
		},

		run: function(ruleIndex, conditionsAdapter, cb) {
			var self = this;
			var rule = self.rulesData[ruleIndex];
			self.ifActions = rule.ifActions || [];
			self.elseActions = rule.elseActions || [];
			self.conditions = rule.conditions || {all: []};
			var out, error;
			self.matches(conditionsAdapter, function(err, result) {
				out = result;
				error = err;
				if (!err) {
					if (result) {
						self.runIfActions(self.actionsAdapter);
					} else {
						self.runElseActions(self.actionsAdapter);
					}
				}
				if (cb) {
					cb(err, result);
				}
			});
			if (!cb) {
				if (error) {
					throw error;
				}
				return out;
			}
		},

		matches: function(conditionsAdapter, cb) {
			var parser = new ExpressionParser();
			var expr = parser.parse(this.conditions);
			expr.postfix();
			expr.setVariables(conditionsAdapter);
			var result = expr.evaluate();
			if (result === false) {
				var e = "Syntax error";
				if (cb) {
					cb(e, result);
				}
			} else {
				if (cb) {
					cb(null, result === 'true');
				} else {
					return result === 'true';
				}
			}
		},

		runIfActions: function(actionsAdapter) {
			for (var i=0; i < this.ifActions.length; i++) {
				var actionData = this.ifActions[i];
				var actionName = actionData.value;
				var actionFunction = actionsAdapter[actionName]
				if (actionFunction) { 
					actionFunction(new Finder(actionData)); 
				}
			}
		},

		runElseActions: function(actionsAdapter) {
			for (var i=0; i < this.elseActions.length; i++) {
				var actionData = this.elseActions[i];
				var actionName = actionData.value;
				var actionFunction = actionsAdapter[actionName]
				if (actionFunction) { 
					actionFunction(new Finder(actionData)); 
				}
			}
		},

	 
	};

	function Finder(data) {
		this.data = data;
	}

	Finder.prototype = {
		find: function() {
		  var currentNode = this.data;
		  for (var i=0; i < arguments.length; i++) {
			var name = arguments[i];
			currentNode = findByName(name, currentNode);
			if (!currentNode) { 
				return null; 
			}
		  }
		  return currentNode.value;
		}
	};

	function findByName(name, node) {
		var fields = node.fields || [];
		for (var i=0; i < fields.length; i++) {
			var field = fields[i];
			if (field.name === name) {
				return field;
			}
		}
		return null;
	}

	global.RuleEngine = RuleEngine;
}(this));

(function (global) {
	'use strict';

	function G6k(options) {
		this.isMobile = options.mobile;
		Date.setRegionalSettings(options);
		MoneyFunction.setRegionalSettings(options);
		this.locale = Translator.locale = Date.locale = options.locale;
		this.dateFormat = Date.format;
		this.inputDateFormat = Date.inputFormat;
		this.decimalPoint = MoneyFunction.decimalPoint;
		this.moneySymbol = MoneyFunction.moneySymbol;
		this.symbolPosition = MoneyFunction.symbolPosition;
		this.groupingSeparator = MoneyFunction.groupingSeparator;
		this.groupingSize = MoneyFunction.groupingSize;
		this.parser = new ExpressionParser();
		this.rulesengine = null;
		this.simu = options.simulator;
		this.currentStep = this.simu.steps[0]['id'];
		this.form = options.form;
		this.currentProfil = null;
		this.variables = {};
		this.sourceRequestsQueue = [];
		this.sourceRequestRunning = false;
		this.sourceRequestsCache = {};
		this.lastUserInputName = "";
		this.lastSubmitBtnId = null;
		this.hasFatalError = false;
		this.hasGlobalError = false;
		this.hasError = false;
		this.basePath = window.location.pathname.replace(/\/[^\/]+$/, "");
		this.preloadCounter = 0;
	};

	G6k.prototype = {
		run: function () {
			this.createPreloader();
			this.hideAlertFields();
			this.hideNonCurrentSteps();
			this.initializeSourcedDatas();
			this.initializeResetButton();
			this.initializeExpandAllButtons();
			this.initializeWidgets();
			this.processFields();
			this.initializeExternalFunctions();
		},

		createPreloader: function() {
			var self = this;
			var preloader = document.createElement('div');
			preloader.classList.add('simulator-preloader');
			var image = document.createElement('div');
			image.classList.add('image');
			preloader.appendChild(image);
			document.querySelector('article.simulator-container').appendChild(preloader);
			setTimeout(function(){
				if (self.preloadCounter !== false) {
					alert(Translator.trans("Simulator server takes too long to respond"));
				}
			}, 5000);
		},

		removePreloader: function() {
			this.preloadCounter = false;
			var preloader = document.querySelector('.simulator-preloader');
			preloader.parentElement.removeChild(preloader);
			document.querySelector('article.simulator-container .outer-wrap').classList.remove('hidden');
		},

		incPreloadCounter: function() {
			if (this.preloadCounter !== false) {
				this.preloadCounter++;
			}
		},

		decPreloadCounter: function() {
			if (this.preloadCounter !== false) {
				this.preloadCounter--;
				if (this.preloadCounter == 0) {
					this.removePreloader();
				}
			}
		},

		hideAlertFields: function() {
			this.form.querySelectorAll('.global-alert, .group-alert, .field-alert').forEach( alert => {
				this.hideObject(alert);;
			});
		},

		hideNonCurrentSteps: function() {
			for (var step of this.simu.steps) {
				if (step.id != this.currentStep) {
					this.hideObject(this.form.querySelector('#' + step.elementId));
				}
			}
		},

		initializeSourcedDatas: function() {
			var self = this;
			self.incPreloadCounter();
			for (const name in self.simu.datas) {
				var data = self.simu.datas[name];
				if (data.type === 'choice' || data.type === 'multichoice') {
					if (data.choices && data.choices.source) {
						var completed = self.checkSourceParameters(data.choices.source.id);
						if (completed) {
							var type = self.simu.sources[data.choices.source.id]['datasource']['type'];
							var returnType = self.simu.sources[data.choices.source.id]['returnType'];
							if (type === 'uri' && (returnType === 'json' || returnType === 'csv' || (document.evaluate && (returnType === 'xml'|| returnType === 'html')))) {
								self.getUriSource(data.choices.source.id);
							} else {
								self.getInternalSource(data.choices.source.id);
							}
						}
					}
				} else if (typeof data.unparsedSource !== "undefined" && data.unparsedSource !== "") {
					var source = self.evaluate(data.unparsedSource);
					if (source !== false) {
						var completed = self.checkSourceParameters(source);
						if (completed) {
							var type = self.simu.sources[source]['datasource']['type'];
							var returnType = self.simu.sources[source]['returnType'];
							if (type === 'uri' && (returnType === 'json' || returnType === 'csv' || (document.evaluate && (returnType === 'xml'|| returnType === 'html')))) {
								self.getUriSource(source);
							} else {
								self.getInternalSource(source);
							}
						}
					}
				}
			}
			self.decPreloadCounter();
		},

		initializeResetButton: function() {
			var self = this;
			var inputs = self.form.querySelectorAll("input[type='reset'], button[type='reset']");
			inputs.forEach((input) => {
				input.addEventListener('click', function(event) {
					self.clearForm(self.form);
					var resettables = self.form.querySelectorAll("input.resettable, button[type='reset']");
					resettables.forEach((resettable) => {
						resettable.value = "";
					});
					self.variables = {};
					for (const name in self.simu.datas) {
						var data = self.simu.datas[name];
						data.modifiedByUser = false;
						self.form.querySelectorAll("span.output[data-name='" + name + "']").forEach( span => {
							span.innerText = "";
						});
						self.resetDataValue(data);
						self.removeError(name);
						self.removeWarning(name);
						if (typeof data.unparsedContent !== "undefined" && data.unparsedContent !== "") {
							var content = self.evaluate(data.unparsedContent);
							if (content !== false) {
								if (content && data.type === "multichoice" && ! Array.isArray(content)) {
									if (/\[\]$/.test(content)) {
										content = JSON.parse(content);
									} else {
										content = [content];
									}
								} else if (content && (data.type === "money" || data.type === "percent")) {
									content = self.unFormatValue(content);
									content = parseFloat(content).toFixed(data.round || 2);
								} else if (content && data.type === "number") {
									content = self.unFormatValue(content);
									if (data.round) {
										content = parseFloat(content).toFixed(data.round);
									}
								}
								data.value = content;
								self.setVariable(name, data);
							} else if (data.value !== '') {
								data.value = '';
								self.setVariable(name, data);
							}
						}
						self.reevaluateFields(name);
					}
					self.removeGlobalError();
				}, false);
			});
		},

		initializeExpandAllButtons: function() {
			var collapseExpandAllTools = this.form.querySelectorAll(".blockinfo .collapse-expand-all-tools");
			collapseExpandAllTools.forEach( collapseExpandAllTool => {
				var collapseAllButton = collapseExpandAllTool.firstElementChild;
				collapseAllButton.addEventListener("click", function(e) {
					var scope = this.closest('.blockinfo');
					var expandeds = scope.querySelectorAll(".chapter-label > h3 > button[aria-expanded='true']");
					expandeds.forEach( expanded => expanded.dispatchEvent(new MouseEvent('click')));
					e.stopPropagation();
					e.preventDefault();
				});
				var expandAllButton = collapseExpandAllTool.lastElementChild;
				expandAllButton.addEventListener("click", function(e) {
					var scope = this.closest('.blockinfo');
					var collapseds = scope.querySelectorAll(".chapter-label > h3 > button[aria-expanded='false']");
					collapseds.forEach( collapsed => collapsed.dispatchEvent(new MouseEvent('click')));
					e.stopPropagation();
					e.preventDefault();
				});
			});
		},

		setCurrentStep: function(stepId) {
			this.currentStep = stepId;
		},

		setProfile: function(profile) {
			var self = this;
			var id = profile.getAttribute('data-profile-id');
			if (self.currentProfil == null || self.currentProfil.getAttribute('data-profile-id') != id) {
				if (self.currentProfil != null) {
					self.currentProfil.classList.remove('active');
				}
				self.currentProfil = profile;
				profile.classList.add('active');
				self.simu.profiles.profiles.forEach( aprofile => {
					if (aprofile.elementId == id) {
						aprofile.datas.forEach( (data) => {
							self.setValue(data.name, data.default);
						});
					}
				});
			}
		},

		normalizeName: function(name) {
			if (/\[\]$/.test(name)) {
				name = name.substr(0, name.length - 2);
			}
			return name;
		},

		getData: function(name) {
			name = this.normalizeName(name);
			var data = this.simu.datas[name];
			return data;
		},

		getInputByName: function(name) {
			name = this.normalizeName(name);
			return this.form.querySelector("input[name='"+ name +"'], select[name='"+ name +"'], textarea[name='"+ name +"']");
		},

		getDataNameById: function(id) {
			for (const name in this.simu.datas) {
				var data = this.simu.datas[name];
				if (data.id == id) {
					return name;
				}
			}
			return null;
		},

		getStep: function() {
			for (var s = 0; s < this.simu.steps.length; s++) {
				var step = this.simu.steps[s];
				if (step.id == this.currentStep) {
					return step;
				}
			}
			return null;
		},

		getPreviousStep: function() {
			for (var s = 0; s < this.simu.steps.length; s++) {
				var step = this.simu.steps[s];
				if (step.id == this.currentStep) {
					if (s > 0) {
						return this.simu.steps[s - 1];
					}
				}
			}
			return null;
		},

		getNextStep: function() {
			for (var s = 0; s < this.simu.steps.length; s++) {
				var step = this.simu.steps[s];
				if (step.id == this.currentStep) {
					if (s < this.simu.steps.length - 1) {
						return this.simu.steps[s + 1];
					}
				}
			}
			return null;
		},

		getStepChildElement: function(parameters) {
			var element = this.getStep().name;
			if (parameters.panel) {
				element += '-panel-' + parameters.panel;
				if (parameters.blockgroup) {
					var blockinfo = element + '-blockinfo-' + parameters.blockgroup;
					if (document.getElementById(blockinfo) !== null) {
						element = blockinfo;
					} else {
						element += '-fieldset-' + parameters.blockgroup;
					}
					element = document.getElementById(element);
					if (element) {
						element = element.parentElement;
					}
				} else if (parameters.blockinfo) {
					element += '-blockinfo-' + parameters.blockinfo;
					if (parameters.chapter) {
						element += '-chapter-' + parameters.chapter;
						if (parameters.section) {
							element += '-section-' + parameters.section;
						} else if (parameters.content) {
							element += '-section-' + parameters.content + '-content';
						} else if (parameters.annotations) {
							element += '-section-' + parameters.annotations + '-annotations';
						}
					}
					element = document.getElementById(element);
				} else if (parameters.fieldset) {
					element += '-fieldset-' + parameters.fieldset;
					if (parameters.fieldrow) {
						element += '-fieldrow-' + parameters.fieldrow;
					}
					if (parameters.field) {
						var selector = '#' + element + " [data-field-position='" + parameters.field + "']";
						element = document.querySelector(selector);
					} else if (parameters.prenote) {
						var selector = '#' + element + " [data-field-position='" + parameters.prenote + "'] .pre-note";
						element = document.querySelector(selector);
					} else if (parameters.postnote) {
						var selector = '#' + element + " [data-field-position='" + parameters.postnote + "'] .post-note";
						element = document.querySelector(selector);
					} else {
						element = document.getElementById(element);
					}
				} else {
					element = document.getElementById(element);
				}
			} else if (parameters.footnote) {
				element = document.getElementById(parameters.footnote);
			} else {
				element = document.getElementById(element);
			}
			return element;
		},

		isFieldVisible: function (name) {
			var input = this.form.querySelector("input[name='"+ name +"'], select[name='"+ name +"'], textarea[name='"+ name +"']");
			if (! input) {
				return false;
			}
			return this.isObjectVisible(input);
		},

		isObjectVisible: function (obj) {
			if (! obj) {
				return false;
			}
			return window.getComputedStyle(obj).display !== "none" && obj.offsetWidth > 0 && obj.offsetHeight > 0;
		},

		check: function(data) {
			if (!data || !data.value || data.value.length == 0) {
				return true;
			}
			switch (data.type) {
				case 'date':
					try {
						var d = Date.createFromFormat(Date.inputFormat, data.value);
					} catch (e) {
						return false;
					}
					break;
				case 'money':
					if (! /^-{0,1}\d+(\.\d{1,2})?$/.test(data.value)) {
						return false;
					}
					break;
				case 'integer':
					if (! /^\d+$/.test(data.value)) {
						return false;
					}
					break;
				case 'number':
				case 'percent':
					if (! /^-{0,1}\d*\.{0,1}\d+$/.test(data.value)) {
						return false;
					}
					break;
				case 'text':
					if (data.pattern) {
						var re = new RegExp(data.pattern);
						return re.test(data.value);
					}
					break;
			}
			return true;
		},

		resetMin: function(name) {
			var input = this.getInputByName(name);
			var data = this.getData(name);
			if (null !== input && data.unparsedMin) {
				var min = this.evaluate(data.unparsedMin);
				if (min !== false) {
					if (data.type === 'text' || data.type === 'textarea') {
						min = parseInt(min, 10);
						if (min) {
							input.setAttribute('minlength', min);
						}
					} else if (data.type === 'date') {
						input.setAttribute('min', min);
					} else {
						min = data.type === 'integer' ? parseInt(min, 10) : parseFloat(min);
						if (min) {
							input.setAttribute('min', min);
						}
					}
				}
			}
		},

		checkMin: function(data) {
			if (!data || !data.value || data.value.length == 0) {
				return true;
			}
			if (data.type != 'number' && data.type != 'integer' && data.type != 'percent' && data.type != 'money' && data.type != 'date' && data.type != 'text' && data.type != 'textarea') {
				return true;
			}
			if (data.unparsedMin) {
				var min = this.evaluate(data.unparsedMin);
				if (min !== false) {
					if (data.type === 'text' || data.type === 'textarea') {
						min = parseInt(min, 10);
						if (min && data.value.length < min) {
							return false;
						}
					} else if (data.type === 'date') {
						min = Date.createFromFormat(Date.inputFormat, min);
						var val = Date.createFromFormat(Date.inputFormat, data.value);
						if (val < min ) {
							return false;
						}
					} else {
						min = data.type === 'integer' ? parseInt(min, 10) : parseFloat(min);
						var val  = data.type === 'integer' ? parseInt(data.value, 10) : parseFloat(data.value);
						if (min && val < min ) {
							return false;
						}
					}
				}
			}
			return true;
		},

		resetMax: function(name) {
			var input = this.getInputByName(name);
			var data = this.getData(name);
			if (null !== input && data.unparsedMax) {
				var max = this.evaluate(data.unparsedMax);
				if (max !== false) {
					if (data.type === 'text' || data.type === 'textarea') {
						max = parseInt(max, 10);
						if (max) {
							input.setAttribute('maxlength', max);
						}
					} else if (data.type === 'date') {
						input.setAttribute('max', max);
					} else {
						max = data.type === 'integer' ? parseInt(max, 10) : parseFloat(max);
						if (max) {
							input.setAttribute('max', max);
						}
					}
				}
			}
		},

		checkMax: function(data) {
			if (!data || !data.value || data.value.length == 0) {
				return true;
			}
			if (data.type != 'number' && data.type != 'integer' && data.type != 'percent' && data.type != 'money' && data.type != 'date' && data.type != 'text' && data.type != 'textarea') {
				return true;
			}
			if (data.unparsedMax) {
				var max = this.evaluate(data.unparsedMax);
				if (max !== false) {
					if (data.type === 'text' || data.type === 'textarea') {
						max = parseInt(max, 10);
						if (max && data.value.length > max) {
							return false;
						}
					} else if (data.type === 'date') {
						max = Date.createFromFormat(Date.inputFormat, max);
						var val = Date.createFromFormat(Date.inputFormat, data.value);
						if (val > max ) {
							return false;
						}
					} else {
						max = data.type === 'integer' ? parseInt(max, 10) : parseFloat(max);
						var val  = data.type === 'integer' ? parseInt(data.value, 10) : parseFloat(data.value);
						if (max && val > max) {
							return false;
						}
					}
				}
			}
			return true;
		},

		validate: function(name) {
			var ok = true;
			name = this.normalizeName(name);
			var data = this.getData(name);
			if (data.inputField) {
				var field = this.findFieldProperties(data.inputField);
				if (field.usage === 'input') {
					this.removeError(name);
					this.removeWarning(name);
					if (!this.check(data)) {
						ok = false;
						switch (data.type) {
							case 'date':
								this.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans(Date.format) }, 'messages'));
								break;
							case 'number': 
								this.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans("numbers only") }, 'messages'));
								break;
							case 'integer': 
								this.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans("numbers only") }, 'messages'));
								break;
							case 'money': 
								this.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans("amount") }, 'messages'));
								break;
							case 'percent':
								this.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans("percentage") }, 'messages'));
								break;
							default:
								this.setError(name, Translator.trans("This value is not in the expected format"));
						}
					} else if (field.required && (!data.value || data.value.length == 0)) {
						this.setError(name, Translator.trans("The '%field%' field is required",  { "field": field.label }, 'messages'));
					} else if (field.visibleRequired && this.isFieldVisible(name) && (!data.value || data.value.length == 0)) {
						this.setError(name, Translator.trans("The '%field%' field is required",  { "field": field.label }, 'messages'));
					} else if (!this.checkMin(data)) {
						var min = this.evaluate(data.unparsedMin);
						if (data.type === 'text' || data.type === 'textarea') {
							this.setError(name, Translator.trans("The length of the field '%field%' cannot be less than %min%",  { "field": field.label, "min": min }, 'messages'));
						} else {
							this.setError(name, Translator.trans("The value of the field '%field%' cannot be less than %min%",  { "field": field.label, "min": min }, 'messages'));
						}
					} else if (!this.checkMax(data)) {
						var max = this.evaluate(data.unparsedMax);
						if (data.type === 'text' || data.type === 'textarea') {
							this.setError(name, Translator.trans("The length of the field '%field%' cannot be greater than %max%",  { "field": field.label, "max": max }, 'messages'));
						} else {
							this.setError(name, Translator.trans("The value of the field '%field%' cannot be greater than %max%",  { "field": field.label, "max": max }, 'messages'));
						}
					}
				}
			}
			return ok;
		},

		setGlobalWarning: function(warning) {
			if (!document.getElementById('global-alert').classList.contains('has-error')) {
				var globalError = document.getElementById('global-alert');
				if (globalError) {
					globalError.classList.replace('hidden', 'has-warning');
					globalError.innerHTML = warning;
					this.showObject(globalError);
					globalError.removeAttribute('aria-hidden');
				}
			}
		},

		removeGlobalWarning: function() {
			if (!document.getElementById('global-alert').classList.contains('has-error')) {
				var globalError = document.getElementById('global-alert');
				if (globalError) {
					globalError.classList.replace('has-warning', 'hidden');
					globalError.innerText = "";
					globalError.setAttribute('aria-hidden', true);
					this.hideObject(globalError);
				}
			}
		},

		setGroupWarning: function(name, warning) {
			var errorContainer = document.getElementById(name + "-alert");
			if (! errorContainer.classList.contains('has-error')) {
				errorContainer.classList.replace('hidden', 'has-warning');
				errorContainer.innerHTML = warning;
				this.showObject(errorContainer);
				errorContainer.removeAttribute('aria-hidden');
			}
		},

		removeGroupWarning: function(name) {
			var errorContainer = document.getElementById(name + "-alert");
			if (! errorContainer.classList.contains('has-error')) {
				errorContainer.classList.replace('has-warning', 'hidden');
				errorContainer.innerText = "";
				errorContainer.setAttribute('aria-hidden', true);
				this.hideObject(errorContainer);
			}
		},

		setWarning: function(name, warning) {
			var self = this;
			var field = self.getInputByName(name);
			if (null !== field && field.hasAttribute('id')) {
				var fieldContainer = field.closest(".field-container");
				var visible = this.isObjectVisible(fieldContainer);
				var inputs = self.form.querySelectorAll("input[name='" + name + "'], input[type='checkbox'], select[name='" + name + "']");
				for (var input of inputs) {
					if (input.type === 'checkbox') {
						var n = self.normalizeName(input.getAttribute('name'));
						if (n != name) continue;
					}
					if (visible && !input.classList.contains('has-error')) {
						input.classList.add('has-warning');
						input.closest('.field-group').classList.replace('hidden', 'has-warning');
						input.focus();
					}
				}
				if (this.getData(name).datagroup) {
					this.setGroupWarning(this.getData(name).datagroup, warning);
				} else if (visible) {
					var fieldError = fieldContainer.querySelectorAll("div.field-alert");
					fieldError = fieldError.item(fieldError.length - 1);
					fieldError.classList.replace('hidden', 'has-warning');
					fieldError.innerHTML = warning;
					this.showObject(fieldContainer);
					fieldContainer.removeAttribute('aria-hidden');
					this.showObject(fieldContainer.parentElement);
					fieldContainer.parentElement.removeAttribute('aria-hidden');
					this.hasWarning = true;
				}
			}
		},

		removeWarning: function(name) {
			var self = this;
			var field = self.getInputByName(name);
			if (null !== field && field.hasAttribute('id')) {
				if (this.getData(name).datagroup) {
					this.removeGroupWarning(this.getData(name).datagroup);
				} else {
					var fieldContainer = field.closest(".field-container");
					var fieldError = fieldContainer.querySelectorAll("div.field-alert");
					fieldError = fieldError.item(fieldError.length - 1);
					fieldError.classList.replace('has-warning', 'hidden');
					fieldError.innerText = "";
				}
				var inputs = self.form.querySelectorAll("input[name='" + name + "'], input[type='checkbox'], select[name='" + name + "']");
				for (var input of inputs) {
					if (input.type === 'checkbox') {
						var n = self.normalizeName(input.getAttribute('name'));
						if (n != name) return true;
					}
					input.classList.remove('has-warning');
					input.closest('.field-group').classList.remove('has-warning');
				}
			}
		},

		setFatalError: function(error) {
			this.hasFatalError = true;
			this.hasGlobalError = true;
			this.hasError = true;
			var globalError = document.getElementById('global-alert');
			globalError.classList.add("fatal-error");
			this.form.querySelectorAll("input, select, textarea").forEach( (input) => input.setAttribute( "disabled", true ));
			var errorhtml = "";
			if (Array.isArray(error)) {
				errorhtml = '<p>' + error.join('</p><p>') + '</p>';
			} else {
				errorhtml = '<p>' + error + '</p>';
			}
			globalError.classList.replace('hidden', 'has-error');
			globalError.innerHTML = errorhtml;
			this.showObject(globalError);
			globalError.removeAttribute('aria-hidden');
		},

		setGlobalError: function(error) {
			this.hasGlobalError = true;
			this.hasError = true;
			var errorhtml = "";
			if (Array.isArray(error)) {
				errorhtml = '<p>' + error.join('</p><p>') + '</p>';
			} else {
				errorhtml = '<p>' + error + '</p>';
			}
			var globalError = document.getElementById('global-alert');
			globalError.classList.replace('hidden', 'has-error');
			globalError.innerHTML = errorhtml;
			this.showObject(globalError);
			globalError.removeAttribute('aria-hidden');
		},

		removeGlobalError: function() {
			this.form.querySelectorAll("input, select, textarea").forEach( (input) => input.removeAttribute( "disabled"));
			var globalError = document.getElementById('global-alert');
			globalError.classList.replace('has-error', 'hidden')
			globalError.innerText = "";
			globalError.setAttribute('aria-hidden', true);
			this.hideObject(globalError);
			this.hasGlobalError = false;
		},

		setGroupError: function(name, error) {
			this.hasError = true;
			var errorContainer = document.getElementById(name + "-alert");
			var errorhtml = "";
			if (Array.isArray(error)) {
				errorhtml = '<p>' + error.join('</p><p>') + '</p>';
			} else {
				errorhtml = '<p>' + error + '</p>';
			}
			errorContainer.classList.replace('hidden', 'has-error');
			errorContainer.innerHTML = errorhtml;
			this.showObject(errorContainer);
			errorContainer.removeAttribute('aria-hidden');
		},

		removeGroupError: function(name) {
			var errorContainer = document.getElementById(name + "-alert");
			errorContainer.classList.replace('has-error', 'hidden')
			errorContainer.innerText = "";
			errorContainer.setAttribute('aria-hidden', true);
			this.hideObject(errorContainer);
		},

		setError: function(name, error) {
			var self = this;
			var field = self.getInputByName(name);
			if (null !== field && field.hasAttribute('id')) {
				var fieldContainer = field.closest(".field-container");
				var visible = this.isObjectVisible(fieldContainer);
				var inputs = self.form.querySelectorAll("input[name='" + name + "'], input[type='checkbox'], select[name='" + name + "']");
				for (var input of inputs) {
					if (input.type === 'checkbox') {
						var n = self.normalizeName(input.getAttribute('name'));
						if (n != name) continue;
					}
					if (visible) {
						input.classList.add('has-error');
						if (self.getData(name).datagroup) {
							input.setAttribute('aria-describedby', self.getData(name).datagroup + '-error');
						} else {
							input.setAttribute('aria-describedby', field.id + '-alert');
						}
						input.closest('.field-group').classList.replace('hidden', 'has-error');
						input.setAttribute('aria-invalid', true);
						input.focus();
					}
				}
				if (self.getData(name).datagroup) {
					self.setGroupError(self.getData(name).datagroup, error);
				} else if (visible) {
					var errorhtml = "";
					if (Array.isArray(error)) {
						errorhtml = '<p>' + error.join('</p><p>') + '</p>';
					} else {
						errorhtml = '<p>' + error + '</p>';
					}
					var fieldError = fieldContainer.querySelectorAll("div.field-alert");
					fieldError = fieldError.item(fieldError.length - 1);
					fieldError.classList.replace('hidden', 'has-error');
					fieldError.innerHTML = errorhtml;
					this.showObject(fieldContainer);
					fieldContainer.removeAttribute('aria-hidden');
					self.showObject(fieldContainer.parentElement);
					fieldContainer.parentElement.removeAttribute('aria-hidden');
					self.hasError = true;
				}
			}
		},

		removeError: function(name) {
			var self = this;
			var field = self.getInputByName(name);
			if (null !== field && field.hasAttribute('id')) {
				if (self.getData(name).datagroup) {
					self.removeGroupError(self.getData(name).datagroup);
				} else {
					var fieldContainer = field.closest(".field-container");
					var fieldError = fieldContainer.querySelectorAll("div.field-alert");
					fieldError = fieldError.item(fieldError.length - 1);
					fieldError.classList.replace('has-error', 'hidden');
					fieldError.innerText = "";
				}
				var inputs = self.form.querySelectorAll("input[name='" + name + "'], input[type='checkbox'], select[name='" + name + "']");
				for (var input of inputs) {
					if (input.type === 'checkbox') {
						var n = self.normalizeName(input.getAttribute('name'));
						if (n != name) continue;
					}
					input.classList.remove('has-error');
					input.removeAttribute('aria-describedby');
					input.closest('.field-group').classList.remove('has-error');
					if (input.hasAttribute('type') && input.type === 'number') {
						input.removeAttribute('aria-invalid');
					} else {
						input.setAttribute('aria-invalid', false);
					}
				}
			}
		},

		setFormValue: function(name, data) {
			var self = this;
			if (data.type === "multichoice") {
				self.form.querySelectorAll("input[type='checkbox']").forEach( (input) => {
					var n = self.normalizeName(input.getAttribute('name'));
					if (n == name) {
						if (data.value.includes(input.value)) {
							if (! input.checked) input.setAttribute('checked', true);
						} else {
							if (input.checked) input.removeAttribute('checked');
						}
					}
				});
				return;
			}
			var inputsSelector = "span.output[data-name=" + name + "]";
			if (name !== self.lastUserInputName || data.type === "integer" || data.type === "number" || data.type === "date") {
				inputsSelector += ", input[name=" + name + "], select[name=" + name + "], textarea[name=" + name + "]";
			}
			self.form.querySelectorAll(inputsSelector).forEach( (input) => {
				var tag = input.tagName.toLowerCase();
				if (tag === 'span') {
					input.innerText = self.formatValue(data);
				} else if (tag === 'select') {
					if (input.value != data.value) input.value = data.value;
				} else if (input.type === 'radio') {
					var fieldset = input.closest('fieldset');
					var radio = fieldset.querySelector("input[value='" + data.value + "']");
					if (! (radio && radio.checked)) {
						fieldset.querySelectorAll('input').forEach (radio => {
							radio.checked = false;
							radio.closest('label').classList.remove('checked');
						});
						fieldset.querySelectorAll('input').forEach (radio => {
							if (radio.value == data.value) {
								radio.checked = true;
								radio.closest('label').classList.add('checked');
							}
						});
					}
				} else if (input.type === 'checkbox') {
					if (input.value != data.value) input.value = data.value;
				} else if (input.type === 'date') {
					var value = Date.createFromFormat(Date.inputFormat, data.value).format('Y-m-d')
					if (input.value != value) input.value = value;
				} else {
					if (input.value != data.value) input.value = data.value;
				}
			});
		},

		resetDataValue: function (data) {
			if (data.type === "multichoice") {
				data.value = [];
			} else {
				data.value = "";
			}
		},

		unsetChoiceValue: function(name, value) { // only for type = 'multichoice'
			var data = this.getData(name);
			if (value && data && data.type === "multichoice" && ! Array.isArray(value)) {
				var ovalues = data.value ? data.value : [];
				var pos = ovalues.indexOf(value);
				if (pos >= 0) {
					ovalues.splice( pos, 1 );
					data.value = ovalues;
					this.setVariable(name, data);
					this.validate(name);
					if (this.simu.memo && this.simu.memo == "1" && data.memorize && data.memorize == "1") {
						if (! cookie.exists(name) || cookie.get(name) != value) {
							cookie.create(name, value, { expires: 365, path: this.basePath });
						}
					}
					this.lastUserInputName = "";
					this.reevaluateFields(name);
				}
			}
		},

		unsetValue: function(name) {
			var self = this;
			var data = self.getData(name);
			if (data.value !== '') {
				setTimeout(function() { 
					self.setValue(name, '');
				}, 0);
			}
		},
		
		isPlainObject: function (obj) {
			return Object.prototype.toString.call(obj) === '[object Object]';
		},

		setValue: function(name, value) {
			var self = this;
			var data = self.getData(name);
			if ((Array.isArray(value) || self.isPlainObject(value)) && data.type != "array" && data.type != "multichoice") {
				var avalue = value;
				value = "";
				if (Array.isArray(value)) {
					value = value[0];
				} else {
					for (const val in avalue) {
						value = val;
						break;
					}
				}
			}
			if (value && (data.type === "money" || data.type === "percent")) {
				value = self.unFormatValue(value);
				value = parseFloat(value).toFixed(data.round || 2);
			} else if (value && (data.type === "number")) {
				value = self.unFormatValue(value);
				if (data.round) {
					value = parseFloat(value).toFixed(data.round);
				}
			} else if (value && data.type === "multichoice" && ! Array.isArray(value)) {
				if (/\[\]$/.test(value)) {
					value = JSON.parse(value);
				} else {
					var ovalues = data.value ? data.value : [];
					ovalues.push(value);
					value = ovalues;
				}
			}
			data.value = value;
			self.setVariable(name, data);
			self.validate(name);
			self.setFormValue(name, data);
			if (self.simu.memo && self.simu.memo == "1" && data.memorize && data.memorize == "1") {
				if (! cookie.exists(name) || cookie.get(name) != value) {
					cookie.create(name, value, { expires: 365, path: self.basePath });
				}
			}
			self.lastUserInputName = "";
			self.reevaluateFields(name);
		},

		setVariable: function (name, data) {
			this.variables[name] = data.value;
			if (! data.value && data.deflt) {
				this.variables[name] = data.deflt;
			}
		},

		evaluate: function (expression) {
			var expr = this.parser.parse(expression);
			expr.postfix();
			expr.setVariables(this.variables);
			return expr.evaluate();
		},

		evaluateDefaults: function() {
			var self = this;
			for (var name in self.simu.datas) {
				var data = self.simu.datas[name];
				if (typeof data.unparsedDefault !== "undefined" && data.unparsedDefault !== "") {
					var value = self.evaluate(data.unparsedDefault);
					if (value !== false) {
						data.deflt = value;
					}
				}
			}
		},

		reevaluateFields: function (name) {
			var self = this;
			var data = this.getData(name);
			if (typeof data.unparsedExplanation !== "undefined" && data.unparsedExplanation !== "") {
				var explanation = this.evaluate(data.unparsedExplanation);
				this.form.querySelectorAll("span.explanation[data-name='" + name + "']").forEach( span => {
					if (explanation === false) {
						span.innerText = "";
					} else {
						span.innerHTML = explanation;
					}
				});
			}
			if (data.defaultDependencies) {
				data.defaultDependencies.forEach( dependency => {
					var field = self.getData(dependency);
					if (typeof field.unparsedDefault !== "undefined" && field.unparsedDefault !== "") {
						var value = self.evaluate(field.unparsedDefault);
						if (value !== false) {
							field.deflt = value;
						}
					}
				});
			}
			if (data.minDependencies) {
				data.minDependencies.forEach( dependency => {
					var field = self.getData(dependency);
					if (field.unparsedMin !== "undefined" && field.unparsedMin !== "") {
						self.resetMin(dependency);
					}
				});
			}
			if (data.maxDependencies) {
				data.maxDependencies.forEach( dependency => {
					var field = self.getData(dependency);
					if (field.unparsedMax !== "undefined" && field.unparsedMax !== "") {
						self.resetMax(dependency);
					}
				});
			}
			if (data.indexDependencies) {
				data.indexDependencies.forEach( dependency => {
					var field = self.getData(dependency);
					if (field.unparsedIndex !== "undefined" && field.unparsedIndex !== "") {
						self.reevaluateFields(dependency);
					}
				});
			}
			if (data.contentDependencies) {
				data.contentDependencies.forEach( dependency => {
					var field = self.getData(dependency);
					if ((! field.modifiedByUser || field.value === '') && typeof field.unparsedContent !== "undefined" && field.unparsedContent !== "") {
						var content = self.evaluate(field.unparsedContent);
						if (content !== false) {
							if (content && field.type === "multichoice" && ! Array.isArray(content)) {
								if (/\[\]$/.test(content)) {
									content = JSON.parse(content);
								} else {
									content = [content];
								}
							}
							if (field.value !== content) {
								self.setValue(dependency, content);
							}
						} else {
							self.unsetValue(dependency);
						}
					}
				});
			}
			if (data.noteDependencies) {
				data.noteDependencies.forEach( dependency => {
					var fieldId = dependency.replace(/^(prenote|postnote)/, 'field');
					var field = self.findFieldProperties(fieldId);
					if (field.prenote) {
						var prenote = self.replaceVariables(field.prenote);
						if (prenote !== false) {
							var prenoteElt = self.form.querySelector('#' + fieldId + '-container .prenote');
							var oldNote = prenoteElt.innerHTML;
							if (prenote != oldNote) {
								prenoteElt.innerHTML = prenote;
								prenoteElt.setAttribute('aria-live', 'polite');
							} else {
								prenoteElt.removeAttribute('aria-live');
							}
						}
					}
					if (field.postnote) {
						var postnote = self.replaceVariables(field.postnote);
						if (postnote !== false) {
							var postnoteElt = self.form.querySelector('#' + fieldId + '-container .postnote');
							var oldNote = postnoteElt.innerHTML;
							if (postnote != oldNote) {
								postnoteElt.innerHTML = postnote;
								postnoteElt.setAttribute('aria-live', 'polite');
							} else {
								postnoteElt.removeAttribute('aria-live');
							}
						}
					}
				});
			}
			if (data.sectionContentDependencies) {
				data.sectionContentDependencies.forEach( dependency => {
					var sectionId = dependency;
					var section = self.findSectionProperties(sectionId);
					var content = section.content;
					var newcontent = self.replaceVariablesOrBlank(content);
					var contentElt = self.form.querySelector('#' + sectionId + '-content');
					var oldContent = contentElt.innerHTML;
					if (newcontent != oldContent) {
						contentElt.innerHTML = newcontent;
						contentElt.setAttribute('aria-live', 'polite');
					} else {
						contentElt.removeAttribute('aria-live');
					}
				});
			}
			if (data.footNoteDependencies) {
				data.footNoteDependencies.forEach( dependency => {
					var footnote = self.findFootnoteProperties(dependency);
					var footnotetext = self.replaceVariables(footnote.text);
					if (footnotetext !== false) {
						var footnoteElt = self.form.querySelector("#" + dependency);
						var oldNote = footnoteElt.innerHTML;
						if (footnotetext != oldNote) {
							footnoteElt.innerHTML = footnotetext;
							footnoteElt.setAttribute('aria-live', 'polite');
						} else {
							footnoteElt.removeAttribute('aria-live');
						}
					}
				});
				var footnotes = self.form.querySelector("#footnotes" + self.currentStep);
				if (null !== footnotes) {
					if ( Array.from(footnotes.children).some(node => self.isObjectVisible(node)) ) {
						self.showObjectLater(footnotes);
					} else {
						self.hideObject(footnotes);
					}
				}
			}
			if (data.sourceDependencies) {
				data.sourceDependencies.forEach( dependency => {
					var completed = self.checkSourceParameters(dependency);
					if (completed) {
						var type = self.simu.sources[dependency]['datasource']['type'];
						var returnType = self.simu.sources[dependency]['returnType'];
						if (type === 'uri' && (returnType === 'json' || returnType === 'csv' || (document.evaluate && (returnType === 'xml'|| returnType === 'html')))) {
							self.getUriSource(dependency);
						} else {
							self.getInternalSource(dependency);
						}
					} else {
						self.resetSourceDatas(dependency);
						self.populateChoiceDependencies(dependency, []);
					}
				});
			}
			if (data.rulesConditionsDependency) {
				data.rulesConditionsDependency.forEach( rule => {
					self.rulesengine.run(
						rule - 1, 
						self.variables, 
						function(err, result) {
							if (err) {  }
						}
					);
				});
			}
			if (data.rulesActionsDependency) {
				data.rulesActionsDependency.forEach( rule => {
					self.rulesengine.run(
						rule - 1, 
						self.variables, 
						function(err, result) {
							if (err) {  }
						}
					);
				});
			}
		},

		formatParamValue: function (param) {
			var data = this.getData(param.data);
			if (typeof data.value === "undefined" || data.value === "") {
				return null;
			}
			var value = data.value;
			switch (data.type) {
				case "date":
					var format = param.format;
					if (format != "" && value != "") {
						var date = Date.createFromFormat(Date.inputFormat, value);
						value = date.format(format);
					}
					break;
				case "day":
					var format = param.format;
					if (format != "" && value != "") {
						var date = Date.createFromFormat("j/n/Y", value + "/1/2015");
						value = date.format(format);
					}
					break;
				case "month":
					var format = param.format;
					if (format != "" && value != "") {
						var date = Date.createFromFormat("j/n/Y", "1/" + value + "/2015");
						value = date.format(format);
					}
					break;
				case "year":
					var format = param.format;
					if (format != "" && value != "") {
						var date = Date.createFromFormat("j/n/Y", "1/1/" + value);
						value = date.format(format);
					}
					break;
			}
			return value;
		},

		str_getcsv: function(input, delimiter, enclosure, escape) {
			// Thanks to Locutus
			// https://github.com/kvz/locutus/blob/master/src/php/strings/str_getcsv.js
			var output = [];
			var _backwards = function (str) {
				return str.split('').reverse().join('');
			}
			var _pq = function (str) {
				return String(str).replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}=!<>\|:])/g, '\\$1');
			}
			delimiter = delimiter || ',';
			enclosure = enclosure || '"';
			escape = escape || '\\';
			var pqEnc = _pq(enclosure);
			var pqEsc = _pq(escape);
			input = input.replace(new RegExp('^\\s*' + pqEnc), '').replace(new RegExp(pqEnc + '\\s*$'), '');
			input = _backwards(input).split(new RegExp(pqEnc + '\\s*' + _pq(delimiter) + '\\s*' + pqEnc + '(?!' + pqEsc + ')', 'g')).reverse();
			for (var i = 0, inpLen = input.length; i < inpLen; i++) {
				output.push(_backwards(input[i]).replace(new RegExp(pqEsc + pqEnc, 'g'), enclosure));
			}
			return output;
		},

		xmlToObject: function (node) {
			switch (node.nodeType) {
				case 9: // document
				case 1: // element
					var object = {};
					var attributes = node.attributes;
					for (var a = 0; a < attributes.length; a++) {
						var attr = attributes.item(a);
						object[attr.name] = attr.value;
					}
					var children = node.childNodes;
					var hasChildOrAttributes = node.attributes.length > 0;
					var text = '';
					if (! hasChildOrAttributes) {
						for (var c = 0; c < children.length; c++) {
							var child = children.item(c);
							if (child.nodeType == 3) {
								text += child.nodeValue;
							} else if (child.nodeType == 1 || child.nodeType == 2) {
								hasChildOrAttributes = true;
								break;
							}
						}
					}
					var nodeObj = {};
					if (! hasChildOrAttributes) {
						nodeObj[node.nodeName] = text;
					} else {
						for (var c = 0; c < children.length; c++) {
							var child = children.item(c);
							var childObj = self.xmlToObject(child);
							if (childObj != null) {
								object[child.nodeName] = childObj;
							}
						}
						nodeObj[node.nodeName] = object;
					}
					return nodeObj;
				case 2: // attribute
					var object = {};
					object[node.name] = node.value;
					return object;
				case 3: // text
					return node.nodeValue;
				default:
					return null;
			}
		},

		checkSourceParameters: function (source) {
			var self = this;
			var completed = true;
			var params = self.simu.sources[source]['parameters'];
			params.forEach( param => {
				if (param.origin === 'data' && param.optional == '0') {
					var d = self.getData(param.data);
					if (typeof d.value === "undefined" || d.value === "") {
						completed = false;
						return false;
					} else if ((d.type === 'text' || d.type === 'textarea') && d.unparsedMin) {
						var min = self.evaluate(d.unparsedMin);
						if (min === false || d.value.length < parseInt(min, 10)) {
							completed = false;
							return false;
						}
					}
				}
			});
			return completed;
		},

		getUriSource: function (source) {
			var self = this;
			var path = '';
			var query = '';
			var headers = [];
			var datas = {};
			var ok = true;
			var params = self.simu.sources[source]['parameters'];
			params.forEach( param => {
				var value;
				if (param.origin == 'data') {
					value = self.formatParamValue(param);
				} else {
					value = param.constant;
				}
				if (value == null) { 
					if (param.optional == '0') {
						ok = false;
						return false;
					}
					value = '';
				}
				if (param.type == 'path') {
					if (value != '' || param.optional == '0') {
						path += "/" + value.replace(/\s+/g, '+');
					}
				} else if (param.type === 'data') {
					var name = param.name;
					if (datas[name]) {
						datas[name].push(value);
					} else {
						datas[name] = [value];
					}
					query += '&' + encodeURI(name) + '=' + encodeURI(value);
				} else if (param.type === 'header') {
					if (value != '') {
						headers[param.name] = value;
					}
				} else if (value != '' || param.optional == '0') {
					datas[param.name] = value;
					query += '&' + encodeURI(param.name) + '=' + encodeURI(value);
				}
			});
			if (! ok) {
				return null;
			}
			var uri = self.simu.sources[source]['datasource']['uri'];
			if (path != "") {
				uri += encodeURI(path);
			}
			if (query != '') {
				query = uri + '?' + query.substr(1);
			}
			var method = self.simu.sources[source]['datasource']['method'];
			var returnType = self.simu.sources[source]['returnType'];
			self.enqueueSourceRequest(source, method.toUpperCase(), uri, datas, returnType, headers,
				function (source, returnType, result) {
					var returnPath = self.simu.sources[source]['returnPath'];
					returnPath = self.replaceVariables(returnPath);
					if (returnType == 'json') {
						if (returnPath != '') {
							if (/^\\$/.test(returnPath)) { // jsonpath
								result = JSONPath({path: returnPath, json: result});
							} else { // xpath
								result = defiant.json.search(result, returnPath);
								if (Array.isArray(result) && result.length == 1) {
									result = result[0];
								}
							}
						}
					} else if (returnType == 'csv') {
						var separator = self.simu.sources[source]['separator'];
						var delimiter = self.simu.sources[source]['delimiter'];
						var lines = result.split(/\n/);
						result = [];
						for (var l = 0; l < lines.length; l++) {
							var line = trim(lines[l]);
							if (line != '') {
								var csv = self.str_getcsv(line, separator, delimiter);
								var cols = csv.map( c => {
									return trim(c);
								});
								result.push(cols);
							}
						}
						if (returnPath) {
							var indices = returnPath.split("/");
							indices.forEach( index => {
								result = result[parseInt(index, 10) - 1];
							});
						}
					} else if (returnType == 'xml'|| returnType == 'html') {
						result = extractXMLResult(result, returnPath);
					}
					self.processSource(source, result, returnType);
				},
				function(source, returnType, result) {
					self.resetSourceDatas(source);
					self.populateChoiceDependencies(source, []);
				}
			);
		},

		extractXMLResult: function (result, returnPath) {
			var snapshot = document.evaluate(returnPath, result[0], null, XPathResult.ORDERED_NODE_SNAPSHOT_TYPE, null); 
			result = [];
			try {
				for (var i = 0, len = snapshot.snapshotLength; i < len; i++) {
					var node = snapshot.snapshotItem(i);
					switch (node.nodeType) {
						case 9: // document
						case 1: // element
							result.push(self.xmlToObject(node));
							break;
						case 2: // attribute
							var object = {};
							object[node.name] = node.value;
							result.push(object);
							break;
						case 3: // text
							result.push(node.nodeValue);
					}
				}
			}
			catch (e) {
			}
			return result;
		},

		getInternalSource: function (source) {
			var self = this;
			var post = {};
			post['source'] = source;
			var returnPath = self.simu.sources[source]['returnPath'];
			var replacedPath = self.replaceVariables(returnPath);
			if (replacedPath != returnPath) {
				post['returnPath'] = replacedPath;
			}
			var params = self.simu.sources[source]['parameters'];
			params.forEach( param => {
				if (param.origin === 'data') {
					var d = self.getData(param.data);
					if (typeof d.value !== "undefined" && d.value !== "") {
						post[param.name] = d.value;
					}
				} else if (param.origin === 'constant') {
					post[param.name] = param.constant;
				}
			});
			var view = self.form.querySelector("input[name='view']").value;
			var token = self.form.querySelector("input[name='_csrf_token']");
			if (token && token.value) {
				post['_csrf_token'] = token.value;
			}
			const re = new RegExp('\\/' + view + '(\\/\\w+)?');
			var path = window.location.pathname.replace(re, "").replace(/\/+$/, "") + "/Default/source";
			path = path.replace("/sandbox/", "/mysimu5dev/calcul/").replace(".html",""); // PROVISOIRE:  supprimer aprs intgration dans symfony
			self.enqueueSourceRequest(source, 'POST', path, post, 'json',[],
				function (source, returnType, result) {
					self.processSource(source, result, 'assocArray');
				},
				function(source, returnType, result) {
					self.resetSourceDatas(source);
					self.populateChoiceDependencies(source, []);
				}
			);

		},

		enqueueSourceRequest: function(source, method, uri, data, returnType, headers, success, error) {
			var self = this;

			self.sourceRequestsQueue.push({
				source: source, 
				method: method, 
				uri: uri, 
				data: data, 
				returnType: returnType, 
				headers: headers, 
				success: success,
				error: error
			});

			function runSourceRequest() {
				if (self.sourceRequestRunning) {
					return;
				}
				if (self.sourceRequestsQueue.length > 0) {
					self.sourceRequestRunning = true;
					var q = self.sourceRequestsQueue.shift();
					var qs = "";
					for (var key in q.data) {
						if (qs != "") {
							qs += "&";
						}
						qs += key + "=" + encodeURIComponent(q.data[key]);
					}
					var key = q.uri + '?' +qs;
					if (self.sourceRequestsCache[key]) {
						if (self.sourceRequestsCache[key]['error']) {
							q.error.call(self, q.source, "json", self.sourceRequestsCache[key]);
						} else {
							q.success.call(self, q.source, q.returnType, self.sourceRequestsCache[key]);
						}
						self.sourceRequestRunning = false;
						runSourceRequest();
					} else {
						self.incPreloadCounter();
						ajax({
							method: q.method,
							url: q.uri,
							dataType: q.returnType,
							data: q.data,
							headers: q.headers
						}).then(function( response, xhr, textStatus ) {
							self.sourceRequestsCache[key] = response;
							q.success.call(self, q.source, q.returnType, response);
						}).catch(function(response, xhr, textStatus) {
							if ((xhr.status != 0 && xhr.status >= 500) || textStatus === 'timeout') {
								self.setFatalError( Translator.trans("Data to continue this simulation are not accessible. Please try again later.") );
							} else {
								var result = { 'error': xhr.statusText };
								self.sourceRequestsCache[key] = result;
								q.error.call(self, q.source, "json", result);
							}
						}).always(function( response, xhr, textStatus ) {
							self.sourceRequestRunning = false;
							runSourceRequest();
							self.decPreloadCounter();
						});
					}
				}
			}

			runSourceRequest();
		},

		processSource: function(source, result, returnType) {
			var self = this;
			for (const name in self.simu.datas) {
				var data = self.simu.datas[name];
				if (typeof data.unparsedSource !== "undefined" && data.unparsedSource !== "") {
					var s = self.evaluate(data.unparsedSource);
					if (s == source) {
						if (typeof data.unparsedIndex !== "undefined" && data.unparsedIndex !== "") {
							var index;
							if (returnType == 'assocArray') {
								index = self.evaluate(data.unparsedIndex);
							} else {
								index = data.unparsedIndex.replace(/^'/, '').replace(/'$/, '');
								index = self.replaceVariables(index);
							}
							if (index !== false) {
								var value = result;
								if (returnType == 'assocArray') {
									if (value[index]) {
										self.setValue(name, value[index]);
									} else {
										self.setValue(name, value[index.toLowerCase()]);
									}
								} else if (returnType == 'json') {
									if (index != '') {
										if (/^\\$/.test(index)) { // jsonpath
											value = JSONPath({path: index, json: value});
										} else { // xpath
											value = defiant.json.search(value, index);
											if (Array.isArray(value) && value.length == 1) {
												value = value[0];
											}
										}
									}
									self.setValue(name, value);
								} else if (returnType == 'csv') {
									var indices = index.split("/");
									indices.forEach( ind => {
										value = value[parseInt(ind, 10) - 1];
									});
									self.setValue(name, value);
								} else if (returnType == 'xml'|| returnType == 'html') {
									value = extractXMLResult(value, index);
									if (Array.isArray(value) && value.length == 1) {
										value = value[0];
									}
									self.setValue(name, value);
								}
							} else {
								self.unsetValue(name);
							}
						} else {
							self.setValue(name, result);
						}
					}
				}
			}
			this.populateChoiceDependencies(source, result);
		},

		resetSourceDatas: function(source) {
			var self = this;
			for (const name in self.simu.datas) {
				var data = self.simu.datas[name];
				if (typeof data.unparsedSource !== "undefined" && data.unparsedSource !== "") {
					var s = self.evaluate(data.unparsedSource);
					if (s == source) {
						self.unsetValue(name);
					}
				}
			}
		},

		populateChoiceDependencies : function (source, result) {
			var self = this;
			var dependencies = this.simu.sources[source]['choiceDependencies'];
			if (dependencies) {
				dependencies.forEach( dependency => {
					var data = self.getData(dependency);
					var field = self.findFieldProperties(data.inputField);
					var input = document.getElementById(field.elementId);
					if (input.tagName.toLowerCase() === 'select') {
						var valueColumn = data.choices.source.valueColumn;
						var labelColumn = data.choices.source.labelColumn;
						var prompt = field.prompt || '-----'
						var options = ['<option value="">' + prompt + '</option>'];
						for (var r in result) {
							var row = result[r];
							var value = row[valueColumn] || row[valueColumn.toLowerCase()];
							var label = row[labelColumn] || row[labelColumn.toLowerCase()];
							var selected = data.value && value == data.value ? ' selected="selected"' : '';
							options.push('<option value="', value, '"' + selected + '>', label, '</option>');
						}
						input.innerHTML = options.join('');
					}
					// self.setValue(dependency, "");
				});
			}
		},

		validateAll: function() {
			var self = this;
			var ok = true;
			this.hasError = false;
			for (const name in self.simu.datas) {
				ok = self.validate(name) && ok;
			}
			if (ok) self.rulesengine.runAll(self.variables,
				function(err, result) {
					if (err) {
					}
				}
			);
			return ok && !self.hasError;
		},

		processFields: function () {
			var self = this;
			self.variables['script'] = 1;
			self.variables['dynamic'] = 1;

			self.evaluateDefaults();
			self.form.querySelectorAll("input[name]:not([type='radio']):not([type='checkbox']), input[type='radio'][name]:checked, input[type='checkbox'][name]:checked, select[name], textarea[name]").forEach( input => {
				var name = self.normalizeName(input.getAttribute('name'));
				var data = self.getData(name);
				if (data) {
					var value = input.value;
					if (value && (data.type === "money" || data.type === "percent" || data.type === "number")) {
						value = self.unFormatValue(value);
					}
					if (data.type === 'multichoice') {
						if (input.getAttribute('type') === 'checkbox') {
							var ovalues = self.variables[name] || [];
							ovalues.push(value);
							value = ovalues;
						} else if (/^\[.*\]$/.test(value)) {
							value = JSON.parse(value);
						}
					}
					self.variables[name] = value;
				}
			});

			var rulesData = [];
			this.simu.rules.forEach( rule => {
				rulesData.push(
					{
						conditions: rule.conditions,
						ifActions: rule.ifdata,
						elseActions: rule.elsedata
					}
				);
			});
			var actionsAdapter = {
				notifyError: function(data) {
					var errorMessage = data.find("message"); 
					var target = data.find("target");
					switch (target) {
						case 'data':
							var fieldName = data.find("target", "fieldName");
							self.setError(fieldName, self.replaceVariables(errorMessage));
							break;
						case 'datagroup':
							var datagroupName = data.find("target", "datagroupName");
							self.setGroupError(datagroupName, self.replaceVariables(errorMessage));
							break;
						case 'dataset':
							self.setGlobalError(self.replaceVariables(errorMessage));
							break;
					}
				},
				notifyWarning: function(data) {
					var warningMessage = data.find("message"); 
					var target = data.find("target");
					switch (target) {
						case 'data':
							var fieldName = data.find("target", "fieldName");
							self.setWarning(fieldName, self.replaceVariables(warningMessage));
							break;
						case 'datagroup':
							var datagroupName = data.find("target", "datagroupName");
							self.setGroupWarning(datagroupName, self.replaceVariables(warningMessage));
							break;
						case 'dataset':
							self.setGlobalWarning(self.replaceVariables(warningMessage));
							break;
					}
				},
				setAttribute: function(data) {
					var attribute = data.find("attributeId");
					var fieldName = data.find("attributeId", "fieldName");
					var newValue = data.find("attributeId", "fieldName", "newValue");
					switch (attribute) {
						case 'content':
							var data = self.getData(fieldName);
							data.unparsedContent = newValue;
							if (data.unparsedContent !== "") {
								if ((! data.modifiedByUser || ! data.value || data.value.length == 0)) {
									var content = self.evaluate(data.unparsedContent);
									if (content !== false) {
										if (content && data.type === "multichoice" && ! Array.isArray(content)) {
											if (/\[\]$/.test(content)) {
												content = JSON.parse(content);
											} else {
												content = [content];
											}
										}
										if (data.value !== content) {
											self.setValue(fieldName, content);
										}
									}
								}
							} else {
								self.unsetValue(fieldName);
							}
							break;
						case 'default':
							self.getData(fieldName).unparsedDefault = newValue;
							break;
						case 'explanation':
							self.getData(fieldName).unparsedExplanation = newValue;
							break;
						case 'index':
							self.getData(fieldName).unparsedIndex = newValue;
							self.reevaluateFields(fieldName);
							break;
						case 'min':
							self.getData(fieldName).unparsedMin = newValue;
							self.resetMin(fieldName);
							break;
						case 'max':
							self.getData(fieldName).unparsedMax = newValue;
							self.resetMax(fieldName);
							break;
						case 'source':
							self.getData(fieldName).unparsedSource = newValue;
							break;
					}
				},
				unsetAttribute: function(data) {
					var attribute = data.find("attributeId");
					var fieldName = data.find("attributeId", "fieldName");
					switch (attribute) {
						case 'content':
							var data = self.getData(fieldName);
							data.unparsedContent = '';
							self.unsetValue(fieldName);
							break;
						case 'default':
							self.getData(fieldName).unparsedDefault = '';
							break;
						case 'explanation':
							self.getData(fieldName).unparsedExplanation = '';
							break;
						case 'index':
							self.getData(fieldName).unparsedIndex = '';
							self.reevaluateFields(fieldName);
							break;
						case 'min':
							self.getData(fieldName).unparsedMin = '';
							self.resetMin(fieldName);
							break;
						case 'max':
							self.getData(fieldName).unparsedMax = '';
							self.resetMax(fieldName);
							break;
						case 'source':
							self.getData(fieldName).unparsedSource = '';
							break;
					}
				},
				hideObject: function(data) {
					var objectId = data.find("objectId");
					var stepId = data.find("objectId", "stepId");
					switch (objectId) {
						case 'step':
							self.hideObject(document.getElementById("step" + stepId));
							break;
						case 'panel':
							var panelId = data.find("objectId", "stepId", "panelId");
							self.hideObject(document.getElementById("panel" + stepId + "-" + panelId));
							break;
						case 'fieldset':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							self.hideObject(document.getElementById("fieldset" + stepId + "-" + panelId + "-" + fieldsetId));
							break;
						case 'fieldrow':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId");
							self.hideObject(document.getElementById("fieldrow" + stepId + "-" + panelId + "-" + fieldsetId + "-" + fieldrowId));
							break;
						case 'field':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId");
							var fieldId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId");
							self.hideObject(document.getElementById("field" + stepId + "-" + panelId + "-" + fieldsetId+ "-" + fieldrowId + "-" + fieldId + "-container"));
							break;
						case 'blockinfo':
							var panelId = data.find("objectId", "stepId", "panelId");
							var blockinfoId = data.find("objectId", "stepId", "panelId", "blockinfoId");
							self.hideObject(document.getElementById("blockinfo" + stepId + "-" + panelId + "-" + blockinfoId));
							break;
						case 'chapter':
							var panelId = data.find("objectId", "stepId", "panelId");
							var blockinfoId = data.find("objectId", "stepId", "panelId", "blockinfoId");
							var chapterId = data.find("objectId", "stepId", "panelId", "blockinfoId", "chapterId");
							self.hideObject(document.getElementById("chapter" + stepId + "-" + panelId + "-" + blockinfoId + "-" + chapterId));
							break;
						case 'section':
							var panelId = data.find("objectId", "stepId", "panelId");
							var blockinfoId = data.find("objectId", "stepId", "panelId", "blockinfoId");
							var chapterId = data.find("objectId", "stepId", "panelId", "blockinfoId", "chapterId");
							var sectionId = data.find("objectId", "stepId", "panelId", "blockinfoId", "chapterId", "sectionId");
							self.hideObject(document.getElementById("section" + stepId + "-" + panelId + "-" + blockinfoId + "-" + chapterId + "-" + sectionId));
							break;
						case 'prenote':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId") || 0;
							var fieldId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId");
							self.hideObject(document.getElementById("prenote" + stepId + "-" + panelId + "-" + fieldsetId + "-" + fieldrowId + "-" + fieldId));
							break;
						case 'postnote':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId") || 0;
							var fieldId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId");
							self.hideObject(document.getElementById("postnote" + stepId + "-" + panelId + "-" + fieldsetId + "-" + fieldrowId + "-" + fieldId));
							break;
						case 'action':
							var actionId = data.find("objectId", "stepId", "actionId");
							var action = document.getElementById("action" + stepId + '-' + actionId);
							action.setAttribute('aria-hidden', true);
							action.setAttribute('disabled', true);
							self.hideObject(action);
							break;
						case 'footnote':
							var footnoteId = data.find("objectId", "stepId", "footnoteId");
							var footnote = document.getElementById("footnote" + stepId + "-" + footnoteId);
							if (null !== footnote) {
								self.hideObject(footnote);
								var footnotes = self.form.querySelector("#footnotes" + stepId);
								if (Array.from(footnotes.children).some( note => self.isObjectVisible(note))) {
									self.showObjectLater(footnotes);
								} else {
									self.hideObject(footnotes);
								}
							}
							break;
						case 'choice':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId");
							var fieldId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId");
							var choiceId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId", "choiceId");
							var fieldContainer = document.getElementById("field" + stepId + "-" + panelId + "-" + fieldsetId + "-" + fieldrowId + "-" + fieldId + "-container");
							var input = fieldContainer.querySelector("select");
							if (input) {
								var option = input.querySelector("option[value='" + choiceId + "']");
								self.hideObject(option);
							} else {
								input = fieldContainer.querySelector("input[value='" + choiceId + "']");
								var label = input.closest('label');
								label.setAttribute('aria-hidden', true);
								self.hideObject(label);
							}
							break;
					}
				},
				showObject: function(data) {
					var objectId = data.find("objectId");
					var stepId = data.find("objectId", "stepId");
					switch (objectId) {
						case 'step':
							self.showObject(document.getElementById("step" + stepId));
							break;
						case 'panel':
							var panelId = data.find("objectId", "stepId", "panelId");
							self.showObjectLater(document.getElementById("panel" + stepId + "-" + panelId));
							break;
						case 'fieldset':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							self.showObject(document.getElementById("fieldset" + stepId + "-" + panelId + "-" + fieldsetId));
							break;
						case 'fieldrow':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId");
							self.showObject(document.getElementById("fieldrow" + stepId + "-" + panelId + "-" + fieldsetId + "-" + fieldrowId));
							break;
						case 'field':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId");
							var fieldId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId");
							self.showObject(document.getElementById("field" + stepId + "-" + panelId + "-" + fieldsetId+ "-" + fieldrowId + "-" + fieldId + "-container"));
							break;
						case 'blockinfo':
							var panelId = data.find("objectId", "stepId", "panelId");
							var blockinfoId = data.find("objectId", "stepId", "panelId", "blockinfoId");
							self.showObjectLater(document.getElementById("blockinfo" + stepId + "-" + panelId + "-" + blockinfoId));
							break;
						case 'chapter':
							var panelId = data.find("objectId", "stepId", "panelId");
							var blockinfoId = data.find("objectId", "stepId", "panelId", "blockinfoId");
							var chapterId = data.find("objectId", "stepId", "panelId", "blockinfoId", "chapterId");
							self.showObjectLater(document.getElementById("chapter" + stepId + "-" + panelId + "-" + blockinfoId + "-" + chapterId));
							break;
						case 'section':
							var panelId = data.find("objectId", "stepId", "panelId");
							var blockinfoId = data.find("objectId", "stepId", "panelId", "blockinfoId");
							var chapterId = data.find("objectId", "stepId", "panelId", "blockinfoId", "chapterId");
							var sectionId = data.find("objectId", "stepId", "panelId", "blockinfoId", "chapterId", "sectionId");
							self.showObjectLater(document.getElementById("section" + stepId + "-" + panelId + "-" + blockinfoId + "-" + chapterId + "-" + sectionId));
							break;
						case 'prenote':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId") || 0;
							var fieldId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId");
							self.showObject(document.getElementById("prenote" + stepId + "-" + panelId + "-" + fieldsetId + "-" + fieldrowId + "-" + fieldId));
							break;
						case 'postnote':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId") || 0;
							var fieldId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId");
							self.showObject(document.getElementById("postnote" + stepId + "-" + panelId + "-" + fieldsetId + "-" + fieldrowId + "-" + fieldId));
							break;
						case 'action':
							var actionId = data.find("objectId", "stepId", "actionId");
							var action = document.getElementById("action" + stepId + '-' + actionId);
							self.showObject(action);
							action.removeAttribute('aria-hidden');
							action.removeAttribute('disabled');
							break;
						case 'footnote':
							var footnoteId = data.find("objectId", "stepId", "footnoteId");
							var footnote = document.getElementById("footnote" + stepId + "-" + footnoteId);
							if (null !== footnote) {
								self.showObject(footnote);
								footnote.removeAttribute('aria-hidden');
								var footnotes = self.form.querySelector("#footnotes" + stepId);
								self.showObjectLater(footnotes);
							}
							break;
						case 'choice':
							var panelId = data.find("objectId", "stepId", "panelId");
							var fieldsetId = data.find("objectId", "stepId", "panelId", "fieldsetId");
							var fieldrowId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId");
							var fieldId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId");
							var choiceId = data.find("objectId", "stepId", "panelId", "fieldsetId", "fieldrowId", "fieldId", "choiceId");
							var fieldContainer = document.getElementById("field" + stepId + "-" + panelId + "-" + fieldsetId + "-" + fieldrowId + "-" + fieldId + "-container");
							var input = fieldContainer.querySelector("select");
							if (input) {
								var option = input.querySelector("option[value='" + choiceId + "']");
								self.showObject(option);
							} else {
								input = fieldContainer.querySelector("input[value='" + choiceId + "']");
								var label = input.closest('label');
								self.showObject(label);
								label.removeAttribute('aria-hidden', true);
							}
							break;
					}
				}
			};
			self.rulesengine = new RuleEngine({
				rulesData: rulesData,
				actionsAdapter: actionsAdapter
			});

			self.rulesengine.runAll(this.variables,
				function(err, result) {
					if (err) {  }
				}
			);

			self.form.querySelectorAll(".profiles ul li").forEach( li => {
				li.addEventListener("click", function(event) {
					self.setProfile(this);
				});
			}); 

			self.form.querySelectorAll(".profiles ul li").forEach( li => {
				li.addEventListener("keydown", function(event) {
					if (event.keyCode == 13 || event.keyCode == 32) {
						self.setProfile(this);
					}
				});
			}); 

			self.form.querySelectorAll("input[name], select[name], textarea[name]").forEach( input => {
				input.addEventListener("change", function(event) {
					clearTimeout(self.inputTimeoutId);
					var name = self.normalizeName(this.getAttribute('name'));
					self.lastUserInputName = name;
					var data = self.getData(name);
					data.modifiedByUser = true;
					self.removeGlobalError();
					var value = this.value;
					if (this.getAttribute('type') === 'date') {
						var date = new Date(value);
						var value = date.format(self.inputDateFormat);
					}
					if (this.getAttribute('type') === 'checkbox') {
						if (data.type === 'boolean') {
							value = this.checked ? 'true' : 'false';
							self.setValue(name, value);
						} else if (data.type === 'multichoice') {
								if (this.checked) {
									self.setValue(name, value);
								} else {
									self.unsetChoiceValue(name, value);
								}
						}
					} else {
						self.setValue(name, value);
					}
				});
			});
			self.form.querySelectorAll("input[name], select[name], textarea[name]").forEach( input => {
				input.addEventListener("focusout", function(event) {
					var name = self.normalizeName(this.getAttribute('name'));
					var data = self.getData(name);
					if (!self.check(data)) {
						switch (data.type) {
							case 'date':
								self.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans(Date.format) }, 'messages'));
								break;
							case 'number': 
								self.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans("numbers only") }, 'messages'));
								break;
							case 'integer': 
								self.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans("numbers only") }, 'messages'));
								break;
							case 'money': 
								self.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans("amount") }, 'messages'));
								break;
							case 'percent':
								self.setError(name, Translator.trans("This value is not in the expected format (%format%)",  { "format": Translator.trans("percentage") }, 'messages'));
								break;
							default:
								self.setError(name, Translator.trans("This value is not in the expected format"));
						}
					} else if (!self.checkMin(data)) {
						var min = self.evaluate(data.unparsedMin);
						if (data.type === 'text' || data.type === 'textarea') {
							self.setError(name, Translator.trans("The length of this value can not be less than %min%",  { "min": min }, 'messages'));
						} else {
							self.setError(name, Translator.trans("This value can not be less than %min%",  { "min": min }, 'messages'));
						}
					} else if (!self.checkMax(data)) {
						var max = self.evaluate(data.unparsedMax);
						if (data.type === 'text' || data.type === 'textarea') {
							self.setError(name, Translator.trans("The length of this value can not be greater than %max%",  { "max": max }, 'messages'));
						} else {
							self.setError(name, Translator.trans("This value can not be greater than %max%",  { "max": max }, 'messages'));
						}
					}
				});
			});
			self.form.querySelectorAll("input[type='text'][name], input[type='date'][name], input[type='money'][name], input[type='number'][name]").forEach( input => {
				input.addEventListener("keypress", function(event) {
					if (event.keyCode == 13) {
						event.preventDefault();
						self.getData(this.getAttribute('name')).modifiedByUser = true;
						this.dispatchEvent(new Event('change'));
						self.focusNextInputField(this);
					}
				});
				input.addEventListener('input', function(event) {
					if (!this.hasAttribute('data-widget')) {
						if (!this.hasAttribute('minlength') || this.value.length >= parseInt(this.getAttribute('minlength'), 10)) {
							self.triggerChange(this, true, true);
						}
					}
				});
				input.addEventListener('propertychange', function(event) {
					if (!this.hasAttribute('data-widget')) {
						if (!this.hasAttribute('minlength') || this.value.length >= parseInt(this.getAttribute('minlength'), 10)) {
							self.triggerChange(this, true, true);
						}
					}
				});
			});
			self.form.querySelectorAll("input[type='text'][name], input[type='date'][name], input[type='money'][name]").forEach( input => {
				input.addEventListener('paste', function(event) {
					var elt = this;
					self.getData(this.getAttribute('name')).modifiedByUser = true;
					clearTimeout(self.inputTimeoutId);
					self.inputTimeoutId = setTimeout( () => {
						elt.dispatchEvent(new Event('change'));
						self.focusNextInputField(elt);
					}, 0);
				});
			});
			self.form.querySelectorAll("fieldset label.choice input[type='radio'][name]").forEach( input => {
				input.addEventListener('change', function(event) {
					var label = this.closest('label.choice');
					label.closest('fieldset').querySelectorAll('label.choice').forEach( alabel => {
						alabel.classList.remove('checked');
					});
					if (this.checked) {
						label.classList.add('checked');
					}
				});
			});
			self.form.querySelectorAll("fieldset input[type='checkbox'][name]").forEach( input => {
				input.addEventListener('change', function(event) {
					var id = this.getAttribute('id');
					var label = this.closest('fieldset').querySelector("label[for='" + id + "']");
					if (this.checked) {
						label.classList.add('checked');
					} else {
						label.classList.remove('checked');
					}
				});
			});
			self.form.querySelectorAll("fieldset label.choice input[type='radio'][name]").forEach( input => {
				input.addEventListener('focus', function(event) {
					var label = this.closest('label.choice');
					label.closest('fieldset').classList.add('focused');
					var checked = false;
					label.closest('fieldset').querySelectorAll("label.choice input[type='radio'][name]").forEach( ainput => {
						if ( ainput.checked ) {
							checked = true;
						}
					});
					if (!checked) {
						label.classList.add('checked-candidate');
					}
				});
			});
			self.form.querySelectorAll("fieldset label.choice input[type='radio'][name]").forEach( input => {
				input.addEventListener('blur', function(event) {
					var fieldset = this.closest('label.choice').closest('fieldset');
					var focused = false;
					fieldset.querySelectorAll("label.choice input[type='radio'][name]").forEach( ainput => {
						if ( document.hasFocus() && ainput === document.activeElement ) {
							focused = true;
						}
					});
					if (!focused) {
						fieldset.classList.remove('focused');
					}
					fieldset.querySelectorAll('label.choice').forEach( alabel => {
						alabel.classList.remove('checked-candidate')
					});
				});
			});
			self.form.querySelectorAll("input[type='submit'][name], button[type='submit'][name]").forEach( input => {
				input.addEventListener('click', function(event) {
					self.lastSubmitBtnId = this.id;
				});
				input.addEventListener('keypress', function(event) {
					var key = event.which || event.keyCode;
					if (key == 13) {
						self.lastSubmitBtnId = this.id;
					}
				});
			});
			self.form.addEventListener('submit', function(event) {
				var buttonId = self.lastSubmitBtnId;
				var bwhat = self.getStep().actions[buttonId].what;
				var bfor = self.getStep().actions[buttonId].for;
				var buri = self.getStep().actions[buttonId].uri;
				if (bwhat == 'submit' && bfor == 'priorStep') {
					event.preventDefault();
					self.priorStep();
					return;
				}
				if (bwhat == 'submit' && bfor == 'newSimulation') {
					self.clearForm(self.form);
					self.form.querySelectorAll("input.resettable").forEach( input => {
						input.value = "";
					});
					event.preventDefault();
					return;
				}
				if (self.hasFatalError || ! self.validateAll()) {
					self.setGlobalError(Translator.trans("To continue you must first correct your entry"));
					event.preventDefault();
					return;
				}
				if (bwhat == 'submit' && bfor == 'nextStep') {
					event.preventDefault();
					self.nextStep();
				} else if (bwhat == 'submit' && bfor == 'jumpToStep') {
					event.preventDefault();
					self.jumpToStep(parseInt(buri, 10));
				} else if (bwhat == 'submit' && bfor == 'currentStep') {
					event.preventDefault();
				} else if (bwhat == 'submit' && bfor == 'externalPage') {
					self.form.action = buri;
					self.form.target = '_blank';
				}
			});
			for (const name in this.simu.datas) {
				var data = this.simu.datas[name];
				data.value = self.variables[name];
				if (typeof data.unparsedContent !== "undefined" && data.unparsedContent !== "") {
					var content = self.evaluate(data.unparsedContent);
					if (content !== false) {
						if (content && data.type === "multichoice" && ! Array.isArray(content)) {
							if (/\[\]$/.test(content)) {
								content = JSON.parse(content);
							} else {
								content = [content];
							}
						} else if (content && (data.type === "money" || data.type === "percent")) {
							content = self.unFormatValue(content);
							content = parseFloat(content).toFixed(data.round || 2);
						} else if (content && data.type === "number") {
							content = self.unFormatValue(content);
							if (data.round) {
								content = parseFloat(content).toFixed(data.round);
							}
						}
						data.value = content;
						self.setVariable(name, data);
					} else if (data.value !== '') {
						data.value = '';
						self.setVariable(name, data);
					}

				}
			}
			var scriptInput = this.form.querySelector("input[name='script']");
			if (scriptInput !== null && scriptInput.value == 0) {
				for (var name in self.simu.datas) {
					self.reevaluateFields(name);
				}
				scriptInput.value = 1;
			} else {
				for (var name in self.simu.datas) {
					self.reevaluateFields(name);
				}
			}
			self.checkFootnotesVisibility();
		},

		activateBreadcrumbItem: function() {
			var breadcrumb = this.form.querySelector('.simulator-breadcrumb');
			var current = null;
			if (null !== breadcrumb) {
				current = breadcrumb.querySelector('li.current');
				if (null !== current) {
					current.classList.remove('current');
					current.removeAttribute('title');
					current.setAttribute('aria-hidden', 'true');
				}
				current = breadcrumb.querySelector("[data-step='" + this.currentStep + "']");
				if (null !== current) {
					current.classList.add('current');
					current.setAttribute('title', Translator.trans('Current step : %step%', { step: this.currentStep }));
					current.removeAttribute('aria-hidden');
				}
			}
		},

		nextStep: function() {
			this.hideObject(document.getElementById(this.getStep().elementId));
			this.currentStep = this.getNextStep().id;
			this.activateBreadcrumbItem();
			this.showObject(document.getElementById(this.getStep().elementId));
		},

		priorStep: function() {
			this.hideObject(document.getElementById(this.getStep().elementId));
			this.currentStep = this.getPreviousStep().id;
			this.activateBreadcrumbItem();
			this.showObject(document.getElementById(this.getStep().elementId));
		},

		jumpToStep: function(stepId) {
			this.hideObject(document.getElementById(this.getStep().elementId));
			this.currentStep = stepId;
			this.activateBreadcrumbItem();
			this.showObject(document.getElementById(this.getStep().elementId));
		},

		triggerChange: function(input, delayed, modifiedByUser) {
			var self = this;
			clearTimeout(self.inputTimeoutId);
			if (typeof modifiedByUser !== "undefined") {
				self.getData(input.getAttribute('name')).modifiedByUser = modifiedByUser;
			}
			if (delayed) {
				self.inputTimeoutId = setTimeout(function () {
					input.dispatchEvent(new Event('change'));
				}, 500);
			} else {
				input.dispatchEvent(new Event('change'));
			}
		},

		initializeWidgets: function() {
			var self = this;
			var options = { 
				locale: self.locale,
				mobile: self.isMobile,
				dateFormat: self.dateFormat,
				decimalPoint: self.decimalPoint,
				moneySymbol: self.moneySymbol,
				symbolPosition: self.symbolPosition,
				groupingSeparator: self.groupingSeparator,
				groupingSize: self.groupingSize
			};
			self.form.querySelectorAll('input[data-widget], select[data-widget], textarea[data-widget]').forEach((input) => {
				var widget = window[input.getAttribute('data-widget')];
				widget.call(self, input, options, function (value, text, preserveVal, delayed) {
					if (!preserveVal) {
						input.value = value;
					}
					self.triggerChange(input, delayed);
				});
			});
		},

		initializeExternalFunctions: function() {
			var self = this;
			self.form.querySelectorAll('div.action_buttons > [data-function]').forEach( funcElt => {
				var func = funcElt.getAttribute('data-function');
				func = func.replace(/'/g, '"');
				func = JSON.parse(func);
				var funct = window[func.function];
				var that = funcElt;
				funct.call(self, that, func, function(ok, message) {
					if (self.hasGlobalError) {
						self.removeGlobalError();
					}
					if (message) {
						if (ok) {
							var mess = document.createElement('div');
							mess.classList.add(func.function.toLowerCase() + '-function-status', );
							mess.setAttribute('aria-live', 'assertive');
							mess.innerHTML = '<p>' + Translator.trans(message) + '</p>';
							that.parentElement.parentElement.insertBefore(mess, that.parentElement.nextSibling);
							mess.fadeOut(7000, function() {
								setTimeout(function() {
									mess.remove();
								}, 10);
							});
						} else {
							self.setGlobalError(Translator.trans(message));
						}
					}
				});
			});
		},

		findFieldProperties: function(elementId) {
			var steps = this.simu.steps
			for (var step of this.simu.steps) {
				for (var panel of step.panels) {
					for (var block of panel.blocks) {
						if (block.type === 'fieldset') {
							for (var fieldrow of block.fieldrows) {
								for (var field of fieldrow.fields) {
									if (field.elementId == elementId) {
										return field;
									}
								}
							}
						}
					}
				}
			}
			return null;
		},

		findSectionProperties: function(elementId) {
			var steps = this.simu.steps
			for (var step of this.simu.steps) {
				for (var panel of step.panels) {
					for (var block of panel.blocks) {
						if (block.type === 'blockinfo') {
							for (var chapter of block.chapters) {
								for (var section of chapter.sections) {
									if (section.elementId == elementId) {
										return section;
									}
								}
							}
						}
					}
				}
			}
			return null;
		},

		findFootnoteProperties: function(footnoteId) {
			var steps = this.simu.steps
			for (var step of this.simu.steps) {
				if (! Array.isArray(step.footnotes) && typeof step.footnotes === 'object') {
					var footnotes = step.footnotes.footnotes;
					for (var footnote in footnotes) {
						if (footnote == footnoteId) {
							return footnotes[footnote];
						}
					}
				}
			}
			return null;
		},

		checkFootnotesVisibility: function() {
			var self = this;
			self.form.querySelectorAll(".footnotes").forEach( footnotes => {
				if ( Array.from(footnotes.children).some(node => self.isObjectVisible(node)) ) {
					self.showObjectLater(footnotes);
				} else {
					self.hideObject(footnotes);
				}
			});
		},

		showObject: function(obj) {
			if (obj) {
				obj.classList.remove('hidden');
				obj.removeAttribute('aria-hidden');
			}
			return obj;
		},

		hideObject: function(obj) {
			if (obj) {
				obj.setAttribute('aria-hidden', true);
				obj.classList.add('hidden');
			}
			return obj;
		},

		showObjectLater: function(obj, delay) {
			delay = delay || 120;
			var self = this;
			setTimeout(function(){
				self.showObject(obj);
			}, delay);
			return obj;
		},

		choiceLabel: function(data) {
			var label = '';
			if (data.choices) {
				for (var c in data.choices) {
					var choice = data.choices[c];
					if (choice[data.value]) {
						label = choice[data.value];
						break;
					}
				}
			}
			return label;
		},

		formatValue: function(data) {
			var value = data.value;
			if (value && Number.isNumeric(value) && (data.type === "money" || data.type === "percent")) {
				value = new Intl.NumberFormat(this.locale, {
					minimumFractionDigits: data.round || 2,
					maximumFractionDigits: data.round || 2
				}).format(parseFloat(value));
			}
			if (value && data.type === "number") {
				value = new Intl.NumberFormat(this.locale, {
						minimumFractionDigits: data.round || 2,
						maximumFractionDigits: data.round || 2
				}).format(value);
			}
			if (value && data.type === "text") {
				if (/^https?\:\/\//.test(value)) {
					if (/(jpg|jpeg|gif|png|svg)$/i.test(value)) {
						value = '<img src="'+value+'" alt="'+value+'">';
					} else {
						value = '<a href="'+value+'">'+value+'</a>';
					}
				} else if (/^data\:image\//.test(value)) {
					value = '<img src="'+value+'" alt="*">';
				}
			}
			if (value && data.type === "choice") {
				var name = this.getDataNameById(data.id);
				var input = this.getInputByName(name);
				if (input !== null) {
					var tag = input.tagName.toLowerCase();
					if (tag === 'select') {
						var options = input.querySelectorAll('option');
						for (var option of options) {
							if (option.value == value) {
								value = option.innerText.trim();
								break;
							}
						}
					} else if (input.type === 'radio') {
						var radios = input.closest('fieldset').querySelectorAll("input[type='radio']");
						for (var radio of radios) {
							if (radio.value == value) {
								value = radio.parentElement.innerText.trim();
								break;
							}
						}
					}
				}
			}
			if (Array.isArray(value)) {
				value = value.join(", ");
			}
			return value;
		},

		unFormatValue: function(value) {
			if (typeof value === 'string') {
				var ts = new RegExp(this.groupingSeparator.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
				var dp = new RegExp(this.decimalPoint.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
				value = value.replace(ts, '').replace(dp, '.');
			}
			return value;
		},

		replaceVariablesBase: function(target) {
			var self = this;
			var result = target.replace(
				/\<data\s+[^\s]*\s*value="(\d+)"[^\>]*\>[^\<]+\<\/data\>(L?)/g,
				function (match, m1, m2, offs, str) {
					var name = self.getDataNameById(m1);
					return (name) ? '#(' + name + ')' + m2 : match;
				}
			);
			result = result.replace(
				/#\(([^\)]+)\)(L?)/g,
				function (match, m1, m2, offs, str) {
					var data = self.getData(m1);
					if (data && data.value) {
						if (m2 === 'L') {
							var label = self.choiceLabel(data);
							if (label !== '') {
								return label;
							}
						}
						return self.formatValue(data);
					} else {
						return match;
					}
				}
			);
			return result;
		},

		replaceVariables: function(target) {
			var result = this.replaceVariablesBase(target);
			return /#\(([^\)]+)\)/.test(result) ? false : result;
		},

		replaceVariablesOrBlank: function(target) {
			var self = this;
			var result = self.replaceVariablesBase(target);
			result = result.replace(
				/#\(([^\)]+)\)(L?)/g,
				function (match, m1, m2, offs, str) {
					var data = self.getData(m1);
					switch (data.type) {
						case 'integer':
						case 'number':
							return '0';
						case 'percent':
						case 'money':
							var v = data.value;
							data.value = '0';
							var formatted =  self.formatValue(data);
							data.value = v;
							return formatted;
						default:
							return '';
					}
				}
			);
			result = result.replace(
				/\<data\s+[^\s]*\s*value="(\d+)"[^\>]*\>[^\<]+\<\/data\>(L?)/g,
				function (match, m1, m2, offs, str) {
					var data = self.getData(m1);
					switch (data.type) {
						case 'integer':
						case 'number':
							return '0';
						case 'percent':
						case 'money':
							var v = data.value;
							data.value = '0';
							var formatted =  self.formatValue(data);
							data.value = v;
							return formatted;
						default:
							return '';
					}
				}
			);
			return result;
		},

		focusNextInputField: function (input) {
			var form = input.closest('form');
			var inputs = form.querySelectorAll('input, button, select, textarea, a[href]');
			inputs = Array.prototype.filter.call(inputs, (item) => {
				return item.tabIndex >= 0;
			});
			var index = inputs.indexOf(input);
			var next = inputs[index + 1] || inputs[0];
			next.focus();
		},

		clearForm: function(input) {
			var self = this;
			var tag = input.tagName.toLowerCase();
			if (tag == 'form') {
				var inputs = input.querySelectorAll("input[name], select[name], textarea[name]");
				inputs.forEach((input) => {
					self.clearForm(input);
				});
				return;
			}
			var type = input.type;
			if (type === 'text' || type === 'password'  || type === 'number'|| tag === 'textarea') {
				input.value = "";
			} else if (type === 'checkbox' || type === 'radio') {
				input.removeAttribute('checked');
			} else if (type === 'select-one' || tag === 'select') {
				var options = input.querySelectorAll("option");
				options.forEach((option) => {
					option.removeAttribute('selected');
					input.value = "";
				});
			}
		}

	};

	global.G6k = G6k;

}(this));

var G6K_SIMU = {
	"name": "demo",
	"label": "Simulateur de calcul de pension alimentaire",
	"category": "",
	"defaultView": "Demo",
	"referer": "",
	"memo": "0",
	"description": "<p>Le montant de la pension par enfant est calcul en proportion du revenu, net d'un minimum vital (RSA), du parent dbiteur. Cette proportion est diffrente selon le nombre total d'enfants  la charge du parent dbiteur (quelle que soit l'union dont ils sont ns) et l'amplitude du droit de visite et d'hbergement (rduit, classique, ou altern sans partage spontan des frais).</p>",
	"datas": {
		"revenus": {
			"id": 1,
			"label": "Revenus du dbiteur",
			"description": "<p>Sont prises en compte les ressources personnelles du dbiteur qui sont imposables ainsi que les prestations sociales,  lexception de celles visant  amliorer le niveau de vie des enfants (ex : prestations familiales).</p>",
			"type": "money",
			"contentDependencies": [
				"mtEnfantPA",
				"totalPA"
			],
			"inputField": "field1-1-1-0-1",
			"rulesConditionsDependency": [
				1,
				3,
				4,
				5,
				6,
				7,
				8,
				9,
				10
			]
		},
		"droitVH": {
			"id": 2,
			"label": "Droit de visite et d'hbergement",
			"description": "<p><strong>Droit de visite et d'hbergement :</strong></p><br><p><strong>Rduit :</strong> la rsidence de l'enfant est fixe principalement chez l'un des parents et le temps de rsidence chez l'autre parent est infrieur  1/4 du temps de rsidence globale. Cela peut consister en un droit de visite et dhbergement peu frquent en raison de lindisponibilit du parent, ou en un droit de visite simple, sans hbergement, si le parent ne dispose pas de condition de logement adquat ou que cet hbergement ne serait pas conforme  l'intrt de l'enfant;</p><br><p><strong>Classique :</strong>  la rsidence est fixe principalement chez l'un des parents et le temps de rsidence chez l'autre parent est quivalent  1/4 du temps de rsidence globale (ex : un week-end sur deux et la moiti des vacances scolaires).;</p><br><p><strong>Altern :</strong> les enfants rsident alternativement au domicile de chacun des parents. La rsidence alterne peut donner lieu  contribution  l'entretien et  l'ducation des enfants quand les parents ne se sont pas mis d'accord sur le partage des frais lis  l'enfant en fonction de leurs ressources ou quand l'un des parents ne peut pas assumer seul la charge financire de la rsidence alterne.</p>",
			"type": "choice",
			"choices": [
				{
					"1": "rduite"
				},
				{
					"2": "classique"
				},
				{
					"3": "alterne"
				}
			],
			"inputField": "field1-1-1-0-2",
			"sourceDependencies": [
				1
			],
			"rulesConditionsDependency": [
				3,
				4,
				5,
				6,
				7,
				8,
				10
			]
		},
		"nbEnfants": {
			"id": 3,
			"label": "Nombre d'enfants",
			"description": "<p>Nombre total d'enfants  la charge du parent dbiteur (quelle que soit l'union dont ils sont ns). Sont donc pris en compte l'ensemble des enfants dont le parent dbiteur a la charge, y compris ceux qui ne rsident pas avec lui.</p>",
			"type": "choice",
			"unparsedDefault": "1",
			"choices": [
				{
					"1": "1"
				},
				{
					"2": "2"
				},
				{
					"3": "3"
				},
				{
					"4": "4"
				},
				{
					"5": "5"
				},
				{
					"6": "6"
				},
				{
					"7": "7+"
				}
			],
			"contentDependencies": [
				"totalPA"
			],
			"inputField": "field1-1-1-0-3",
			"sourceDependencies": [
				1
			],
			"rulesConditionsDependency": [
				2,
				3,
				4,
				5,
				6,
				7,
				8
			]
		},
		"tauxPA": {
			"id": 4,
			"label": "Taux pension alimentaire",
			"description": "<p>Le taux est tabli selon une table de rfrence publie annuellement par le ministre de la justice :</p><p><strong>Droit de visite et d'hbergement rduit</strong></p><br><ul><br><li>1 enfant : 18,0%</li><br><li>2 enfants : 15,5%</li><br><li>3 enfants : 13,3%</li><br><li>4 enfants : 11,7%</li><br><li>5 enfants : 10,6%</li><br><li>6 enfants : 9,5%</li><br></ul><br><p><strong>Droit de visite et d'hbergement classique</strong></p><br><ul><br><li>1 enfant : 13,5%</li><br><li>2 enfants : 11,5%</li><br><li>3 enfants : 10,0%</li><br><li>4 enfants : 8,8%</li><br><li>5 enfants : 8,0%</li><br><li>6 enfants : 7,2%</li><br></ul><br><p><strong>Droit de visite et d'hbergement altern</strong></p><br><ul><br><li>1 enfant : 9,0%</li><br><li>2 enfants : 7,8%</li><br><li>3 enfants : 6,7%</li><br><li>4 enfants : 5,9%</li><br><li>5 enfants : 5,3%</li><br><li>6 enfants : 4,8%</li><br></ul>",
			"type": "percent",
			"unparsedSource": "1",
			"contentDependencies": [
				"mtEnfantPA"
			],
			"rulesConditionsDependency": [
				3,
				4,
				5,
				6,
				7,
				8
			]
		},
		"montantForfaitaireRSA": {
			"id": 5,
			"label": "Montant forfaitaire du RSA",
			"description": "<p>Montant forfaitaire du RSA pour un mnage compos d'une seule personne.</p><br><p>L'employ doit dans tous les cas, conserver au moins cette somme aprs le paiement de la pension</p>",
			"type": "money",
			"unparsedContent": "550.93",
			"contentDependencies": [
				"mtEnfantPA",
				"totalPA"
			]
		},
		"mtEnfantPA": {
			"id": 6,
			"label": "Montant par enfant",
			"description": "",
			"type": "money",
			"round": 0,
			"unparsedContent": "max(0, round((revenus - montantForfaitaireRSA) * tauxPA /100))",
			"contentDependencies": [
				"totalPA"
			],
			"rulesConditionsDependency": [
				3,
				4,
				5,
				6,
				7,
				8
			]
		},
		"totalPA": {
			"id": 7,
			"label": "Montant total",
			"description": "",
			"type": "money",
			"round": 0,
			"unparsedContent": "max(0, min(revenus - montantForfaitaireRSA, mtEnfantPA * nbEnfants))"
		}
	},
	"profiles": [],
	"steps": [
		{
			"id": 1,
			"elementId": "step1",
			"name": "calcul",
			"label": "pension alimentaire",
			"output": "",
			"description": "<p>Le montant de pension  verser ou  recevoir que vous calculerez en utilisant ce simulateur est strictement indicatif.</p><p>Seul le juge, sil est saisi, peut prononcer le montant dfinitif de la pension en prenant en compte la situation spcifique des parents.</p>",
			"numberOfInputFields": 3,
			"numberOfRequiredInputFields": 3,
			"panels": [
				{
					"id": 1,
					"elementId": "panel1-1",
					"name": "panel1",
					"label": "",
					"blocks": [
						{
							"type": "fieldset",
							"id": 1,
							"elementId": "fieldset1-1-1",
							"legend": {
								"content": "Revenus et enfants",
								"edition": "manual"
							},
							"disposition": "",
							"display": "",
							"popinLink": "",
							"columns": [],
							"fieldrows": [
								{
									"id": 0,
									"elementId": "fieldrow1-1-1-0",
									"fields": [
										{
											"id": 1,
											"elementId": "field1-1-1-0-1",
											"data": "revenus",
											"label": "Revenus mensuels du parent dbiteur",
											"usage": "input",
											"required": "1",
											"help": "1"
										},
										{
											"id": 2,
											"elementId": "field1-1-1-0-2",
											"data": "droitVH",
											"label": "Amplitude du droit de visite et d'hbergement",
											"usage": "input",
											"expanded": "1",
											"prompt": "--- Slectionnez l'amplitude ---",
											"required": "1",
											"help": "1"
										},
										{
											"id": 3,
											"elementId": "field1-1-1-0-3",
											"data": "nbEnfants",
											"label": "Nombre d'enfants du parent dbiteur",
											"usage": "input",
											"required": "1",
											"help": "1"
										},
										{
											"id": 4,
											"elementId": "field1-1-1-0-4",
											"data": "tauxPA",
											"label": "Taux applicable par enfant",
											"usage": "output",
											"help": "1"
										}
									]
								}
							]
						},
						{
							"type": "fieldset",
							"id": 2,
							"elementId": "fieldset1-1-2",
							"legend": {
								"content": "",
								"edition": ""
							},
							"disposition": "",
							"display": "",
							"popinLink": "",
							"columns": [],
							"fieldrows": [
								{
									"id": 0,
									"elementId": "fieldrow1-1-2-0",
									"fields": [
										{
											"id": 1,
											"elementId": "field1-1-2-0-1",
											"data": "mtEnfantPA",
											"label": "Montant par enfant",
											"usage": "output",
											"emphasize": "1"
										},
										{
											"id": 2,
											"elementId": "field1-1-2-0-2",
											"data": "totalPA",
											"label": "Montant total",
											"usage": "output",
											"emphasize": "1"
										}
									]
								}
							]
						}
					]
				}
			],
			"actions": {
				"action1-effacer": {
					"name": "effacer",
					"label": "Recommencer",
					"what": "reset",
					"for": "currentStep",
					"uri": "",
					"location": "bottom",
					"shape": "button",
					"class": "btn-secondary"
				},
				"action1-partagerEmail": {
					"name": "partagerEmail",
					"label": "Partager par email",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareByEmail','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerTwitter": {
					"name": "partagerTwitter",
					"label": "Partager sur Twitter",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnTwitter','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerFacebook": {
					"name": "partagerFacebook",
					"label": "Partager sur Facebook",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnFacebook','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerLinkedin": {
					"name": "partagerLinkedin",
					"label": "Partager sur Linkedin",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnLinkedin','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerPinterest": {
					"name": "partagerPinterest",
					"label": "Partager sur Pinterest",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnPinterest','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerVk": {
					"name": "partagerVk",
					"label": "Partager sur Vk",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnVk','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerXing": {
					"name": "partagerXing",
					"label": "Partager sur Xing",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnXing','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerTumblr": {
					"name": "partagerTumblr",
					"label": "Partager sur Tumblr",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnTumblr','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerReddit": {
					"name": "partagerReddit",
					"label": "Partager sur Reddit",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnReddit','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				},
				"action1-partagerViadeo": {
					"name": "partagerViadeo",
					"label": "Partager sur Viadeo",
					"what": "execute",
					"for": "function",
					"uri": "{'function':'shareOnViadeo','appliedto':'page','arguments':{'step':'1'}}",
					"location": "top",
					"shape": "link",
					"class": ""
				}
			},
			"footnotes": []
		}
	],
	"sources": {
		"1": {
			"datasource": {
				"type": "internal"
			},
			"label": "",
			"separator": "",
			"delimiter": "",
			"parameters": [
				{
					"name": "droitVH",
					"type": "columnValue",
					"format": "",
					"origin": "data",
					"optional": "0",
					"data": "droitVH"
				},
				{
					"name": "nbEnfants",
					"type": "columnValue",
					"format": "",
					"origin": "data",
					"optional": "0",
					"data": "nbEnfants"
				}
			],
			"returnType": "assocArray",
			"returnPath": "0/rate"
		}
	},
	"rules": [
		{
			"id": 1,
			"name": "R1",
			"conditions": "revenus <= 0",
			"ifdata": [
				{
					"name": "action-select",
					"value": "notifyError",
					"fields": [
						{
							"name": "message",
							"value": "Votre revenu doit tre suprieur  0"
						},
						{
							"name": "target",
							"value": "data",
							"fields": [
								{
									"name": "fieldName",
									"value": "revenus"
								}
							]
						}
					]
				}
			],
			"elsedata": []
		},
		{
			"id": 2,
			"name": "R2",
			"conditions": "defined(nbEnfants) && nbEnfants <= 0",
			"ifdata": [
				{
					"name": "action-select",
					"value": "notifyError",
					"fields": [
						{
							"name": "message",
							"value": "Le nombre d'enfants doit tre suprieur  0"
						},
						{
							"name": "target",
							"value": "data",
							"fields": [
								{
									"name": "fieldName",
									"value": "nbEnfants"
								}
							]
						}
					]
				}
			],
			"elsedata": []
		},
		{
			"id": 3,
			"name": "R3",
			"conditions": "defined(revenus) && defined(droitVH) && defined(nbEnfants) && defined(tauxPA) && defined(mtEnfantPA) && mtEnfantPA >= 0",
			"ifdata": [
				{
					"name": "action-select",
					"value": "showObject",
					"fields": [
						{
							"name": "objectId",
							"value": "field",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "panelId",
											"value": "1",
											"fields": [
												{
													"name": "fieldsetId",
													"value": "1",
													"fields": [
														{
															"name": "fieldrowId",
															"value": "0",
															"fields": [
																{
																	"name": "fieldId",
																	"value": "4"
																}
															]
														}
													]
												}
											]
										}
									]
								}
							]
						}
					]
				}
			],
			"elsedata": []
		},
		{
			"id": 4,
			"name": "R3",
			"conditions": "defined(revenus) && defined(droitVH) && defined(nbEnfants) && defined(tauxPA) && defined(mtEnfantPA) && mtEnfantPA >= 0",
			"ifdata": [
				{
					"name": "action-select",
					"value": "showObject",
					"fields": [
						{
							"name": "objectId",
							"value": "fieldset",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "panelId",
											"value": "1",
											"fields": [
												{
													"name": "fieldsetId",
													"value": "2"
												}
											]
										}
									]
								}
							]
						}
					]
				}
			],
			"elsedata": []
		},
		{
			"id": 5,
			"name": "R3",
			"conditions": "defined(revenus) && defined(droitVH) && defined(nbEnfants) && defined(tauxPA) && defined(mtEnfantPA) && mtEnfantPA >= 0",
			"ifdata": [
				{
					"name": "action-select",
					"value": "showObject",
					"fields": [
						{
							"name": "objectId",
							"value": "action",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "actionId",
											"value": "effacer"
										}
									]
								}
							]
						}
					]
				}
			],
			"elsedata": []
		},
		{
			"id": 6,
			"name": "R3",
			"conditions": "defined(revenus) && defined(droitVH) && defined(nbEnfants) && defined(tauxPA) && defined(mtEnfantPA) && mtEnfantPA >= 0",
			"ifdata": [],
			"elsedata": [
				{
					"name": "action-select",
					"value": "hideObject",
					"fields": [
						{
							"name": "objectId",
							"value": "field",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "panelId",
											"value": "1",
											"fields": [
												{
													"name": "fieldsetId",
													"value": "1",
													"fields": [
														{
															"name": "fieldrowId",
															"value": "0",
															"fields": [
																{
																	"name": "fieldId",
																	"value": "4"
																}
															]
														}
													]
												}
											]
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"id": 7,
			"name": "R3",
			"conditions": "defined(revenus) && defined(droitVH) && defined(nbEnfants) && defined(tauxPA) && defined(mtEnfantPA) && mtEnfantPA >= 0",
			"ifdata": [],
			"elsedata": [
				{
					"name": "action-select",
					"value": "hideObject",
					"fields": [
						{
							"name": "objectId",
							"value": "fieldset",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "panelId",
											"value": "1",
											"fields": [
												{
													"name": "fieldsetId",
													"value": "2"
												}
											]
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"id": 8,
			"name": "R3",
			"conditions": "defined(revenus) && defined(droitVH) && defined(nbEnfants) && defined(tauxPA) && defined(mtEnfantPA) && mtEnfantPA >= 0",
			"ifdata": [],
			"elsedata": [
				{
					"name": "action-select",
					"value": "hideObject",
					"fields": [
						{
							"name": "objectId",
							"value": "action",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "actionId",
											"value": "effacer"
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"id": 9,
			"name": "R4",
			"conditions": "defined(revenus)",
			"ifdata": [
				{
					"name": "action-select",
					"value": "showObject",
					"fields": [
						{
							"name": "objectId",
							"value": "field",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "panelId",
											"value": "1",
											"fields": [
												{
													"name": "fieldsetId",
													"value": "1",
													"fields": [
														{
															"name": "fieldrowId",
															"value": "0",
															"fields": [
																{
																	"name": "fieldId",
																	"value": "2"
																}
															]
														}
													]
												}
											]
										}
									]
								}
							]
						}
					]
				}
			],
			"elsedata": [
				{
					"name": "action-select",
					"value": "hideObject",
					"fields": [
						{
							"name": "objectId",
							"value": "field",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "panelId",
											"value": "1",
											"fields": [
												{
													"name": "fieldsetId",
													"value": "1",
													"fields": [
														{
															"name": "fieldrowId",
															"value": "0",
															"fields": [
																{
																	"name": "fieldId",
																	"value": "2"
																}
															]
														}
													]
												}
											]
										}
									]
								}
							]
						}
					]
				}
			]
		},
		{
			"id": 10,
			"name": "R5",
			"conditions": "defined(revenus) && defined(droitVH)",
			"ifdata": [
				{
					"name": "action-select",
					"value": "showObject",
					"fields": [
						{
							"name": "objectId",
							"value": "field",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "panelId",
											"value": "1",
											"fields": [
												{
													"name": "fieldsetId",
													"value": "1",
													"fields": [
														{
															"name": "fieldrowId",
															"value": "0",
															"fields": [
																{
																	"name": "fieldId",
																	"value": "3"
																}
															]
														}
													]
												}
											]
										}
									]
								}
							]
						}
					]
				}
			],
			"elsedata": [
				{
					"name": "action-select",
					"value": "hideObject",
					"fields": [
						{
							"name": "objectId",
							"value": "field",
							"fields": [
								{
									"name": "stepId",
									"value": "1",
									"fields": [
										{
											"name": "panelId",
											"value": "1",
											"fields": [
												{
													"name": "fieldsetId",
													"value": "1",
													"fields": [
														{
															"name": "fieldrowId",
															"value": "0",
															"fields": [
																{
																	"name": "fieldId",
																	"value": "3"
																}
															]
														}
													]
												}
											]
										}
									]
								}
							]
						}
					]
				}
			]
		}
	]
};

document.addEventListener( 'DOMContentLoaded', function(event) {
	var options = {
		simulator: G6K_SIMU,
		form: document.querySelector('.simulator form'),
		locale: 'fr-FR',
		dynamic: true,
		mobile: false,
		dateFormat: 'd/m/Y',
		decimalPoint: ',',
		moneySymbol: '',
		symbolPosition: 'after',
		groupingSeparator: ' ',
		groupingSize: '3'
	};
	var g6k = new G6k(options);
	g6k.run();
});
